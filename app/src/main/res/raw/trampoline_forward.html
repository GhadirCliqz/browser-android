<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script>
        "use strict";

        /*
         * The trampoline helps us to build a coherent navigation experience, it's loaded in the
         * "browser" WebView and works like a place holder for the "search" WebView.
         */
        function redirect() {
            if (history.state == null) {
                var queryStr = window.location.search.substring(1).split('+').join(' ');
                var query = queryStr.split('&')
                    .reduce(function(acc, par) {
                        var kv = par.split('=');
                        acc[kv[0]] = decodeURIComponent(kv[1]);
                        return acc;
                    }, {});
                history.pushState(query, "page", "goto.html");
                // Workaround
                setTimeout(function() {
                    window.location.href = query.url
                }, 0);
            } else if (Boolean(history.state.r)) {
                // This is used only for the "New Tab" functionality
                var oReq = new XMLHttpRequest();
                oReq.open("GET", "cliqz://trampoline/close.html");
                oReq.send();
            } else {
                var query = history.state.q;
                var oReq = new XMLHttpRequest();
                oReq.addEventListener("load", function() {
                    history.back();
                });
                oReq.open("GET", "cliqz://trampoline/search.html?q=" + encodeURIComponent(query));
                oReq.send();
            }
        }
    </script>
</head>
<body onload="redirect()">
</body>
</html>