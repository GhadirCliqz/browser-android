{"version":3,"sources":["CliqzUtils.jsm","CliqzABTests.jsm","CliqzAutocomplete.jsm","CliqzCalculator.jsm","CliqzEvents.jsm","CliqzHandlebars.jsm","CliqzHistoryCluster.jsm","CliqzRequestMonitor.jsm","CliqzResultProviders.jsm","CliqzSpellCheck.jsm","CliqzWikipediaDeduplication.jsm","Mixer.jsm","Result.jsm","UrlCompare.jsm"],"sourcesContent":["// start module CliqzUtils\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module has a list of helpers used across the extension\n *  HTTP handlers\n *  URL manipulators\n *  Localization mechanics\n *  Common logging pipe\n *  Preferences(persistent storage) wrappers\n *  Browser helpers\n *  ...\n */\nComponents.utils.import('resource://gre/modules/Services.jsm');\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nComponents.utils.import('chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzLanguage',\n  'chrome://cliqzmodules/content/CliqzLanguage.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzResultProviders',\n  'chrome://cliqzmodules/content/CliqzResultProviders.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzAutocomplete',\n  'chrome://cliqzmodules/content/CliqzAutocomplete.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'Result',\n  'chrome://cliqzmodules/content/Result.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzRequestMonitor',\n  'chrome://cliqzmodules/content/CliqzRequestMonitor.jsm');\n\nvar EXPORTED_SYMBOLS = ['CliqzUtils'];\n\nvar VERTICAL_ENCODINGS = {\n    'people':'p',\n    'news':'n',\n    'video':'v',\n    'hq':'h',\n    'bm': 'm',\n    'recipeRD': 'r',\n    'game': 'g',\n    'movie': 'o'\n};\n\nvar COLOURS = ['#ffce6d','#ff6f69','#96e397','#5c7ba1','#bfbfbf','#3b5598','#fbb44c','#00b2e5','#b3b3b3','#99cccc','#ff0027','#999999'],\n    LOGOS = ['wikipedia', 'google', 'facebook', 'youtube', 'duckduckgo', 'sternefresser', 'zalando', 'bild', 'web', 'ebay', 'gmx', 'amazon', 't-online', 'wiwo', 'wwe', 'weightwatchers', 'rp-online', 'wmagazine', 'chip', 'spiegel', 'yahoo', 'paypal', 'imdb', 'wikia', 'msn', 'autobild', 'dailymotion', 'hm', 'hotmail', 'zeit', 'bahn', 'softonic', 'handelsblatt', 'stern', 'cnn', 'mobile', 'aetv', 'postbank', 'dkb', 'bing', 'adobe', 'bbc', 'nike', 'starbucks', 'techcrunch', 'vevo', 'time', 'twitter', 'weatherunderground', 'xing', 'yelp', 'yandex', 'weather', 'flickr'],\n    BRANDS_DATABASE = { domains: {}, palette: [\"999\"] }, brand_loaded = false,\n    MINUTE = 60*1e3,\n    ipv4_part = \"0*([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\", // numbers 0 - 255\n    ipv4_regex = new RegExp(\"^\" + ipv4_part + \"\\\\.\"+ ipv4_part + \"\\\\.\"+ ipv4_part + \"\\\\.\"+ ipv4_part + \"([:]([0-9])+)?$\"), // port number\n    ipv6_regex = new RegExp(\"^\\\\[?(([0-9]|[a-f]|[A-F])*[:.]+([0-9]|[a-f]|[A-F])+[:.]*)+[\\\\]]?([:][0-9]+)?$\");\n\n\nvar CliqzUtils = {\n  LANGS:                          {'de':'de', 'en':'en', 'fr':'fr'},\n  RESULTS_PROVIDER:               'https://newbeta.cliqz.com/api/v1/results?q=',\n  RICH_HEADER:                    'https://newbeta.cliqz.com/api/v1/rich-header?path=/map',\n  RESULTS_PROVIDER_LOG:           'https://newbeta.cliqz.com/api/v1/logging?q=',\n  RESULTS_PROVIDER_PING:          'https://newbeta.cliqz.com/ping',\n  CONFIG_PROVIDER:                'https://newbeta.cliqz.com/api/v1/config',\n  SAFE_BROWSING:                  'https://safe-browsing.cliqz.com',\n  LOG:                            'https://logging.cliqz.com',\n  TUTORIAL_URL:                   'https://cliqz.com/home/onboarding',\n  UNINSTALL:                      'https://cliqz.com/home/offboarding',\n  FEEDBACK:                       'https://cliqz.com/support',\n  PREFERRED_LANGUAGE:             null,\n\n  BRANDS_DATABASE: BRANDS_DATABASE,\n\n  //will be updated from the mixer config endpoint every time new logos are generated\n  BRANDS_DATABASE_VERSION: 1457952995848,\n  GEOLOC_WATCH_ID:                null, // The ID of the geolocation watcher (function that updates cached geolocation on change)\n  VERTICAL_TEMPLATES: {\n        'n': 'news'    ,\n        'p': 'people'  ,\n        'v': 'video'   ,\n        'h': 'hq'      ,\n        'r': 'recipe' ,\n        'g': 'cpgame_movie',\n        'o': 'cpgame_movie'\n    },\n  TEMPLATES_PATH: CLIQZEnvironment.TEMPLATES_PATH,\n  init: function(win){\n    var localePromise;\n    if (win && win.navigator) {\n        // See http://gu.illau.me/posts/the-problem-of-user-language-lists-in-javascript/\n        var nav = win.navigator;\n        CliqzUtils.PREFERRED_LANGUAGE = CliqzUtils.getPref('general.useragent.locale', nav.language || nav.userLanguage || 'en', '');\n        localePromise = CliqzUtils.loadLocale(CliqzUtils.PREFERRED_LANGUAGE);\n    }\n\n    if(!brand_loaded){\n      brand_loaded = true;\n\n      var config = this.getPref(\"config_logoVersion\"), dev = this.getPref(\"brands-database-version\");\n\n      if (dev) this.BRANDS_DATABASE_VERSION = dev\n      else if (config) this.BRANDS_DATABASE_VERSION = config\n\n      var retryPattern = [60*MINUTE, 10*MINUTE, 5*MINUTE, 2*MINUTE, MINUTE];\n\n      (function getLogoDB(url){\n\n          CliqzUtils && CliqzUtils.httpGet(url,\n          function(req){\n            CliqzUtils.BRANDS_DATABASE =  BRANDS_DATABASE = JSON.parse(req.response); },\n          function(){\n            var retry = retryPattern.pop();\n            if(retry) CliqzUtils.setTimeout(getLogoDB, retry, url);\n          }\n          , MINUTE/2);\n      })(CLIQZEnvironment.getBrandsDBUrl(this.BRANDS_DATABASE_VERSION));\n    }\n\n    CliqzUtils.requestMonitor = new CliqzRequestMonitor();\n    CliqzUtils.log('Initialized', 'CliqzUtils');\n    return localePromise;\n  },\n\n  initPlatform: function(System) {\n    System.baseURL = CLIQZEnvironment.SYSTEM_BASE_URL;\n    CliqzUtils.System = System;\n  },\n\n  importModule: function(moduleName) {\n    return CliqzUtils.System.import(moduleName)\n  },\n\n  isNumber: function(n){\n      /*\n      NOTE: this function can't recognize numbers in the form such as: \"1.2B\", but it can for \"1e4\". See specification for isFinite()\n       */\n      return !isNaN(parseFloat(n)) && isFinite(n);\n  },\n\n  //returns the type only if it is known\n  getKnownType: function(type){\n    return VERTICAL_ENCODINGS.hasOwnProperty(type) && type;\n  },\n\n  /**\n   * Construct a uri from a url\n   * @param {string}  aUrl - url\n   * @param {string}  aOriginCharset - optional character set for the URI\n   * @param {nsIURI}  aBaseURI - base URI for the spec\n   */\n  makeUri: CLIQZEnvironment.makeUri,\n\n  //move this out of CliqzUtils!\n  setSupportInfo: function(status){\n    var prefs = Components.classes['@mozilla.org/preferences-service;1'].getService(Components.interfaces.nsIPrefBranch),\n        host = 'firefox', hostVersion='';\n\n    //check if the prefs exist and if they are string\n    if(prefs.getPrefType('distribution.id') == 32 && prefs.getPrefType('distribution.version') == 32){\n      host = prefs.getCharPref('distribution.id');\n      hostVersion = prefs.getCharPref('distribution.version');\n    }\n    var info = JSON.stringify({\n          version: CliqzUtils.extensionVersion,\n          host: host,\n          hostVersion: hostVersion,\n          status: status != undefined ? status : \"active\"\n        }),\n        sites = [\"http://cliqz.com\",\"https://cliqz.com\"]\n\n    sites.forEach(function(url){\n        var ls = CLIQZEnvironment.getLocalStorage(url)\n\n        if (ls) ls.setItem(\"extension-info\",info)\n    })\n  },\n  getLogoDetails: function(urlDetails){\n    var base = urlDetails.name,\n        baseCore = base.replace(/[-]/g, \"\"),\n        check = function(host,rule){\n          var address = host.lastIndexOf(base), parseddomain = host.substr(0,address) + \"$\" + host.substr(address + base.length)\n\n          return parseddomain.indexOf(rule) != -1\n        },\n        result = {},\n        domains = BRANDS_DATABASE.domains;\n\n\n\n    if(base.length == 0)\n      return result;\n\n    if (base == \"IP\") result = { text: \"IP\", backgroundColor: \"9077e3\" }\n\n    else if (domains[base]) {\n      for (var i=0,imax=domains[base].length;i<imax;i++) {\n        var rule = domains[base][i] // r = rule, b = background-color, l = logo, t = text, c = color\n\n        if (i == imax - 1 || check(urlDetails.host,rule.r)) {\n          result = {\n            backgroundColor: rule.b?rule.b:null,\n            backgroundImage: rule.l?\"url(https://cdn.cliqz.com/brands-database/database/\" + this.BRANDS_DATABASE_VERSION + \"/logos/\" + base + \"/\" + rule.r + \".svg)\":\"\",\n            text: rule.t,\n            color: rule.c?\"\":\"#fff\"\n          }\n\n          break\n        }\n      }\n    }\n    result.text = result.text || (baseCore.length > 1 ? ((baseCore[0].toUpperCase() + baseCore[1].toLowerCase())) : \"\")\n    result.backgroundColor = result.backgroundColor || BRANDS_DATABASE.palette[base.split(\"\").reduce(function(a,b){ return a + b.charCodeAt(0) },0) % BRANDS_DATABASE.palette.length]\n    var colorID = BRANDS_DATABASE.palette.indexOf(result.backgroundColor),\n        buttonClass = BRANDS_DATABASE.buttons && colorID != -1 && BRANDS_DATABASE.buttons[colorID]?BRANDS_DATABASE.buttons[colorID]:10\n\n    result.buttonsClass = \"cliqz-brands-button-\" + buttonClass\n    result.style = \"background-color: #\" + result.backgroundColor + \";color:\" + (result.color || '#fff') + \";\"\n\n\n    if (result.backgroundImage) result.style += \"background-image:\" + result.backgroundImage + \"; text-indent: -10em;\"\n\n    return result\n  },\n  httpHandler: function () {\n    var errorHandler = arguments[3]; // see httpGet or httpPost arguments\n    try {\n      return CLIQZEnvironment.httpHandler.apply(CLIQZEnvironment, arguments);\n    } catch(e) {\n      if(errorHandler) {\n        errorHandler(e);\n      } else {\n        CliqzUtils.log(e, \"httpHandler failed\");\n      }\n    }\n  },\n  httpGet: function(url, callback, onerror, timeout, _, sync){\n    return CliqzUtils.httpHandler('GET', url, callback, onerror, timeout, _, sync);\n  },\n  httpPost: function(url, callback, data, onerror, timeout) {\n    return CliqzUtils.httpHandler('POST', url, callback, onerror, timeout, data);\n  },\n  promiseHttpHandler: function() {\n    return CLIQZEnvironment.promiseHttpHandler.apply(CLIQZEnvironment, arguments);\n  },\n  /**\n   * Loads a resource URL from the xpi.\n   *\n   * Wraps httpGet in a try-catch clause. We need to do this, because when\n   * trying to load a non-existing file from an xpi via xmlhttprequest, Firefox\n   * throws a NS_ERROR_FILE_NOT_FOUND exception instead of calling the onerror\n   * function.\n   *\n   * @see https://bugzilla.mozilla.org/show_bug.cgi?id=827243 (probably).\n   */\n  loadResource: function(url, callback, onerror) {\n    try {\n        return CliqzUtils.httpGet(url, callback, onerror, 3000);\n    } catch (e) {\n      CliqzUtils.log(\"Could not load resource \" + url + \" from the xpi\",\n                     \"CliqzUtils.httpHandler\");\n      onerror && onerror();\n    }\n  },\n  openTabInWindow: CLIQZEnvironment.openTabInWindow,\n  /**\n   * Get a value from preferences db\n   * @param {string}  pref - preference identifier\n   * @param {*=}      defautlValue - returned value in case pref is not defined\n   * @param {string=} prefix - prefix for pref\n   */\n  getPref: CLIQZEnvironment.getPref,\n  /**\n   * Set a value in preferences db\n   * @param {string}  pref - preference identifier\n   * @param {*=}      defautlValue - returned value in case pref is not defined\n   * @param {string=} prefix - prefix for pref\n   */\n  setPref: CLIQZEnvironment.setPref,\n  /**\n   * Check if there is a value in preferences db\n   * @param {string}  pref - preference identifier\n   * @param {string=} prefix - prefix for pref\n   */\n  hasPref: CLIQZEnvironment.hasPref,\n  /**\n   * Clear value in preferences db\n   * @param {string}  pref - preference identifier\n   * @param {string=} prefix - prefix for pref\n   */\n  clearPref: CLIQZEnvironment.clearPref,\n  log: function(msg, key){\n    if(CliqzUtils && CliqzUtils.getPref('showConsoleLogs', false)){\n      var ignore = JSON.parse(CliqzUtils.getPref('showConsoleLogsIgnore', '[]'))\n      if(ignore.indexOf(key) == -1) // only show the log message, if key is not in ignore list\n        CLIQZEnvironment.log(msg, key);\n    }\n  },\n  getDay: function() {\n    return Math.floor(new Date().getTime() / 86400000);\n  },\n  //creates a random 'len' long string from the input space\n  rand: function(len, _space){\n      var ret = '', i,\n          space = _space || 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',\n          sLen = space.length;\n\n      for(i=0; i < len; i++ )\n          ret += space.charAt(Math.floor(Math.random() * sLen));\n\n      return ret;\n  },\n  hash: function(s){\n    return s.split('').reduce(function(a,b){ return (((a<<4)-a)+b.charCodeAt(0)) & 0xEFFFFFF}, 0)\n  },\n  cleanMozillaActions: function(url){\n    if(url.indexOf(\"moz-action:\") == 0) {\n        var match = url.match(/^moz-action:([^,]+),(.*)$/);\n        var action = match[1];\n        url = match[2];\n    }\n    return [action, url];\n  },\n  cleanUrlProtocol: function(url, cleanWWW){\n    if(!url) return '';\n\n    var protocolPos = url.indexOf('://');\n\n    // removes protocol http(s), ftp, ...\n    if(protocolPos != -1 && protocolPos <= 6)\n      url = url.split('://')[1];\n\n    // removes the www.\n    if(cleanWWW && url.toLowerCase().indexOf('www.') == 0)\n      url = url.slice(4);\n\n    return url;\n  },\n  getDetailsFromUrl: function(originalUrl){\n    var result = CliqzUtils.cleanMozillaActions(originalUrl);\n    var action = result[0];\n    var originalUrl = result[1];\n    // exclude protocol\n    var url = originalUrl,\n        name = '',\n        tld = '',\n        subdomains = [],\n        path = '',\n        query ='',\n        fragment = '',\n        ssl = originalUrl.indexOf('https') == 0;\n\n    // remove scheme\n    url = CliqzUtils.cleanUrlProtocol(url, false);\n    var scheme = originalUrl.replace(url, '').replace('//', '');\n\n    // separate hostname from path, etc. Could be separated from rest by /, ? or #\n    var host = url.split(/[\\/\\#\\?]/)[0].toLowerCase();\n    var path = url.replace(host,'');\n\n    // separate username:password@ from host\n    var userpass_host = host.split('@');\n    if(userpass_host.length > 1)\n      host = userpass_host[1];\n\n    // Parse Port number\n    var port = \"\";\n\n    var isIPv4 = ipv4_regex.test(host);\n    var isIPv6 = ipv6_regex.test(host);\n\n\n    var indexOfColon = host.indexOf(\":\");\n    if ((!isIPv6 || isIPv4) && indexOfColon >= 0) {\n      port = host.substr(indexOfColon+1);\n      host = host.substr(0,indexOfColon);\n    }\n    else if (isIPv6) {\n      // If an IPv6 address has a port number, it will be right after a closing bracket ] : format [ip_v6]:port\n      var endOfIP = host.indexOf(']:');\n      if (endOfIP >= 0) {\n        port = host.split(']:')[1];\n        host = host.split(']:')[0].replace('[','').replace(']','');\n      }\n    }\n\n    // extract query and fragment from url\n    var query = '';\n    var query_idx = path.indexOf('?');\n    if(query_idx != -1) {\n      query = path.substr(query_idx+1);\n    }\n\n    var fragment = '';\n    var fragment_idx = path.indexOf('#');\n    if(fragment_idx != -1) {\n      fragment = path.substr(fragment_idx+1);\n    }\n\n    // remove query and fragment from path\n    path = path.replace('?' + query, '');\n    path = path.replace('#' + fragment, '');\n    query = query.replace('#' + fragment, '');\n\n    // extra - all path, query and fragment\n    var extra = path;\n    if(query)\n      extra += \"?\" + query;\n    if(fragment)\n      extra += \"#\" + fragment;\n\n    isIPv4 = ipv4_regex.test(host);\n    isIPv6 = ipv6_regex.test(host);\n    var isLocalhost = CliqzUtils.isLocalhost(host, isIPv4, isIPv6);\n\n    // find parts of hostname\n    if (!isIPv4 && !isIPv6 && !isLocalhost) {\n      try {\n        tld = CLIQZEnvironment.tldExtractor(host);\n\n        // Get the domain name w/o subdomains and w/o TLD\n        name = host.slice(0, -(tld.length+1)).split('.').pop(); // +1 for the '.'\n\n        // Get subdomains\n        var name_tld = name + \".\" + tld;\n        subdomains = host.slice(0, -name_tld.length).split(\".\").slice(0, -1);\n\n        //remove www if exists\n        // TODO: I don't think this is the right place to do this.\n        //       Disabled for now, but check there are no issues.\n        // host = host.indexOf('www.') == 0 ? host.slice(4) : host;\n      } catch(e){\n        name = \"\";\n        host = \"\";\n        //CliqzUtils.log('WARNING Failed for: ' + originalUrl, 'CliqzUtils.getDetailsFromUrl');\n      }\n    }\n    else {\n      name = isLocalhost ? \"localhost\" : \"IP\";\n    }\n\n    // remove www from beginning, we need cleanHost in the friendly url\n    var cleanHost = host;\n    if(host.toLowerCase().indexOf('www.') == 0) {\n      cleanHost = host.slice(4);\n    }\n\n    var friendly_url = cleanHost + extra;\n    //remove trailing slash from the end\n    friendly_url = CliqzUtils.stripTrailingSlash(friendly_url);\n\n    //Handle case where we have only tld for example http://cliqznas\n    if(cleanHost === tld) {\n      name = tld;\n    }\n\n    var urlDetails = {\n              scheme: scheme,\n              name: name,\n              domain: tld ? name + '.' + tld : '',\n              tld: tld,\n              subdomains: subdomains,\n              path: path,\n              query: query,\n              fragment: fragment,\n              extra: extra,\n              host: host,\n              cleanHost: cleanHost,\n              ssl: ssl,\n              port: port,\n              friendly_url: friendly_url\n        };\n\n    return urlDetails;\n  },\n  stripTrailingSlash: function(str) {\n    if(str.substr(-1) === '/') {\n        return str.substr(0, str.length - 1);\n    }\n    return str;\n  },\n  _isUrlRegExp: /^(([a-z\\d]([a-z\\d-]*[a-z\\d]))\\.)+[a-z]{2,}(\\:\\d+)?$/i,\n  isUrl: function(input){\n    //step 1 remove eventual protocol\n    var protocolPos = input.indexOf('://');\n    if(protocolPos != -1 && protocolPos <= 6){\n      input = input.slice(protocolPos+3)\n    }\n    //step2 remove path & everything after\n    input = input.split('/')[0];\n    //step3 run the regex\n    return CliqzUtils._isUrlRegExp.test(input);\n  },\n\n\n  // Chechks if the given string is a valid IPv4 addres\n  isIPv4: function(input) {\n    var ipv4_part = \"0*([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\"; // numbers 0 - 255\n    var ipv4_regex = new RegExp(\"^\" + ipv4_part + \"\\\\.\"+ ipv4_part + \"\\\\.\"+ ipv4_part + \"\\\\.\"+ ipv4_part\n    + \"([:]([0-9])+)?$\"); // port number\n    return ipv4_regex.test(input);\n  },\n\n  isIPv6: function(input) {\n\n    // Currently using a simple regex for \"what looks like an IPv6 address\" for readability\n    var ipv6_regex = new RegExp(\"^\\\\[?(([0-9]|[a-f]|[A-F])*[:.]+([0-9]|[a-f]|[A-F])+[:.]*)+[\\\\]]?([:][0-9]+)?$\")\n    return ipv6_regex.test(input);\n\n    /* A better (more precise) regex to validate IPV6 addresses from StackOverflow:\n    link: http://stackoverflow.com/questions/53497/regular-expression-that-matches-valid-ipv6-addresses\n\n    var ipv6_regex = new RegExp(\"(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:)\"\n    + \"{1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,\"\n    + \"4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a\"\n    + \"-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}\"\n    + \"|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\"\n    + \"|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\");\n    */\n  },\n\n  isLocalhost: function(host, isIPv4, isIPv6) {\n    if (host == \"localhost\") return true;\n    if (isIPv4 && host.substr(0,3) == \"127\") return true;\n    if (isIPv6 && host == \"::1\") return true;\n\n    return false;\n\n  },\n\n  // checks if a value represents an url which is a seach engine\n  isSearch: function(value){\n    if(CliqzUtils.isUrl(value)){\n       return CliqzUtils.getDetailsFromUrl(value).host.indexOf('google') === 0 ? true: false;\n    }\n    return false;\n  },\n  // checks if a string is a complete url\n  isCompleteUrl: function(input){\n    var pattern = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\n    if(!pattern.test(input)) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  // extract query term from search engine result page URLs\n  extractQueryFromUrl: function(url) {\n    // Google\n    if (url.search(/http(s?):\\/\\/www\\.google\\..*\\/.*q=.*/i) === 0) {\n      url = url.substring(url.lastIndexOf('q=') + 2).split('&')[0];\n    // Bing\n    } else if (url.search(/http(s?):\\/\\/www\\.bing\\..*\\/.*q=.*/i) === 0) {\n      url = url.substring(url.indexOf('q=') + 2).split('&')[0];\n    // Yahoo\n    } else if (url.search(/http(s?):\\/\\/.*search\\.yahoo\\.com\\/search.*p=.*/i) === 0) {\n      url = url.substring(url.indexOf('p=') + 2).split('&')[0];\n    } else {\n      url = null;\n    }\n    var decoded = url ? decodeURIComponent(url.replace(/\\+/g,' ')) : null;\n    if (decoded) return decoded;\n    else return url;\n  },\n  // Remove clutter (http, www) from urls\n  generalizeUrl: function(url, skipCorrection) {\n    if (!url) {\n      return '';\n    }\n    var val = url.toLowerCase();\n    var cleanParts = CliqzUtils.cleanUrlProtocol(val, false).split('/'),\n      host = cleanParts[0],\n      pathLength = 0,\n      SYMBOLS = /,|\\./g;\n    if (!skipCorrection) {\n      if (cleanParts.length > 1) {\n        pathLength = ('/' + cleanParts.slice(1).join('/')).length;\n      }\n      if (host.indexOf('www') === 0 && host.length > 4) {\n        // only fix symbols in host\n        if (SYMBOLS.test(host[3]) && host[4] != ' ')\n        // replace only issues in the host name, not ever in the path\n          val = val.substr(0, val.length - pathLength).replace(SYMBOLS, '.') +\n          (pathLength ? val.substr(-pathLength) : '');\n      }\n    }\n    url = CliqzUtils.cleanUrlProtocol(val, true);\n    return url[url.length - 1] == '/' ? url.slice(0,-1) : url;\n  },\n  // Remove clutter from urls that prevents pattern detection, e.g. checksum\n  simplifyUrl: function(url) {\n    var q;\n    // Google redirect urls\n    if (url.search(/http(s?):\\/\\/www\\.google\\..*\\/url\\?.*url=.*/i) === 0) {\n      // Return target URL instead\n      url = url.substring(url.lastIndexOf('url=')).split('&')[0];\n      url = url.substr(4);\n      return decodeURIComponent(url);\n\n      // Remove clutter from Google searches\n    } else if (url.search(/http(s?):\\/\\/www\\.google\\..*\\/.*q=.*/i) === 0) {\n      q = url.substring(url.lastIndexOf('q=')).split('&')[0];\n      if (q != 'q=') {\n        // tbm defines category (images/news/...)\n        var param = url.indexOf('#') != -1 ? url.substr(url.indexOf('#')) : url.substr(url.indexOf('?'));\n        var tbm = param.indexOf('tbm=') != -1 ? ('&' + param.substring(param.lastIndexOf('tbm=')).split('&')[0]) : '';\n        var page = param.indexOf('start=') != -1 ? ('&' + param.substring(param.lastIndexOf('start=')).split('&')[0]) : '';\n        return 'https://www.google.com/search?' + q + tbm /*+ page*/;\n      } else {\n        return url;\n      }\n      // Bing\n    } else if (url.search(/http(s?):\\/\\/www\\.bing\\..*\\/.*q=.*/i) === 0) {\n      q = url.substring(url.indexOf('q=')).split('&')[0];\n      if (q != 'q=') {\n        if (url.indexOf('search?') != -1)\n          return url.substr(0, url.indexOf('search?')) + 'search?' + q;\n        else\n          return url.substr(0, url.indexOf('/?')) + '/?' + q;\n      } else {\n        return url;\n      }\n      // Yahoo redirect\n    } else if (url.search(/http(s?):\\/\\/r.search\\.yahoo\\.com\\/.*/i) === 0) {\n      url = url.substring(url.lastIndexOf('/RU=')).split('/RK=')[0];\n      url = url.substr(4);\n      return decodeURIComponent(url);\n      // Yahoo\n    } else if (url.search(/http(s?):\\/\\/.*search\\.yahoo\\.com\\/search.*p=.*/i) === 0) {\n      var p = url.substring(url.indexOf('p=')).split('&')[0];\n      if (p != 'p=' && url.indexOf(';') != -1) {\n        return url.substr(0, url.indexOf(';')) + '?' + p;\n      } else {\n        return url;\n      }\n    } else {\n      return url;\n    }\n  },\n  // establishes the connection\n  pingCliqzResults: function(){\n    CliqzUtils.httpHandler('HEAD', CliqzUtils.RESULTS_PROVIDER_PING);\n  },\n  getCliqzResults: function(q, callback){\n    CliqzUtils._sessionSeq++;\n\n    // if the user sees the results more than 500ms we consider that he starts a new query\n    if(CliqzUtils._queryLastDraw && (Date.now() > CliqzUtils._queryLastDraw + 500)){\n      CliqzUtils._queryCount++;\n    }\n    CliqzUtils._queryLastDraw = 0; // reset last Draw - wait for the actual draw\n    CliqzUtils._queryLastLength = q.length;\n\n    var url = CliqzUtils.RESULTS_PROVIDER +\n              encodeURIComponent(q) +\n              CliqzUtils.encodeSessionParams() +\n              CliqzLanguage.stateToQueryString() +\n              CliqzUtils.encodeLocale() +\n              CliqzUtils.encodeResultOrder() +\n              CliqzUtils.encodeCountry() +\n              CliqzUtils.encodeFilter() +\n              CliqzUtils.encodeLocation() +\n              CliqzUtils.encodeResultCount(7) +\n              CliqzUtils.disableWikiDedup();\n\n    var req = CliqzUtils.httpGet(url, function (res) {\n      callback && callback(res, q);\n    });\n\n    // Currently when HPN is live, this guy breaks.\n    if(req) CliqzUtils.requestMonitor.addRequest(req);\n  },\n  // IP driven configuration\n  fetchAndStoreConfig: function(callback){\n    CliqzUtils.httpGet(CliqzUtils.CONFIG_PROVIDER,\n      function(res){\n        if(res && res.response){\n          try {\n            var config = JSON.parse(res.response);\n            for(var k in config){\n              CliqzUtils.setPref('config_' + k, config[k]);\n            }\n          } catch(e){}\n        }\n\n        callback();\n      },\n      callback, //on error the callback still needs to be called\n      2000\n    );\n  },\n  encodeLocale: function() {\n    // send browser language to the back-end\n    return '&locale='+ (CliqzUtils.PREFERRED_LANGUAGE || \"\");\n  },\n  encodeCountry: function() {\n    //international results not supported\n    return '&force_country=true';\n  },\n  disableWikiDedup: function() {\n    // disable wikipedia deduplication on the backend side\n    var doDedup = CliqzUtils.getPref(\"languageDedup\", false);\n    if (doDedup) return '&ddl=0';\n    else return \"\"\n  },\n  encodeFilter: function() {\n    var data = {\n      'conservative': 3,\n      'moderate': 0,\n      'liberal': 1\n    },\n    state = data[CliqzUtils.getPref('adultContentFilter', 'moderate')];\n\n    return '&adult='+state;\n  },\n  encodeResultCount: function(count) {\n    var doDedup = CliqzUtils.getPref(\"languageDedup\", false);\n    count = count || 5;\n    if (doDedup) return '&count=' + count;\n    else return \"\"\n  },\n  encodeResultType: function(type){\n    if(type.indexOf('action') !== -1) return ['T'];\n    else if(type.indexOf('cliqz-results') == 0) return CliqzUtils.encodeCliqzResultType(type);\n    else if(type.indexOf('cliqz-pattern') == 0) return ['C'];\n    else if(type === 'cliqz-extra') return ['X'];\n    else if(type === 'cliqz-series') return ['S'];\n\n    else if(type.indexOf('bookmark') == 0 ||\n            type.indexOf('tag') == 0) return ['B'].concat(CliqzUtils.encodeCliqzResultType(type));\n\n    else if(type.indexOf('favicon') == 0 ||\n            type.indexOf('history') == 0) return ['H'].concat(CliqzUtils.encodeCliqzResultType(type));\n\n    // cliqz type = \"cliqz-custom sources-X\"\n    else if(type.indexOf('cliqz-custom') == 0) return type.substr(21);\n\n    return type; //should never happen\n  },\n  //eg types: [ \"H\", \"m\" ], [ \"H|instant\", \"X|11\" ]\n  isPrivateResultType: function(type) {\n    var onlyType = type[0].split('|')[0];\n    return 'HBTCS'.indexOf(onlyType) != -1 && type.length == 1;\n  },\n  // cliqz type = \"cliqz-results sources-XXXXX\" or \"favicon sources-XXXXX\" if combined with history\n  encodeCliqzResultType: function(type){\n    var pos = type.indexOf('sources-')\n    if(pos != -1)\n      return CliqzUtils.encodeSources(type.substr(pos+8));\n    else\n      return [];\n  },\n  // random ID generated at each urlbar focus\n  _searchSession: '',\n  // number of sequences in each session\n  _sessionSeq: 0,\n  _queryLastLength: null,\n  _queryLastDraw: null,\n  // number of queries in search session\n  _queryCount: null,\n  setSearchSession: function(rand){\n    CliqzUtils._searchSession = rand;\n    CliqzUtils._sessionSeq = 0;\n    CliqzUtils._queryCount = 0;\n    CliqzUtils._queryLastLength = 0;\n    CliqzUtils._queryLastDraw = 0;\n  },\n  encodeSessionParams: function(){\n    if(CliqzUtils._searchSession.length){\n      return '&s=' + encodeURIComponent(CliqzUtils._searchSession) +\n             '&n=' + CliqzUtils._sessionSeq +\n             '&qc=' + CliqzUtils._queryCount\n    } else return '';\n  },\n\n  encodeLocation: function(specifySource, lat, lng) {\n    var qs = [\n     '&loc_pref=',\n     CliqzUtils.getPref('share_location','ask')\n    ].join('')\n\n    if (CLIQZEnvironment.USER_LAT && CLIQZEnvironment.USER_LNG || lat && lng) {\n      qs += [\n        '&loc=',\n        lat || CLIQZEnvironment.USER_LAT,\n        ',',\n        lng || CLIQZEnvironment.USER_LNG,\n        (specifySource ? ',U' : '')\n      ].join('');\n    }\n\n    return qs;\n  },\n  encodeSources: function(sources){\n    return sources.toLowerCase().split(', ').map(\n      function(s){\n        if(s.indexOf('cache') == 0) // to catch 'cache-*' for specific countries\n          return 'd'\n        else\n          return VERTICAL_ENCODINGS[s] || s;\n      });\n  },\n  combineSources: function(internal, cliqz){\n    // do not add extra sources to end of EZs\n    if(internal == \"cliqz-extra\")\n      return internal;\n\n    var cliqz_sources = cliqz.substr(cliqz.indexOf('sources-'))\n    return internal + \" \" + cliqz_sources\n  },\n  isPrivate: CLIQZEnvironment.isPrivate,\n  telemetry: CLIQZEnvironment.telemetry,\n  resultTelemetry: function(query, queryAutocompleted, resultIndex, resultUrl, resultOrder, extra) {\n    CliqzUtils.setResultOrder(resultOrder);\n    var params = encodeURIComponent(query) +\n      (queryAutocompleted ? '&a=' + encodeURIComponent(queryAutocompleted) : '') +\n      '&i=' + resultIndex +\n      (resultUrl ? '&u=' + encodeURIComponent(resultUrl) : '') +\n      CliqzUtils.encodeSessionParams() +\n      CliqzUtils.encodeResultOrder() +\n      (extra ? '&e=' + extra : '')\n    CliqzUtils.httpGet(CliqzUtils.RESULTS_PROVIDER_LOG + params);\n    CliqzUtils.setResultOrder('');\n    CliqzUtils.log(params, 'Utils.resultTelemetry');\n  },\n  _resultOrder: '',\n  setResultOrder: function(resultOrder) {\n    CliqzUtils._resultOrder = resultOrder;\n  },\n  encodeResultOrder: function() {\n    return CliqzUtils._resultOrder && CliqzUtils._resultOrder.length ? '&o=' + encodeURIComponent(JSON.stringify(CliqzUtils._resultOrder)) : '';\n  },\n  setInterval: CLIQZEnvironment.setInterval,\n  setTimeout: CLIQZEnvironment.setTimeout,\n  clearTimeout: CLIQZEnvironment.clearTimeout,\n  clearInterval: CLIQZEnvironment.clearTimeout,\n  locale: {},\n  currLocale: null,\n  loadLocale: function (lang_locale) {\n    if (!CliqzUtils.locale.hasOwnProperty(lang_locale) && !CliqzUtils.locale.hasOwnProperty('default')) {\n      return CliqzUtils.getLocaleFile(encodeURIComponent(lang_locale), lang_locale).catch(function() {\n        // We did not find the full locale (e.g. en-GB): let's try just the\n        // language!\n        var loc = CliqzUtils.getLanguageFromLocale(lang_locale);\n        return CliqzUtils.getLocaleFile(loc, lang_locale).catch(function () {\n          // The default language\n          return CliqzUtils.getLocaleFile('de', 'default');\n        });\n      });\n    }\n  },\n  getLocaleFile: function (locale_path, locale_key) {\n    return new Promise (function (resolve, reject) {\n      CliqzUtils.loadResource(CLIQZEnvironment.LOCALE_PATH + locale_path + '/cliqz.json',\n        function(req) {\n            if (CliqzUtils){\n              if (locale_key !== 'default') {\n                CliqzUtils.currLocale = locale_key;\n              }\n              CliqzUtils.locale[locale_key] = JSON.parse(req.response);\n              resolve();\n            }\n        },\n        reject\n      );\n    });\n  },\n  getLanguageFromLocale: function(locale){\n    return locale.match(/([a-z]+)(?:[-_]([A-Z]+))?/)[1];\n  },\n  getLanguage: function(win){\n    return CliqzUtils.LANGS[CliqzUtils.getLanguageFromLocale(win.navigator.language)] || 'en';\n  },\n  getLocalizedString: function(key, substitutions){\n    if(!key) return '';\n\n    var str = key,\n        localMessages;\n\n    if (CliqzUtils.currLocale != null && CliqzUtils.locale[CliqzUtils.currLocale]\n            && CliqzUtils.locale[CliqzUtils.currLocale][key]) {\n        str = CliqzUtils.locale[CliqzUtils.currLocale][key].message;\n        localMessages = CliqzUtils.locale[CliqzUtils.currLocale];\n    } else if (CliqzUtils.locale.default && CliqzUtils.locale.default[key]) {\n        str = CliqzUtils.locale.default[key].message;\n        localMessages = CliqzUtils.locale.default;\n    }\n\n    if (!substitutions) {\n      substitutions = [];\n    }\n    if (!Array.isArray(substitutions)) {\n      substitutions = [substitutions];\n    }\n\n    function replacer(matched, index, dollarSigns) {\n      if (index) {\n        index = parseInt(index, 10) - 1;\n        return index in substitutions ? substitutions[index] : \"\";\n      } else {\n        // For any series of contiguous `$`s, the first is dropped, and\n        // the rest remain in the output string.\n        return dollarSigns;\n      }\n    }\n    return str.replace(/\\$(?:([1-9]\\d*)|(\\$+))/g, replacer);\n  },\n  // gets all the elements with the class 'cliqz-locale' and adds\n  // the localized string - key attribute - as content\n  localizeDoc: function(doc){\n    var locale = doc.getElementsByClassName('cliqz-locale');\n    for(var i = 0; i < locale.length; i++){\n        var el = locale[i];\n        el.textContent = CliqzUtils.getLocalizedString(el.getAttribute('key'));\n    }\n  },\n  extensionRestart: function(changes){\n    var enumerator = Services.wm.getEnumerator('navigator:browser');\n    while (enumerator.hasMoreElements()) {\n      var win = enumerator.getNext();\n      if(win.CLIQZ && win.CLIQZ.Core){\n        win.CLIQZ.Core.unload(true);\n      }\n    }\n\n    changes && changes();\n\n    var corePromises = [];\n    enumerator = Services.wm.getEnumerator('navigator:browser');\n    while (enumerator.hasMoreElements()) {\n      var win = enumerator.getNext();\n      if(win.CLIQZ && win.CLIQZ.Core){\n        corePromises.push(win.CLIQZ.Core.init());\n      }\n    }\n\n    return Promise.all(corePromises);\n  },\n  isWindows: function(){\n    return CLIQZEnvironment.OS.indexOf(\"win\") === 0;\n  },\n  isMac: function(){\n    return CLIQZEnvironment.OS.indexOf(\"darwin\") === 0;\n  },\n  isLinux: function() {\n    return CLIQZEnvironment.OS.indexOf(\"linux\") === 0;\n  },\n  getWindow: CLIQZEnvironment.getWindow,\n  getWindowID: CLIQZEnvironment.getWindowID,\n  hasClass: function(element, className) {\n    return (' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1;\n  },\n  /**\n   * Bind functions contexts to a specified object.\n   * @param {Object} from - An object, whose function properties will be processed.\n   * @param {Object} to - An object, which will be the context (this) of processed functions.\n   */\n  bindObjectFunctions: function(from, to) {\n    for (var funcName in from) {\n      var func = from[funcName];\n      if (!from.hasOwnProperty(funcName))\n        continue;\n      // Can't compare with prototype of object from a different module.\n      if (typeof func != \"function\")\n        continue;\n      from[funcName] = func.bind(to);\n    }\n  },\n  tryDecodeURIComponent: function(s) {\n    // avoide error from decodeURIComponent('%2')\n    try {\n      return decodeURIComponent(s);\n    } catch(e) {\n      return s;\n    }\n  },\n  tryEncodeURIComponent: function(s) {\n    try {\n      return encodeURIComponent(s);\n    } catch(e) {\n      return s;\n    }\n  },\n  parseQueryString: function(qstr) {\n    var query = {};\n    var a = (qstr || '').split('&');\n    for (var i in a)\n    {\n      var b = a[i].split('=');\n      query[CliqzUtils.tryDecodeURIComponent(b[0])] = CliqzUtils.tryDecodeURIComponent(b[1]);\n    }\n\n    return query;\n  },\n  roundToDecimal: function(number, digits) {\n    var multiplier = Math.pow(10, digits);\n    return Math.round(number * multiplier) / multiplier;\n  },\n  getAdultFilterState: function(){\n    var data = {\n      'conservative': {\n              name: CliqzUtils.getLocalizedString('always'),\n              selected: false\n      },\n      'moderate': {\n              name: CliqzUtils.getLocalizedString('always_ask'),\n              selected: false\n      },\n      'liberal': {\n          name: CliqzUtils.getLocalizedString('never'),\n          selected: false\n      }\n    };\n\n    data[CliqzUtils.getPref('adultContentFilter', 'moderate')].selected = true;\n\n    return data;\n  },\n  getNoResults: CLIQZEnvironment.getNoResults,\n  getParameterByName: function(name, location) {\n    name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\n    results = regex.exec(location.search);\n    return results === null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n  }\n};\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzUtils;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzUtils\n\n","// start module CliqzABTests\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module implements a mechanism which enables/disables AB tests\n *\n */\n\nvar EXPORTED_SYMBOLS = ['CliqzABTests'];\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nvar timer=null, ONE_HOUR = 60 * 60 * 1000;\n\nfunction log(msg){\n  CliqzUtils.log(msg, \"CliqzABTests.jsm\");\n}\n\nvar CliqzABTests = {\n    PREF: 'ABTests',\n    PREF_OVERRIDE: 'ABTestsOverride',\n    URL: 'https://logging.cliqz.com/abtests/check?session=',\n    init: function(){\n        CliqzABTests.check();\n\n    },\n    unload: function(){\n        CliqzUtils.clearTimeout(timer);\n    },\n    // Accessors to list of tests this user is current in\n    getCurrent: function() {\n        if(CliqzUtils.hasPref(CliqzABTests.PREF))\n            return JSON.parse(CliqzUtils.getPref(CliqzABTests.PREF));\n        return undefined;\n    },\n    setCurrent: function(tests) {\n        CliqzUtils.setPref(CliqzABTests.PREF, JSON.stringify(tests))\n    },\n\n    // Accessors to list of tests in override list\n    getOverride: function() {\n        if(CliqzUtils.hasPref(CliqzABTests.PREF_OVERRIDE)) {\n            var ABtests = JSON.parse(CliqzUtils.getPref(CliqzABTests.PREF_OVERRIDE));\n            return ABtests;\n        }\n        return undefined;\n    },\n    setOverride: function(tests) {\n        if(tests)\n            CliqzUtils.setPref(CliqzABTests.PREF_OVERRIDE, JSON.stringify(tests));\n        else\n            CliqzUtils.clearPref(CliqzABTests.PREF_OVERRIDE);\n    },\n\n    // Check for newest list of AB tests from server\n    check: function() {\n        log('AB checking');\n        // clear the last timer\n        CliqzUtils.clearTimeout(timer);\n        // set a new timer to be triggered after 1 hour\n        timer = CliqzUtils.setTimeout(CliqzABTests.check, ONE_HOUR);\n\n        CliqzABTests.retrieve(\n            function(response){\n                try{\n                    var prevABtests = {};\n                    if(CliqzUtils.hasPref(CliqzABTests.PREF))\n                        prevABtests = JSON.parse(CliqzUtils.getPref(CliqzABTests.PREF));\n\n                    var respABtests = JSON.parse(response.responseText);\n\n                    // Override the backend response - for local testing\n                    var overrideABtests = CliqzABTests.getOverride();\n                    if(overrideABtests)\n                        respABtests = overrideABtests;\n\n                    var newABtests = {};\n\n                    var changes = false; // any changes?\n\n                    // find old AB tests to leave\n                    for(var o in prevABtests) {\n                        if(!respABtests[o]) {\n                            if(CliqzABTests.leave(o))\n                                changes = true;\n                        }\n                        else {\n                            // keep this old test in the list of current tests\n                            newABtests[o] = prevABtests[o]\n                        }\n                    }\n\n                    // find new AB tests to enter\n                    for(var n in respABtests) {\n                        if(!(prevABtests[n])) {\n                            if(CliqzABTests.enter(n, respABtests[n])) {\n                                changes = true;\n                                newABtests[n] = respABtests[n];\n                            }\n                        }\n                    }\n\n                    if(changes) {\n                        CliqzUtils.setPref(CliqzABTests.PREF, JSON.stringify(newABtests))\n                    }\n                } catch(e){\n                  log('retrieve error: ' + e.message)\n                }\n            });\n    },\n    retrieve: function(callback) {\n        var url = CliqzABTests.URL + encodeURIComponent(CliqzUtils.getPref('session',''));\n\n        var onerror = function(){ log(\"failed to retrieve AB test data\"); }\n\n        CliqzUtils.httpGet(url, callback, onerror, 15000);\n    },\n    enter: function(abtest, payload) {\n        // Add new AB tests here.\n        // It is safe to remove them as soon as the test is over.\n        var rule_executed = true\n        switch(abtest) {\n            case \"1024_B\":\n                CliqzUtils.setPref(\"categoryAssessment\", true);\n                break;\n            case \"1028_A\":\n                CliqzUtils.setPref(\"humanWeb\", false);\n                break;\n            case \"1028_B\":\n                CliqzUtils.setPref(\"humanWeb\", true);\n                break;\n            case \"1032_A\":\n                CliqzUtils.setPref(\"spellCorrMessage\", false);\n                break;\n            case \"1032_B\":\n                CliqzUtils.setPref(\"spellCorrMessage\", true);\n                break;\n            case \"1036_B\":\n                CliqzUtils.setPref(\"extended_onboarding_same_result\", true);\n                break;\n            case \"1045_A\":\n                break;\n            case \"1045_B\":\n                CliqzUtils.setPref(\"antiTrackTest\", true);\n                break;\n            case \"1046_B\":\n                CliqzUtils.setPref(\"attrackBlockCookieTracking\", true);\n                break;\n            case \"1047_B\":\n                CliqzUtils.setPref(\"attrackRemoveQueryStringTracking\", true);\n                break;\n            case \"1048_B\":\n                CliqzUtils.setPref(\"attrackAlterPostdataTracking\", true);\n                break;\n            case \"1049_B\":\n                CliqzUtils.setPref(\"attrackCanvasFingerprintTracking\", true);\n                break;\n            case \"1050_B\":\n                CliqzUtils.setPref(\"attrackRefererTracking\", true);\n                break;\n            case \"1051_B\":\n                CliqzUtils.setPref(\"antiTrackTest\", true);\n                break;\n            case \"1052_A\":\n                CliqzUtils.setPref(\"attrackBlockCookieTracking\", false);\n                break;\n            case \"1052_B\":\n                CliqzUtils.setPref(\"attrackBlockCookieTracking\", true);\n                break;\n            case \"1053_A\":\n                CliqzUtils.setPref(\"attrackRemoveQueryStringTracking\", false);\n                break;\n            case \"1053_B\":\n                CliqzUtils.setPref(\"attrackRemoveQueryStringTracking\", true);\n                break;\n            case \"1055_B\":\n                CliqzUtils.setPref(\"unblockMode\", \"always\");\n                break;\n            case \"1056_A\":\n                CliqzUtils.setPref(\"freshTabAB\", false);\n                break;\n            case \"1056_B\":\n                CliqzUtils.setPref(\"freshTabAB\", true);\n                break;\n            case \"1057_A\":\n                CliqzUtils.setPref(\"trackerTxt\", false);\n                break;\n            case \"1057_B\":\n                CliqzUtils.setPref(\"trackerTxt\", true);\n                break;\n            case \"1058_A\":\n                CliqzUtils.setPref(\"unblockMode\", \"never\");\n                break;\n            case \"1058_B\":\n                CliqzUtils.setPref(\"unblockMode\", \"always\");\n                break;\n            case \"1059_A\":\n                CliqzUtils.setPref(\"attrack.local_tracking\", false);\n                break;\n            case \"1059_B\":\n                CliqzUtils.setPref(\"attrack.local_tracking\", true);\n                break;\n            case \"1060_A\":\n                CliqzUtils.setPref(\"attrackBloomFilter\", false);\n                break;\n            case \"1060_B\":\n                CliqzUtils.setPref(\"attrackBloomFilter\", true);\n                break;\n            case \"1061_A\":\n                CliqzUtils.setPref(\"attrackUI\", false);\n                break;\n            case \"1061_B\":\n                CliqzUtils.setPref(\"attrackUI\", true);\n                break;\n            case \"1063_A\":\n                CliqzUtils.setPref(\"double-enter2\", false);\n                break;\n            case \"1063_B\":\n                CliqzUtils.setPref(\"double-enter2\", true);\n                break;\n            case \"1064_A\":\n                CliqzUtils.setPref(\"attrackDefaultAction\", \"same\");\n                break;\n            case \"1064_B\":\n                CliqzUtils.setPref(\"attrackDefaultAction\", \"placeholder\");\n                break;\n            case \"1064_C\":\n                CliqzUtils.setPref(\"attrackDefaultAction\", \"block\");\n                break;\n            case \"1064_D\":\n                CliqzUtils.setPref(\"attrackDefaultAction\", \"empty\");\n                break;\n            case \"1064_E\":\n                CliqzUtils.setPref(\"attrackDefaultAction\", \"replace\");\n                break;\n            case \"1065_A\":\n                CliqzUtils.setPref(\"freshTabNewsEmail\", false);\n                break;\n            case \"1065_B\":\n                CliqzUtils.setPref(\"freshTabNewsEmail\", true);\n                break;\n            case \"1066_A\":\n                CliqzUtils.setPref(\"proxyNetwork\", false);\n                break;\n            case \"1066_B\":\n                CliqzUtils.setPref(\"proxyNetwork\", true);\n                break;\n            case \"1067_B\":\n                CliqzUtils.setPref(\"attrackProxyTrackers\", true);\n                break;\n            case \"1068_A\":\n                CliqzUtils.setPref(\"languageDedup\", false);\n                break;\n            case \"1068_B\":\n                CliqzUtils.setPref(\"languageDedup\", true);\n                break;\n            case \"1069_A\":\n                CliqzUtils.setPref(\"grOfferSwitchFlag\", false);\n                break;\n            case \"1069_B\":\n                CliqzUtils.setPref(\"grOfferSwitchFlag\", true);\n                break;\n            case \"1070_A\":\n                CliqzUtils.setPref(\"cliqz-anti-phishing\", false);\n                CliqzUtils.setPref(\"cliqz-anti-phishing-enabled\", false);\n                break;\n            case \"1070_B\":\n                CliqzUtils.setPref(\"cliqz-anti-phishing\", true);\n                CliqzUtils.setPref(\"cliqz-anti-phishing-enabled\", true);\n                break;\n            case \"1071_A\":\n                CliqzUtils.setPref(\"browser.privatebrowsing.apt\", false, '');\n                break;\n            case \"1071_B\":\n                CliqzUtils.setPref(\"browser.privatebrowsing.apt\", true, '');\n                break;\n            case \"1072_A\":\n                CliqzUtils.setPref(\"grFeatureEnabled\", false);\n                break;\n            case \"1072_B\":\n                CliqzUtils.setPref(\"grFeatureEnabled\", true);\n            case \"1073_A\":\n                CliqzUtils.setPref(\"history.timeouts\", false);\n                break;\n            case \"1073_B\":\n                CliqzUtils.setPref(\"history.timeouts\", true);\n                break;\n            case \"1074_A\":\n                CliqzUtils.setPref(\"cliqz-adb-abtest\", false);\n                break;\n            case \"1074_B\":\n                CliqzUtils.setPref(\"cliqz-adb-abtest\", true);\n                break;\n            default:\n                rule_executed = false;\n        }\n        if(rule_executed) {\n            var action = {\n                type: 'abtest',\n                action: 'enter',\n                name: abtest\n            };\n            CliqzUtils.telemetry(action);\n\n            return true;\n       } else {\n            return false;\n       }\n    },\n    leave: function(abtest, disable) {\n        // Restore defaults after an AB test is finished.\n        // DO NOT remove test cleanup code too quickly, a user\n        // might not start the browser for a long time and\n        // get stuck in a test if we remove cases too early.\n        var rule_executed = true;\n        switch(abtest) {\n            case \"1024_B\":\n                CliqzUtils.clearPref(\"categoryAssessment\");\n                break;\n            case \"1028_A\":\n            case \"1028_B\":\n                CliqzUtils.clearPref(\"humanWeb\");\n                break;\n            case \"1032_A\":\n            case \"1032_B\":\n                CliqzUtils.clearPref(\"spellCorrMessage\");\n                break;\n            case \"1036_A\":\n            case \"1036_B\":\n                CliqzUtils.clearPref(\"extended_onboarding_same_result\");\n                CliqzUtils.clearPref(\"extended_onboarding\");\n                break;\n            case \"1045_A\":\n            case \"1045_B\":\n                CliqzUtils.clearPref(\"antiTrackTest\");\n                break;\n            case \"1046_A\":\n            case \"1047_A\":\n            case \"1048_A\":\n            case \"1049_A\":\n            case \"1050_A\":\n                break;\n            case \"1046_B\":\n                CliqzUtils.clearPref(\"attrackBlockCookieTracking\");\n                break;\n            case \"1047_B\":\n                CliqzUtils.clearPref(\"attrackRemoveQueryStringTracking\");\n                break;\n            case \"1048_B\":\n                CliqzUtils.clearPref(\"attrackAlterPostdataTracking\");\n                break;\n            case \"1049_B\":\n                CliqzUtils.clearPref(\"attrackCanvasFingerprintTracking\");\n                break;\n            case \"1050_B\":\n                CliqzUtils.clearPref(\"attrackRefererTracking\");\n                break;\n            case \"1051_B\":\n                CliqzUtils.clearPref(\"antiTrackTest\");\n                break;\n            case \"1052_B\":\n                CliqzUtils.clearPref(\"attrackBlockCookieTracking\");\n                break;\n            case \"1053_B\":\n                CliqzUtils.clearPref(\"attrackRemoveQueryStringTracking\");\n                break;\n            case \"1055_A\":\n            case \"1055_B\":\n                CliqzUtils.clearPref(\"unblockEnabled\");\n                break;\n            case \"1056_A\":\n            case \"1056_B\":\n                CliqzUtils.clearPref(\"freshTabAB\");\n                break;\n            case \"1057_B\":\n                CliqzUtils.clearPref(\"trackerTxt\");\n                break;\n            case \"1058_A\":\n            case \"1058_B\":\n                CliqzUtils.clearPref(\"unblockMode\");\n                break;\n            case \"1059_A\":\n            case \"1059_B\":\n                CliqzUtils.clearPref(\"attrack.local_tracking\");\n                break;\n            case \"1060_A\":\n            case \"1060_B\":\n                CliqzUtils.clearPref(\"attrackBloomFilter\");\n                break;\n            case \"1061_A\":\n            case \"1061_B\":\n                CliqzUtils.clearPref(\"attrackUI\");\n                break;\n            case \"1063_A\":\n            case \"1063_B\":\n                CliqzUtils.clearPref(\"double-enter2\");\n                break;\n            case \"1064_A\":\n            case \"1064_B\":\n            case \"1064_C\":\n            case \"1064_D\":\n            case \"1064_E\":\n                CliqzUtils.clearPref(\"attrackDefaultAction\");\n                break;\n            case \"1066_A\":\n            case \"1066_B\":\n                CliqzUtils.clearPref(\"proxyNetwork\");\n                break;\n            case \"1065_A\":\n            case \"1065_B\":\n                CliqzUtils.clearPref(\"freshTabNewsEmail\");\n                break;\n            case \"1067_B\":\n                CliqzUtils.clearPref(\"attrackProxyTrackers\");\n                break;\n            case \"1068_A\":\n            case \"1068_B\":\n                CliqzUtils.clearPref(\"languageDedup\");\n                break;\n            case \"1069_A\":\n            case \"1069_B\":\n                CliqzUtils.clearPref(\"grOfferSwitchFlag\");\n            break;\n            case \"1070_A\":\n            case \"1070_B\":\n                CliqzUtils.clearPref('cliqz-anti-phishing');\n                CliqzUtils.clearPref('cliqz-anti-phishing-enabled');\n                break;\n            case \"1071_A\":\n            case \"1071_B\":\n                CliqzUtils.clearPref('browser.privatebrowsing.apt', '');\n                break\n            case \"1072_A\":\n            case \"1072_B\":\n              CliqzUtils.clearPref('grFeatureEnabled');\n              break;\n            case \"1073_A\":\n            case \"1073_B\":\n              CliqzUtils.clearPref('history.timeouts');\n              break;\n            case \"1074_A\":\n            case \"1074_B\":\n                CliqzUtils.clearPref('cliqz-adb-abtest');\n                break;\n            default:\n                rule_executed = false;\n        }\n        if(rule_executed) {\n            var action = {\n                type: 'abtest',\n                action: 'leave',\n                name: abtest,\n                disable: disable\n            };\n            CliqzUtils.telemetry(action);\n            return true;\n       } else {\n            return false;\n       }\n    },\n    disable: function(abtest) {\n        // Disable an AB test but do not remove it from list of active AB tests,\n        // this is intended to be used by the extension itself when it experiences\n        // an error associated with this AB test.\n        if(CliqzUtils.hasPref(CliqzABTests.PREF)) {\n             var curABtests = JSON.parse(CliqzUtils.getPref(CliqzABTests.PREF));\n\n            if(curABtests[abtest] && CliqzABTests.leave(abtest, true)) {\n                // mark as disabled and save back to preferences\n                curABtests[abtest].disabled = true;\n                CliqzUtils.setPref(CliqzABTests.PREF, JSON.stringify(curABtests))\n            }\n        }\n    },\n}\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzABTests;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzABTests\n\n","// start module CliqzAutocomplete\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module implements the core functionality based on nsIAutoCompleteResult interface\n * http://mxr.mozilla.org/mozilla-central/source/toolkit/components/autocomplete/nsIAutoCompleteResult.idl\n */\n\nvar EXPORTED_SYMBOLS = ['CliqzAutocomplete'];\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/Mixer.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'Result',\n  'chrome://cliqzmodules/content/Result.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzResultProviders',\n  'chrome://cliqzmodules/content/CliqzResultProviders.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzCalculator',\n  'chrome://cliqzmodules/content/CliqzCalculator.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzHistoryCluster',\n  'chrome://cliqzmodules/content/CliqzHistoryCluster.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzSpellCheck',\n  'chrome://cliqzmodules/content/CliqzSpellCheck.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'NewTabUtils',\n  'resource://gre/modules/NewTabUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzEvents',\n  'chrome://cliqzmodules/content/CliqzEvents.jsm');\n\nfunction isQinvalid(q){\n    //TODO: add more\n    if(q.indexOf('view-source:') === 0) return true;\n\n    return false;\n}\n\nvar CliqzAutocomplete = {\n    LOG_KEY: 'CliqzAutocomplete',\n    TIMEOUT: 1000,\n    HISTORY_TIMEOUT: 200,\n    SCROLL_SIGNAL_MIN_TIME: 500,\n    lastPattern: null,\n    lastSearch: '',\n    lastResult: null,\n    lastSuggestions: null,\n    lastResultHeights: [],\n    hasUserScrolledCurrentResults: false, // set to true whenever user scrolls, set to false when new results are shown\n    lastResultsUpdateTime: null, // to measure how long a result has been shown for\n    resultsOverflowHeight: 0, // to determine if scrolling is possible (i.e., overflow > 0px)\n    afterQueryCount: 0,\n    discardedResults: 0,\n    isPopupOpen: false,\n    lastPopupOpen: null,\n    lastQueryTime: null,\n    lastDisplayTime: null,\n    lastFocusTime: null,\n    highlightFirstElement: false,\n    spellCorrectionDict: {},\n    spellCorr: {\n        'on': false,\n        'correctBack': {},\n        'override': false,\n        'pushed': null,\n        'userConfirmed': false,\n        'searchTerms': []\n    },\n    init: function(){\n        CliqzUtils.init();\n        CliqzAutocomplete.initProvider();\n        CliqzAutocomplete.initResults();\n\n        XPCOMUtils.defineLazyServiceGetter(CliqzAutocomplete.CliqzResults.prototype, 'historyAutoCompleteProvider',\n                  '@mozilla.org/autocomplete/search;1?name=history', 'nsIAutoCompleteSearch');\n\n        var reg = Components.manager.QueryInterface(Components.interfaces.nsIComponentRegistrar);\n        var CONTRACT_ID = CliqzAutocomplete.CliqzResults.prototype.contractID;\n        try{\n            reg.unregisterFactory(\n                reg.contractIDToCID(CONTRACT_ID),\n                reg.getClassObjectByContractID(CONTRACT_ID, Ci.nsISupports)\n            )\n        }catch(e){}\n        var cp = CliqzAutocomplete.CliqzResults.prototype;\n        var factory = XPCOMUtils.generateNSGetFactory([CliqzAutocomplete.CliqzResults])(cp.classID);\n        reg.registerFactory(cp.classID, cp.classDescription, cp.contractID, factory);\n\n        // populate so we have them for topsites dropdown\n        NewTabUtils.links.populateCache();\n\n        CliqzUtils.log('initialized', CliqzAutocomplete.LOG_KEY);\n    },\n    unload: function() {\n        var reg = Components.manager.QueryInterface(Components.interfaces.nsIComponentRegistrar);\n        var CONTRACT_ID = CliqzAutocomplete.CliqzResults.prototype.contractID;\n        try{\n          reg.unregisterFactory(\n            reg.contractIDToCID(CONTRACT_ID),\n            reg.getClassObjectByContractID(CONTRACT_ID, Ci.nsISupports)\n          );\n        }catch(e){}\n    },\n    getResultsOrder: function(results){\n        return CliqzAutocomplete.prepareResultOrder(results);\n    },\n    // SOURCE: https://developer.mozilla.org/en-US/docs/How_to_implement_custom_autocomplete_search_component\n    ProviderAutoCompleteResultCliqz: function(searchString, searchResult,\n        defaultIndex, errorDescription) {\n        this._searchString = searchString;\n        this._searchResult = searchResult;\n        this._defaultIndex = defaultIndex;\n    },\n    // SOURCE: http://mxr.mozilla.org/mozilla-central/source/toolkit/components/autocomplete/nsIAutoCompleteResult.idl\n    CliqzResults: function(){},\n    resetSpellCorr: function() {\n        CliqzAutocomplete.spellCorr = {\n            'on': false,\n            'correctBack': {},\n            'override': false,\n            'pushed': null,\n            'userConfirmed': false,\n            'searchTerms': []\n        }\n    },\n    fetchTopSites: function() {\n        var results = NewTabUtils.links.getLinks().filter(function(r){ return r !== null; }).slice(0, 5);\n        if(results.length > 0) {\n            var top = Result.generic('cliqz-extra', '', null, '', null, '', null, JSON.stringify({topsites:true}));\n            top.data.title = CliqzUtils.getLocalizedString('topSitesTitle');\n            top.data.message = CliqzUtils.getLocalizedString('topSitesMessage');\n            top.data.message1 = CliqzUtils.getLocalizedString('topSitesMessage1');\n            top.data.cliqz_logo = CLIQZEnvironment.SKIN_PATH + 'img/cliqz.svg';\n            top.data.lastQ = CliqzUtils.getWindow().gBrowser.selectedTab.cliqz;\n            top.data.url = results[0].url;\n            top.data.template = 'topsites';\n            top.data.urls = results.map(function(r) {\n                var urlDetails = CliqzUtils.getDetailsFromUrl(r.url),\n                    logoDetails = CliqzUtils.getLogoDetails(urlDetails);\n\n                // show all subdomains (except for \"www\"), name, and tld (e.g., \"mail.google.com\")\n                var nameComponents = [];\n                for (var i = 0; i < urlDetails.subdomains.length; i++) {\n                    if (urlDetails.subdomains[i] != 'www') {\n                        nameComponents.push(urlDetails.subdomains[i]);\n                    }\n                }\n                nameComponents.push(urlDetails.name, urlDetails.tld);\n\n                return {\n                  url: r.url,\n                  href: r.url.replace(urlDetails.path, ''),\n                  link: r.url.replace(urlDetails.path, ''),\n                  name: r.title ? r.title: nameComponents.join('.'),\n                  text: logoDetails.text,\n                  style: logoDetails.style,\n                  extra: \"top-sites-\" + i\n                }\n            });\n            return top;\n        }\n        return [];\n    },\n    initProvider: function(){\n        CliqzAutocomplete.ProviderAutoCompleteResultCliqz.prototype = {\n            _searchString: '',\n            _searchResult: 0,\n            _defaultIndex: 0,\n            _errorDescription: '',\n            _results: [],\n\n            get searchString() { return this._searchString; },\n            get searchResult() { return this._searchResult; },\n            get defaultIndex() { return this._defaultIndex; },\n            get errorDescription() { return this._errorDescription; },\n            get matchCount() { return this._results.length; },\n            getValueAt: function(index) { return (this._results[index] || {}).val; },\n            getFinalCompleteValueAt: function(index) { return null; }, //FF31+\n            getCommentAt: function(index) { return (this._results[index] || {}).comment; },\n            getStyleAt: function(index) { return (this._results[index] || {}).style; },\n            getImageAt: function (index) { return ''; },\n            getLabelAt: function(index) { return (this._results[index] || {}).label; },\n            getDataAt: function(index) { return (this._results[index] || {}).data; },\n            QueryInterface: XPCOMUtils.generateQI([  ]),\n            setResults: function(results){\n\n                this._results = this.filterUnexpected(results);\n\n                CliqzAutocomplete.lastResult = this;\n                CliqzEvents.pub('autocomplete.new_result', { result: this, isPopupOpen: CliqzAutocomplete.isPopupOpen });\n                var order = CliqzAutocomplete.getResultsOrder(this._results);\n                CliqzUtils.setResultOrder(order);\n\n                // flag for rendering to avoid rendering of \"unmixed\" results\n                this.isMixed = true;\n            },\n\n            filterUnexpected: function(results){\n                // filter out ununsed/unexpected results\n                var ret=[];\n                for(var i=0; i < results.length; i++){\n                    var r = results[i];\n                    if(r.style == 'cliqz-extra'){\n                        if(r.data){\n                            // override the template if the superTemplate is known\n                            if(CLIQZEnvironment.isUnknownTemplate(r.data.template)){\n                                // unexpected/unknown template\n                                continue;\n                            }\n                        }\n                    }\n\n                    // If one of the results is data.only = true Remove all others.\n                    // if (!r.invalid && r.data && r.data.only) {\n                    //  return [r];\n                    //}\n\n                    ret.push(r);\n                }\n                return ret;\n            }\n        }\n    },\n    // a result is done once a new result comes in, or once the popup closes\n    markResultsDone: function(newResultsUpdateTime) {\n        // is there a result to be marked as done?\n        if (CliqzAutocomplete.lastResultsUpdateTime) {\n            var resultsDisplayTime = Date.now() - CliqzAutocomplete.lastResultsUpdateTime;\n            this.sendResultsDoneSignal(resultsDisplayTime);\n        }\n        // start counting elapsed time anew\n        CliqzAutocomplete.lastResultsUpdateTime = newResultsUpdateTime;\n        CliqzAutocomplete.hasUserScrolledCurrentResults = false;\n    },\n    sendResultsDoneSignal: function(resultsDisplayTime) {\n        // reduced traffic: only consider telemetry data if result was shown long enough (e.g., 0.5s)\n        if (resultsDisplayTime > CliqzAutocomplete.SCROLL_SIGNAL_MIN_TIME) {\n            var action = {\n                type: 'activity',\n                action: 'results_done',\n                has_user_scrolled: CliqzAutocomplete.hasUserScrolledCurrentResults,\n                results_display_time: resultsDisplayTime,\n                results_overflow_height: CliqzAutocomplete.resultsOverflowHeight,\n                can_user_scroll: CliqzAutocomplete.resultsOverflowHeight > 0\n            };\n            CliqzUtils.telemetry(action);\n        }\n    },\n    // returns array of result kinds, adding each result's\n    // height in terms of occupied dropdown slots (1-3) as\n    // parameter (e.g., [\"C|{\\\"h\\\":1}\"],[\"m|{\\\"h\\\":1}\"])\n    prepareResultOrder: function (results) {\n        // heights is updated in UI's handleResults\n        var heights = CliqzAutocomplete.lastResultHeights,\n            resultOrder = [];\n\n        if (results) {\n            for(var i = 0; i < results.length; i++) {\n                if(results[i].data == null || results[i].data.kind == null){\n                  resultOrder.push('_'); //debug - it should not happen\n                  continue;\n                }\n\n                var kind   = results[i].data.kind.slice(0),\n                    tokens = kind && kind.length > 0 ?\n                             kind[0].split('|') : [],\n                    params = tokens.length > 1 ?\n                             JSON.parse(tokens[1]) : {};\n\n                params.h = i < heights.length ?\n                           heights[i] : 0;\n                kind[0] =\n                    tokens[0] + '|' + JSON.stringify(params);\n                resultOrder.push(kind);\n            }\n        }\n\n        return resultOrder;\n    },\n    initResults: function(){\n        CliqzAutocomplete.CliqzResults.prototype = {\n            resultsTimer: null,\n            historyTimer: null,\n            historyTimeout: false,\n            instant: [],\n\n            historyTimeoutCallback: function(params) {\n                CliqzUtils.log('history timeout', CliqzAutocomplete.LOG_KEY);\n                this.historyTimeout = true;\n                // History timed out but maybe we have some results already\n                // So show what you have - AB 1073\n                if (this.historyResults && CliqzUtils.getPref(\"history.timeouts\", false)) {\n                    CliqzHistoryCluster.addFirefoxHistory(this.historyResults);\n                    CliqzUtils.log('historyTimeoutCallback: push collected results:' + this.historyResults.results.length, CliqzAutocomplete.LOG_KEY);\n                } else {\n                    this.pushResults(this.searchString);\n                }\n            },\n            onHistoryDone: function(result, resultExtra) {\n                if(!this.startTime) {\n                    return; // no current search, just discard\n                }\n\n                var now = Date.now();\n\n\n                this.historyResults = result;\n                this.latency.history = now - this.startTime;\n\n                //CliqzUtils.log(\"history results: \" + (result ? result.matchCount : \"null\") + \"; done: \" + this.isHistoryReady() +\n                //               \"; time: \" + (now - this.startTime), CliqzAutocomplete.LOG_KEY)\n                // Choose an instant result if we have all history results (timeout)\n                // and we haven't already chosen one\n                if(result && (this.isHistoryReady() || this.historyTimeout) && this.mixedResults.matchCount == 0) {\n                    CliqzUtils.clearTimeout(this.historyTimer);\n                    CliqzHistoryCluster.addFirefoxHistory(result);\n                }\n            },\n            isHistoryReady: function() {\n                return this.historyResults && this.historyResults.ready;\n            },\n            historyPatternCallback: function(res) {\n                // abort if we already have results\n                if(this.mixedResults.matchCount > 0) return;\n\n                if (res.query == this.searchString) {\n                    CliqzAutocomplete.lastPattern = res;\n\n                    var latency = 0;\n                    if (CliqzHistoryCluster.latencies[res.query]) {\n                        latency = (new Date()).getTime() - CliqzHistoryCluster.latencies[res.query];\n                    }\n                    this.latency.patterns = latency;\n\n                    // Create instant result\n                    CliqzHistoryCluster.createInstantResult(res, this.searchString, this.createInstantResultCallback);\n                }\n            },\n            createInstantResultCallback:function(instant) {\n                this.instant = instant;\n\n                this.pushResults(this.searchString);\n            },\n            pushTimeoutCallback: function(params) {\n                CliqzUtils.log(\"pushTimeoutCallback\", CliqzAutocomplete.LOG_KEY);\n                this.pushResults(params);\n            },\n            // checks if all the results are ready or if the timeout is exceeded\n            pushResults: function(q) {\n                if(q == this.searchString && this.startTime != null){ // be sure this is not a delayed result\n                    var now = Date.now();\n\n                    if((now > this.startTime + CliqzAutocomplete.TIMEOUT) || // 1s timeout\n                       (this.isHistoryReady() || this.historyTimeout) && // history is ready or timed out\n                       this.cliqzResults) { // all results are ready\n                        /// Push full result\n                        CliqzUtils.clearTimeout(this.resultsTimer);\n                        CliqzUtils.clearTimeout(this.historyTimer);\n                        this.mixResults(false);\n\n                        this.latency.mixed = Date.now() - this.startTime;\n\n                        this.callback(this.mixedResults, this);\n\n                        this.latency.all = Date.now() - this.startTime;\n\n                        // delay wrapping to make sure rendering is complete\n                        // otherwise we don't get up to date autocomplete stats\n                        CliqzUtils.setTimeout(this.fullWrapup, 0, this);\n\n                        return;\n                    } else if(this.isHistoryReady()) {\n                        /// Push instant result\n                        this.latency.mixed = Date.now() - this.startTime;\n\n                        this.mixResults(true);\n\n                        // try to update as offen as possible if new results are ready\n                        // TODO - try to check if the same results are currently displaying\n                        this.mixedResults.matchCount && this.callback(this.mixedResults, this);\n\n                        this.latency.all = Date.now() - this.startTime;\n\n                        // Do partial wrapup, final wrapup will happen after all results are received\n                        CliqzUtils.setTimeout(this.instantWrapup, 0, this);\n                    } else {\n                        /// Nothing to push yet, probably only cliqz results are received, keep waiting\n                    }\n                }\n            },\n\n            // handles fetched results from the cache\n            cliqzResultFetcher: function(req, q) {\n\n                // be sure this is not a delayed result\n                if(q != this.searchString) {\n                    this.discardedResults += 1; // count results discarded from backend because they were out of date\n                } else {\n                    this.latency.backend = Date.now() - this.startTime;\n                    var results = [];\n                    var json = JSON.parse(req.response);\n\n                    // apply rerankers\n                    for (var i = 0; i < CLIQZEnvironment.RERANKERS.length; i++){\n                        var reranker = CLIQZEnvironment.RERANKERS[i];\n                        if (reranker != null){\n                            var rerankerResults = reranker.doRerank(json.result);\n                            json.result = rerankerResults.response;\n                            if (Object.keys(rerankerResults.telemetrySignal).length > 0){\n                                this.userRerankers[reranker.name] = rerankerResults.telemetrySignal;\n                            }\n                        }\n\n                    }\n\n                    CliqzUtils.log(json.result ? json.result.length : 0,\"CliqzAutocomplete.cliqzResultFetcher\");\n\n                    results = json.result || [];\n\n                    this.cliqzResultsExtra = [];\n\n                    if(json.images && json.images.results && json.images.results.length >0){\n                        var imgs = json.images.results.filter(function(r){\n                            //ignore empty results\n                            return Object.keys(r).length != 0;\n                        });\n\n                        this.cliqzResultsExtra =imgs.map(Result.cliqzExtra);\n                    }\n\n                    var hasExtra = function(el){\n                        if(!el || !el.results || el.results.length == 0) return false;\n                        el.results = el.results.filter(function(r){\n                            //ignore empty results\n                            return r.hasOwnProperty('url');\n                        });\n\n                        return el.results.length != 0;\n                    };\n\n                    if(hasExtra(json.extra)) {\n                        this.cliqzResultsExtra = json.extra.results.map(Result.cliqzExtra);\n                    }\n                    this.latency.cliqz = json.duration;\n\n                    this.cliqzResults = results.filter(function(r){\n                        // filter results with no or empty url\n                        return r.url != undefined && r.url != '';\n                    });\n\n                    this.cliqzResultsParams = {\n                      choice: json.choice,\n                    };\n                }\n                this.pushResults(q);\n            },\n            createFavicoUrl: function(url){\n                return 'http://cdnfavicons.cliqz.com/' +\n                        url.replace('http://','').replace('https://','').split('/')[0];\n            },\n            // mixes backend results, entity zones, history and custom results\n            mixResults: function(only_instant) {\n\n                // set first history entry as autocompleted if it was\n                if(this.instant.length > 0 &&\n                   CliqzAutocomplete.lastAutocompleteActive && !only_instant) {\n                  this.instant[0].autocompleted = true;\n                }\n\n                var results = Mixer.mix(\n                            this.searchString,\n                            this.cliqzResults,\n                            this.cliqzResultsExtra,\n                            this.instant,\n                            this.customResults,\n                            only_instant\n                    );\n                CliqzAutocomplete.lastResultIsInstant = only_instant;\n                CliqzAutocomplete.afterQueryCount = 0;\n\n                this.mixedResults.setResults(results);\n            },\n            analyzeQuery: function(q){\n                var parts = CliqzResultProviders.getCustomResults(q);\n                this.customResults = parts[1];\n                return parts[0];\n            },\n            //FF entry point\n            //TODO: to be moved to Environment!\n            startSearch: function(searchString, searchParam, previousResult, listener){\n                this.search(searchString, function(results, ctx){\n                    listener.onSearchResult(ctx, results);\n                })\n            },\n            search: function(searchString, callback) {\n\n                CliqzAutocomplete.lastQueryTime = Date.now();\n                CliqzAutocomplete.lastDisplayTime = null;\n                CliqzAutocomplete.lastResult = null;\n                CliqzAutocomplete.lastSuggestions = null;\n                this.oldPushLength = 0;\n                this.customResults = null;\n                this.latency = {\n                    cliqz: null,\n                    history: null,\n                    backend: null,\n                    mixed: null,\n                    all: null\n                };\n                this.userRerankers = {};\n\n                CliqzUtils.log('search: ' + searchString, CliqzAutocomplete.LOG_KEY);\n\n                var invalidQ = isQinvalid(searchString.trim()),\n                    action = {\n                        type: 'activity',\n                        action: 'key_stroke',\n                        current_length: searchString.length,\n                        invalid: invalidQ\n                    };\n                CliqzUtils.telemetry(action);\n\n                if(invalidQ) {\n                    //we call the callback with no results to trigger a dropdown close\n                    callback(null, this)\n                    return;\n                }\n\n                if(CliqzAutocomplete.lastSearch.length > searchString.length) {\n                  CliqzAutocomplete.spellCorr.override = true;\n                }\n                // analyse and modify query for custom results\n                CliqzAutocomplete.lastSearch = searchString;\n                searchString = this.analyzeQuery(searchString);\n\n                // spell correction\n                var urlbar = CliqzUtils.getWindow().document.getElementById('urlbar');\n                if (urlbar && //we do not have urlbar on mobile TODO - fix it better!\n                    !CliqzAutocomplete.spellCorr.override &&\n                    urlbar.selectionEnd == urlbar.selectionStart &&\n                    urlbar.selectionEnd == urlbar.value.length) {\n                    var parts = CliqzSpellCheck.check(searchString);\n                    var newSearchString = parts[0];\n                    var correctBack = parts[1];\n\n                    for (var c in correctBack) {\n                        CliqzAutocomplete.spellCorr.correctBack[c] = correctBack[c];\n                    }\n\n                } else {\n                    // user don't want spell correction\n                    var newSearchString = searchString;\n                }\n                this.wrongSearchString = searchString;\n                if (newSearchString != searchString) {\n                    // the local spell checker kicks in\n                    var action = {\n                        type: 'activity',\n                        action: 'spell_correction',\n                        current_length: searchString.length\n                    }\n                    CliqzUtils.telemetry(action);\n                    CliqzAutocomplete.spellCorr.on = true;\n                    searchString = newSearchString;\n                    CliqzAutocomplete.spellCorr['userConfirmed'] = false;\n                }\n\n                this.cliqzResults = null;\n                this.cliqzResultsExtra = null;\n                this.cliqzResultsParams = { };\n                this.cliqzCache = null;\n                this.historyResults = null;\n                this.instant = [];\n\n                this.callback = callback;\n                this.searchString = searchString;\n                this.searchStringSuggest = null;\n\n                this.mixedResults = new CliqzAutocomplete.ProviderAutoCompleteResultCliqz(\n                        this.searchString,\n                        Components.interfaces.nsIAutoCompleteResult.RESULT_SUCCESS,\n                        -2, // blocks autocomplete\n                        '');\n\n                this.startTime = Date.now();\n                this.mixedResults.suggestionsRecieved = false;\n                // ensure context\n                this.cliqzResultFetcher = this.cliqzResultFetcher.bind(this);\n                this.pushResults = this.pushResults.bind(this);\n                this.historyTimeoutCallback = this.historyTimeoutCallback.bind(this);\n                this.pushTimeoutCallback = this.pushTimeoutCallback.bind(this);\n                this.historyPatternCallback = this.historyPatternCallback.bind(this);\n                this.createInstantResultCallback = this.createInstantResultCallback.bind(this);\n\n                CliqzHistoryCluster.historyCallback = this.historyPatternCallback;\n\n                if(searchString.trim().length){\n                    // start fetching results\n                    CliqzUtils.getCliqzResults(searchString, this.cliqzResultFetcher);\n\n                    // if spell correction, no suggestions\n                    if (CliqzAutocomplete.spellCorr.on && !CliqzAutocomplete.spellCorr.override) {\n                        this.suggestionsRecieved = true;\n                        // change the wrong string to the real wrong string\n                        for (var p in CliqzAutocomplete.spellCorr.correctBack) {\n                            if (this.wrongSearchString.indexOf(CliqzAutocomplete.spellCorr.correctBack[p]) == -1) {\n                                this.wrongSearchString = this.wrongSearchString.replace(p, CliqzAutocomplete.spellCorr.correctBack[p]);\n                            }\n                        }\n                        this.cliqzSuggestions = [searchString, this.wrongSearchString];\n                        CliqzAutocomplete.lastSuggestions = this.cliqzSuggestions;\n                        CliqzUtils.log(CliqzAutocomplete.lastSuggestions, 'spellcorr');\n\n                        //TODO: extract spell corrector out of CliqzAutocomplete\n                        if(urlbar)urlbar.mInputField.value = searchString;\n                    } else {\n                        //CliqzUtils.getSuggestions(searchString, this.cliqzSuggestionFetcher);\n                    }\n                    CliqzUtils.clearTimeout(this.resultsTimer);\n                    this.resultsTimer = CliqzUtils.setTimeout(this.pushTimeoutCallback, CliqzAutocomplete.TIMEOUT, this.searchString);\n                } else {\n                    this.cliqzResults = [];\n                    this.cliqzResultsExtra = [];\n                    this.customResults = [];\n                    CliqzAutocomplete.resetSpellCorr();\n                }\n\n                // trigger history search\n                CLIQZEnvironment.historySearch(\n                    searchString,\n                    this.onHistoryDone.bind(this),\n                    CliqzAutocomplete.sessionStart);\n\n                CliqzUtils.clearTimeout(this.historyTimer);\n                this.historyTimer = CliqzUtils.setTimeout(this.historyTimeoutCallback, CliqzAutocomplete.HISTORY_TIMEOUT, this.searchString);\n                this.historyTimeout = false;\n            },\n            /**\n            * Stops an asynchronous search that is in progress\n            */\n            stopSearch: function() {\n                CliqzUtils.clearTimeout(this.resultsTimer);\n                CliqzUtils.clearTimeout(this.historyTimer);\n            },\n\n            sendResultsSignal: function(obj, instant) {\n                var results = obj.mixedResults._results;\n                var action = {\n                    type: 'activity',\n                    action: 'results',\n                    query_length: CliqzAutocomplete.lastSearch.length,\n                    result_order: CliqzAutocomplete.prepareResultOrder(results),\n                    instant: instant,\n                    popup: CliqzAutocomplete.isPopupOpen ? true : false,\n                    latency_cliqz: obj.latency.cliqz,\n                    latency_history: obj.historyTimeout ? null : obj.latency.history,\n                    latency_patterns: obj.latency.patterns,\n                    latency_backend: obj.latency.backend,\n                    latency_mixed: obj.latency.mixed,\n                    latency_all: obj.startTime? Date.now() - obj.startTime : null,\n                    discarded: obj.discardedResults,\n                    user_rerankers: obj.userRerankers,\n                    backend_params: obj.cliqzResultsParams,\n                    v: 1\n                };\n\n                // reset count of discarded backend results\n                obj.discardedResults = 0;\n\n                if (CliqzAutocomplete.lastAutocompleteActive) {\n                  action.autocompleted = CliqzAutocomplete.lastAutocompleteActive;\n                  action.autocompleted_length = CliqzAutocomplete.lastAutocompleteLength;\n                }\n\n                if (action.result_order.indexOf('C') > -1 && CliqzUtils.getPref('logCluster', false)) {\n                    action.Ctype = CliqzUtils.getClusteringDomain(results[0].val);\n                }\n\n                if (CliqzAutocomplete.isPopupOpen) {\n                    // don't mark as done if popup closed as the user does not see anything\n                    CliqzAutocomplete.markResultsDone(Date.now());\n                }\n\n                // remembers if the popup was open for last result\n                CliqzAutocomplete.lastPopupOpen = CliqzAutocomplete.isPopupOpen;\n                if (results.length > 0) {\n                    CliqzAutocomplete.lastDisplayTime = Date.now();\n                }\n                CliqzUtils.telemetry(action);\n            },\n\n            // Wrap up after a completed search\n            fullWrapup: function(obj) {\n                obj.sendResultsSignal(obj, false);\n\n                obj.startTime = null;\n                CliqzUtils.clearTimeout(obj.resultsTimer);\n                CliqzUtils.clearTimeout(obj.historyTimer);\n                obj.resultsTimer = null;\n                obj.historyTimer = null;\n                obj.cliqzResults = null;\n                obj.cliqzResultsExtra = null;\n                obj.cliqzCache = null;\n                obj.historyResults = null;\n                obj.instant = [];\n            },\n\n            // Wrap up after instant results are shown\n            instantWrapup: function(obj) {\n                obj.sendResultsSignal(obj, true);\n            }\n        }\n    }\n};\n\nCliqzAutocomplete.initProvider();\nCliqzAutocomplete.initResults();\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzAutocomplete;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzAutocomplete\n\n","// start module CliqzCalculator\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module handles various calculations\n *\n */\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/Result.jsm');\nComponents.utils.import(\"resource://gre/modules/Services.jsm\");\nServices.scriptloader.loadSubScript('chrome://cliqzmodules/content/extern/math.min.js', this);\nvar mathLib = math || this.math;\n\n// REF:\n//      http://mathjs.org/docs/index.html\n//      http://stackoverflow.com/questions/26603795/variable-name-and-restrict-operators-in-math-js\n//      http://jsbin.com/duduru/1/edit?html,output\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nvar EXPORTED_SYMBOLS = ['CliqzCalculator'];\nvar BROWSER_LANG = CliqzUtils.getLocalizedString('locale_lang_code');\n\nfunction getEqualOperator(val, localizedStr){\n  var valStr = val.toString().replace(\",\",\"\").replace(\".\",\"\"),\n    normLocalizedStr = localizedStr.replace(\",\",\"\").replace(\".\",\"\");\n  return valStr === normLocalizedStr ? \"=\" : \"\\u2248\";\n}\n\nvar CliqzCalculator = {\n  CALCULATOR_RES: 0,\n  UNIT_RES: '',\n  IS_UNIT_CONVERTER: false,\n  BASE_UNIT_CONVERTER: '',\n  FLOAT_DEC: [100000, 100, 1],\n  FLOAT_DEC_THRESHOLD: [99, 99999],\n  ACCEPT_ERROR: 1e-8,\n  UNIT_CONVERSION_DATA: {  // http://en.wikipedia.org/wiki/Conversion_of_units\n    // http://www.convert-me.com/en/convert/length/\n    'LOCALIZE_KEYS': {'de-DE': 'names_de', 'en-US': 'names_en', 'default': 'names_de'},\n    'types': ['length', 'mass'],\n    'length': {\n      'base': 'm',\n      'units': [\n        {'val': 4828, 'names': ['lea', 'leuge', 'league', 'leagues']},\n        {'val': 0.3048006096012192, // this is US foot, there're IDIAN, CLA, BEN,...\n          'names': ['ft', 'foot', 'feet', 'fu\\u00DF'],\n          'names_en': {'s': 'foot', 'p': 'feet'},\n          'names_de': {'s': 'fu\\u00DF', 'p': 'fu\\u00DF'}},\n        {'val': 0.0254, 'names': ['in', 'inch', 'inches', 'zoll']},\n        {'val': 1000, 'names': ['km', 'kilometer', 'kilometre', 'kilometres', 'kilometers']},\n        {'val': 1, 'names': ['m', 'meter', 'metre', 'metres', 'meters']},\n        {'val': 0.1, 'names': ['dm', 'decimeter', 'decimetre', 'decimeters', 'decimetres', 'dezimeter']},\n        {'val': 0.01, 'names': ['cm', 'centimeter', 'centimetre', 'centimetres', 'centimeters', 'zentimeter']},\n        {'val': 0.001, 'names': ['mm', 'millimeter', 'millimetre', 'millimetres', 'millimeters']},\n        {'val': 1e-6, 'names': ['micron', 'micrometer', 'micrometre', 'micrometres', 'micrometers', 'mikrometer']},\n        {'val': 1e-9, 'names': ['nm', 'nanometre', 'nanometre', 'nanometer', 'nanometers']},\n        {'val': 10000, 'names': ['mil']},  // this is Sweden and Norway unit\n        {'val': 1609.344,\n          'names': ['mil.', 'mi.', 'mile', 'miles', 'meile', 'meilen'],\n          'names_en': {'s': 'mile', 'p': 'miles'},\n          'names_de': {'s': 'meile', 'p': 'meilen'}},\n        {'val': 201.168, 'names': ['furlong', 'furlongs']},\n        {'val': 0.9144, 'names': ['yd', 'yard', 'yards']},\n        {'val': 2.54 * 1e-5, 'names': ['thou']},\n        {'val': 1.8288, 'names': ['fm', 'fathom', 'fathoms', 'faden', 'f\\u00E4den']},\n        {'val': 5.0292, 'names': ['rd', 'rod', 'rods', 'rute', 'ruten']},\n        {'val': 0.1016, 'names': ['hand', 'hands', 'handbreit']},\n        {'val': 0.2286, 'names': ['span', 'spans', 'spanne', 'spannen']},\n        {'val': 5556, 'names': ['naut.leag', 'nautical league', 'naut.leags', 'nautical league']},\n        {'val': 1852, 'names': ['naut.mil', 'naut.mils', 'nautical mile', 'nautical miles', 'naut.meile', 'naut.meilen', 'nautische meile', 'nautische meilen']},\n        {'val': 1852.216, 'names': ['sm', 'Seemeile']},\n        {'val': 185.2, 'names': ['cbl', 'cable length', \"cable'slength\", 'Kabel', 'Kabellänge']}\n      ]\n    },\n    'mass': {\n      \"base\": 'g',\n      'units': [\n        {'val': 102, 'names': ['kN', 'kn', 'kilonewton', 'kilonewtons']},\n        {'val': 1e9, 'names': ['kt', 'kilotonne', 'kilotonnes', 'kilotonnen']},\n        {'val': 1e6, 'names': ['t', 'tonne', 'tonnes', 'tonnen', 'metric ton', 'metric tons']},\n        {'val': 1e6, 'names': ['Mg', 'megagram', 'megagrams']},\n        {'val': 1000, 'names': ['kg', 'kilogram', 'kilograms', 'kilogramme', 'kilogrammes', 'kilogramm', 'kilogramms']},\n        {'val': 100, 'names': ['hg', 'hectogram', 'hectograms', 'hectogramme', 'hectogrammes', 'hectogramm', 'hectogramms']},\n        {'val': 10, 'names': ['dag', 'decagram', 'decagrams', 'decagramme', 'decagrammes', 'decagramm', 'decagramms']},\n        {'val': 1, 'names': ['g', 'gram', 'grams', 'gramme', 'grammes', 'gramm', 'gramms']},\n        {'val': 0.1, 'names': ['dg', 'decigram', 'decigrams', 'decigramme', 'decigrammes', 'decigramm', 'decigramms']},\n        {'val': 0.01, 'names': ['cg', 'centigram', 'centigrams', 'centigramme', 'centigrammes', 'centigramm', 'centigramms']},\n        {'val': 0.001, 'names': ['mg', 'milligram', 'milligrams', 'milligramme', 'milligrammes', 'milligramm', 'milligramms']},\n        {'val': 0.000001, 'names': ['mcg', 'microgram', 'micrograms', 'microgramme', 'microgrammes', 'microgramm', 'microgramms']},\n        {'val': 453.59237, 'names': ['lb', 'lbs', 'pound', 'pounds', 'pound-mass', 'pfund']},\n        {'val': 28.349523125, 'names': ['oz', 'ozs', 'ounce ', 'ounces', 'unze', 'unzen']},\n        {'val': 1.7718452, 'names': ['dr', 'dram', 'drams']},\n        {'val': 0.06479891, 'names': ['gr', 'grain', 'grains', 'Gran']}\n      ]\n    }\n  },\n  shortenNumber: function(){\n    // shorten numbers when needed\n    try {\n      var numRaw, num, num1, floatDec = 1, resultSign = \"\";\n\n      num1 = this.CALCULATOR_RES;\n\n      for (var i = 0; i < this.FLOAT_DEC_THRESHOLD.length; i++) {\n        if (Math.abs(num1) < this.FLOAT_DEC_THRESHOLD[i]) {\n          floatDec = this.FLOAT_DEC[i];\n          break;\n        }\n      }\n      numRaw = Math.round(num1 * floatDec) / floatDec;\n      num = numRaw.toLocaleString(CliqzUtils.getLocalizedString('locale_lang_code'));\n      resultSign = getEqualOperator(num1, num);\n\n      this.CALCULATOR_RES = this.IS_UNIT_CONVERTER ? [num, this.UNIT_RES].join(\" \") : num.toString();\n      return [resultSign, this.CALCULATOR_RES]\n    } catch (err) {}\n    return null\n  },\n  clean: function(q) {\n    if (!isNaN(q)) {\n      return ''; // Don't trigger calculator yet if the query is just a number\n    }\n    var operators = ['+', '-', '*', '/', '^', '='];\n    q = q.replace(/(\\d),(\\d)/g, '$1.$2'); // commas are separators to german ppl\n    q = q.replace(/ /g, ''); // Remove all spaces\n    for (var i = 0; i < operators.length; i++) {\n      if (q[q.length - 1] == operators[i]) {\n        return q.substr(0, q.length-1); // Remove the last operator\n      }\n    }\n    return q;\n  },\n  calculate: function(q) {\n    if (this.CALCULATOR_RES === null || this.CALCULATOR_RES === q) {\n      return null;\n    }\n    var expandedExpression = this.IS_UNIT_CONVERTER ? this.BASE_UNIT_CONVERTER : mathLib.parse(this.clean(q)).toString(),\n      resultSign = this.shortenNumber()[0];\n\n    return Result.cliqzExtra(\n      {\n        url: \"\",\n        q: q,\n        style: \"cliqz-extra\",\n        type: \"cliqz-extra\",\n        subType: JSON.stringify({type: 'calculator'}),\n        data: {\n          template: 'calculator',\n          expression: expandedExpression,\n          answer: this.CALCULATOR_RES,\n          is_calculus: true,\n          // TODO: support_copy_ans should be platform specific\n          support_copy_ans: true\n        }\n      }\n    );\n  },\n\n  find_unit_in_data: function(unit_) {\n    var self = this,\n      unit = unit_.toLowerCase(),\n      unitFound = null;\n\n    self.UNIT_CONVERSION_DATA.types.some(function(type) {\n      return self.UNIT_CONVERSION_DATA[type].units.some(function(item) {\n        if (item['names'].indexOf(unit) > -1 || item['names'].indexOf(unit_) > -1) {\n          unitFound = [type, true, item];\n          return true;\n        }\n        return false;\n      });\n    });\n    return unitFound || [\"\", false, null];\n  },\n\n  selectUnitTerms: function(unit_data, val) {\n    /*\n     *   + based on the value and the language preference, select unit name in suitable language and form (singular/plural)\n     */\n    var noun_type = val === 1 ? 's' : 'p',\n      nameInfo = unit_data[CliqzCalculator.UNIT_CONVERSION_DATA.LOCALIZE_KEYS[BROWSER_LANG]]\n                  || unit_data[CliqzCalculator.UNIT_CONVERSION_DATA.LOCALIZE_KEYS['default']]\n                  || unit_data['names'],\n      name = nameInfo[noun_type];\n\n    return name || unit_data['names']['0'] || \"\";\n  },\n\n  isConverterSearch: function(q) {\n    // --- Process query to recognize a unit-conversion query\n    // ACCEPTED query types:\n    //    1. a to b, e.g. cm to mm\n    var tmp = q.trim(),\n      paramList, unit1, unit2, idx, num, unit1Info;\n    // Note: don't use regex match in replace function, e.g. tmp.replace(/ zu | in | im /g, ' to ')\n    tmp = q.replace(' zu ', ' to ');\n    tmp = tmp.replace(' im ', ' to ');\n    tmp = tmp.replace(' in ', ' to ');\n    tmp = tmp.replace(' into ', ' to ');  // this needs to be at the end\n    paramList = tmp.trim().split(' to ');\n\n    if (paramList.length !== 2)\n      return false;\n    unit2 = this.find_unit_in_data(paramList[1].trim());\n    if (unit2[1]) {\n      unit1 = paramList[0].replace(' ', '') + ' ';\n      idx = 0;\n      while (unit1[idx] === ',' || unit1[idx] === '.' || (unit1[idx] >= '0' && unit1[idx] <= '9'))\n        idx++;\n      if (idx === 0) {\n        num = 1\n      } else {\n        num = Number(unit1.slice(0, idx));\n        if (isNaN(num)) {\n          return false\n        }\n      }\n\n      unit1 = unit1.slice(idx, unit1.length).trim();\n      unit1Info = this.find_unit_in_data(unit1);\n      if (!unit1Info[1] || unit1Info[0] !== unit2[0]) {\n        return false\n      }  // if not unit of the same type, e.g. 1km to g should not return result\n\n      this.IS_UNIT_CONVERTER = true;\n      var cvRaw = unit1Info[2].val / unit2[2].val,\n        cv = cvRaw.toLocaleString(CliqzUtils.getLocalizedString('locale_lang_code'));\n      this.CALCULATOR_RES = num * cvRaw;\n      this.UNIT_RES = CliqzCalculator.selectUnitTerms(unit2[2], this.CALCULATOR_RES);\n      this.BASE_UNIT_CONVERTER = [\n        '1',\n        CliqzCalculator.selectUnitTerms(unit1Info[2], 1),\n        getEqualOperator(cvRaw, cv),\n        cv,\n        CliqzCalculator.selectUnitTerms(unit2[2], this.CALCULATOR_RES, cvRaw)\n      ].join(\" \");\n\n      return true\n    }\n    else {\n      return false\n    }\n  },\n\n  isCalculatorSearch: function(q) {\n    // filter out:\n    // + too short query (avoid answering e, pi)\n    // + automatically convert queries like '10cm\n    var tmp = this.clean(q)\n    if (tmp.length <= 2 || tmp.length > 150) {\n      return false;\n    }\n\n    try {\n      this.CALCULATOR_RES = mathLib.eval(tmp);\n\n      if (typeof(this.CALCULATOR_RES) === 'number') {\n        this.IS_UNIT_CONVERTER = false;\n        return true\n      }\n    }\n    catch (err) {\n    }\n\n    return this.isConverterSearch(q);\n  }\n};\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzCalculator;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzCalculator\n\n","// start module CliqzEvents\n(function(ctx,Q,E){\n'use strict';\n/*\n * This method implements the publish subscribe design pattern\n *\n * Event naming scheme:\n *    cliqz.module_name.event_name\n *\n *  single sender -> multiple potential recipients\n *    for example: cliqz.core.urlbar_focus (inform others about urlbar focus)\n *    module_name describes sender\n *  multiple potential senders -> single recipient\n *    for example: cliqz.msg_center.show_message (tell the message center to show a message)\n *    module_name describes recipient (this is more like a RPC)\n */\n\nvar EXPORTED_SYMBOLS = ['CliqzEvents'];\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nvar CliqzEvents = CliqzEvents || {\n  //use a javascript object to push the message ids and the callbacks\n  cache: {},\n  /*\n   * Publish events of interest with a specific id\n   */\n  pub: function (id) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    (CliqzEvents.cache[id] || []).forEach(function (ev) {\n      CliqzUtils.setTimeout(function () {\n        try {\n          ev.apply(null, args);\n        } catch(e) {\n          CliqzUtils.log(e.toString()+\" -- \"+e.stack, \"CliqzEvents error: \"+id);\n        }\n      }, 0);\n    });\n  },\n\n  /* Subscribe to events of interest\n   * with a specific id and a callback\n   * to be executed when the event is observed\n   */\n  sub: function (id, fn) {\n    CliqzEvents.cache[id] = CliqzEvents.cache[id] || [];\n    CliqzEvents.cache[id].push(fn);\n  },\n\n  un_sub: function (id, fn) {\n    var index;\n    if (!CliqzEvents.cache[id]) {\n      return;\n    }\n    if (!fn) {\n      CliqzEvents.cache[id] = [];\n    } else {\n      index = CliqzEvents.cache[id].indexOf(fn);\n      if (index > -1) {\n        CliqzEvents.cache[id].splice(index, 1);\n      }\n    }\n  },\n\n  nextId: function nextId() {\n    nextId.id = nextId.id || 0;\n    nextId.id += 1;\n    return nextId.id;\n  }\n};\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzEvents;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzEvents\n\n","// start module CliqzHandlebars\n(function(ctx,Q,E){\n'use strict';\n\n/*\n    handlebars wrapper which adds all the needed helpers\n*/\n\nvar EXPORTED_SYMBOLS = ['CliqzHandlebars'];\nComponents.utils.import(\"resource://gre/modules/Services.jsm\");\nComponents.utils.import('chrome://cliqzmodules/content/CliqzUtils.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/CliqzAutocomplete.jsm');\n\n\nComponents.utils.import(\"resource://gre/modules/Services.jsm\");\nServices.scriptloader.loadSubScript('chrome://cliqz/content/bower_components/handlebars/handlebars.js', this);\nComponents.utils.import('chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/CliqzUtils.jsm');\nComponents.utils.import('chrome://cliqzmodules/content/CliqzAutocomplete.jsm');\n\nvar CliqzHandlebars = Handlebars || this.Handlebars;\n\nvar TEMPLATES = CLIQZEnvironment.TEMPLATES,\n    MESSAGE_TEMPLATES = CLIQZEnvironment.MESSAGE_TEMPLATES || [],\n    PARTIALS = CLIQZEnvironment.PARTIALS,\n    AGO_CEILINGS = [\n        [0            , '',1],\n        [120          , 'ago1Minute' , 1],\n        [3600         , 'agoXMinutes'   , 60],\n        [7200         , 'ago1Hour' , 1],\n        [86400        , 'agoXHours'   , 3600],\n        [172800       , 'agoYesterday'          , 1],\n        [604800       , 'agoXDays'     , 86400],\n        [4838400      , 'ago1Month'  , 1],\n        [29030400     , 'agoXMonths'   , 2419200],\n        [58060800     , 'ago1year'   , 1],\n        [2903040000   , 'agoXYears'     , 29030400]\n    ],\n    ZERO_CLICK_INFO_PRIO = [[\"Phone\", \"http://cdn.cliqz.com/extension/EZ/generic/zeroclick/phone.svg\"],\n                            [\"BIC\", \"http://cdn.cliqz.com/extension/EZ/generic/zeroclick/BIC.svg\"],\n                            [\"E-Mail\", \"http://cdn.cliqz.com/extension/EZ/generic/zeroclick/emaill.svg\"]\n                           ];\n\n\n\nCliqzHandlebars.tplCache = {};\n\n/* Needed by the view layer */\nCliqzHandlebars.TEMPLATES = TEMPLATES;\nCliqzHandlebars.MESSAGE_TEMPLATES = MESSAGE_TEMPLATES;\nCliqzHandlebars.PARTIALS = PARTIALS;\n\ncompileTemplates();\nregisterHelpers();\nfunction compileTemplates(){\n    Object.keys(TEMPLATES).forEach(fetchTemplate);\n    MESSAGE_TEMPLATES.forEach(fetchTemplate);\n    PARTIALS.forEach(function(tName){ fetchTemplate(tName, true); });\n}\n\nfunction fetchTemplate(tName, isPartial) {\n    try {\n        CliqzUtils.httpGet(CliqzUtils.TEMPLATES_PATH + tName + '.tpl', function(res){\n            if(isPartial === true) {\n              Handlebars.registerPartial(tName, res.response);\n              CliqzHandlebars.tplCache[tName] = Handlebars.compile(res.response);\n            }\n            else\n                CliqzHandlebars.tplCache[tName] = Handlebars.compile(res.response);\n        });\n    } catch(e){\n        CliqzUtils.log('ERROR loading template ' + tName);\n    }\n}\n\n\nfunction registerHelpers(){\n    Handlebars.registerHelper('partial', function(name, options) {\n        var template = CliqzHandlebars.tplCache[name] || CliqzHandlebars.tplCache[\"partials/\"+name] || CliqzHandlebars.tplCache.empty;\n        return new Handlebars.SafeString(template(this));\n    });\n\n    Handlebars.registerHelper('get_array_element', function(arr, idx, subelement) {\n      if (typeof(subelement) == undefined)\n        return arr && arr[idx];\n      else\n        return arr && arr[idx] && arr[idx][subelement];\n    });\n\n    Handlebars.registerHelper('agoline', function(ts, options) {\n        if(!ts) return '';\n        var now = (new Date().getTime() / 1000),\n            seconds = parseInt(now - ts),\n            i=0, slot;\n\n        while (slot = AGO_CEILINGS[i++])\n            if (seconds < slot[0])\n                return CliqzUtils.getLocalizedString(slot[1], parseInt(seconds / slot[2]))\n        return '';\n    });\n\n    Handlebars.registerHelper('sec_to_duration', function(seconds) {\n        if(!seconds)return null;\n        try {\n            var s = parseInt(seconds);\n            return Math.floor(s/60) + ':' + (\"0\" + (s%60)).slice(-2);\n        } catch(e) {\n            return null;\n        }\n    });\n\n    Handlebars.registerHelper('distance', function(meters) {\n        if(meters < 1000) {\n            return meters.toFixed(0) + \" m\";\n        }\n        return (meters/1000).toFixed(1) + \" km\";\n    });\n\n    Handlebars.registerHelper('shopping_stars_width', function(rating) {\n        return rating * 14;\n    });\n\n    Handlebars.registerHelper('even', function(value, options) {\n        if (value%2) {\n            return options.fn(this);\n        } else {\n            return options.inverse(this);\n        }\n    });\n\n    Handlebars.registerHelper('local', function(key) {\n        var args = Array.prototype.slice.call(arguments);\n        var name = args.shift();\n        return CliqzUtils.getLocalizedString.apply(null, [name, args]);\n    });\n\n    Handlebars.registerHelper('views_helper', function(val) {\n        if(!val || val == '-1')return '';\n\n        try {\n            return parseFloat(val).toLocaleString() + ' ' + CliqzUtils.getLocalizedString('views');\n        } catch(e) {\n            return ''\n        }\n    });\n\n    Handlebars.registerHelper('wikiEZ_height', function(data_richData){\n        if (data_richData && data_richData.hasOwnProperty('images') && data_richData.images.length > 0){\n            if ( (this.type === 'cliqz-extra') || (this.data === CliqzAutocomplete.lastResult._results[0].data))  // is the first result in the show list\n                return 'cqz-result-h2';\n            // BM hq result, but not the 1st result -> remove images\n            data_richData.images = [];\n        }\n\n        return 'cqz-result-h3';\n    });\n\n    Handlebars.registerHelper('recipe_rd_template', function(data_richData) {\n        var minimalData = data_richData\n                          && typeof(data_richData[\"cook_time\"]) !== \"undefined\"\n                          && typeof(data_richData[\"numportion\"]) !== \"undefined\"\n                          && typeof(data_richData[\"total_review\"]) !== \"undefined\";\n\n        // is the only result in the show list\n        return (CliqzAutocomplete.lastResult._results.length === 1 && minimalData);\n    });\n\n    Handlebars.registerHelper('cpgame_movie_rd_template', function(data_richData) {\n        if(!CliqzAutocomplete.lastResult) return false;\n\n        var minimalData_pcgame = data_richData && ((typeof(data_richData[\"image\"]) !== \"undefined\" ) || (typeof(data_richData[\"game_cat\"]) !== \"undefined\" && typeof(data_richData[\"rating\"]) !== \"undefined\" && typeof(data_richData[\"categories\"]) !== \"undefined\" ));\n        var minimalData_movie = data_richData && ((typeof(data_richData[\"image\"]) !== \"undefined\" ) || (data_richData[\"director\"] && data_richData[\"director\"][\"title\"]) || (data_richData[\"length\"] &&  data_richData[\"length\"] !== \"_\") || (data_richData[\"categories\"]));\n\n        return (CliqzAutocomplete.lastResult._results.length == 1 && (minimalData_pcgame || minimalData_movie)); // is the only result in the show list\n    });\n\n    Handlebars.registerHelper('image_rd_specification', function(richData){\n        return richData['superType'] === \"movie\" ? \"50px\" : \"76px\";\n    });\n\n    Handlebars.registerHelper('localizeNumbers', function(num) {\n        /*\n        * USE only when you really understand your data (see below)!\n        * this function supports localization for:\n        *   + normal number strings (e.g. 1.2, 3...),\n        *   + standardized abrv. strings: 12e-4, and\n        *   + extended forms, e.g. 1.2B, 1M etc.\n        * In general, any string in the form of xxxyyy where xxx is a standardized number string (recognized by isFinite())\n        * and yyy is an arbitrary string (called postfix) that does not start with a number will be localized\n        * WARNING: numbers in the form such as: 12e3M, which might be seen as 12000 Million, will be parsed incorrectly\n        */\n        try {\n            var parsedNum = parseFloat(num), postfix, dummy = \"-\";\n            if (!isNaN(parsedNum) && isFinite(parsedNum)) {\n                postfix = isFinite(num) ? \"\" : (num + \"\").substring((parsedNum + \"\").length);\n                return parsedNum.toLocaleString(CliqzUtils.getLocalizedString('locale_lang_code')) + postfix;\n            }\n            return dummy;\n        }\n        catch(e) {\n            return num\n        }\n    });\n\n    Handlebars.registerHelper('limit', function(idx, max_idx){\n        return idx < max_idx;\n    });\n\n    Handlebars.registerHelper('json', function(value, options) {\n        return JSON.stringify(value);\n    });\n\n    Handlebars.registerHelper('log', function(value, key) {\n        CliqzUtils.log(value, 'TEMPLATE LOG HELPER');\n    });\n\n    Handlebars.registerHelper('toLowerCase', function(str) {\n       return str.toLowerCase();\n    });\n\n    Handlebars.registerHelper('toUpperCase', function(str) {\n       return str.toUpperCase();\n    });\n\n    Handlebars.registerHelper('emphasis', function(text, q, minQueryLength, cleanControlChars) {\n        // lucian: questionable solution performance wise\n        // strip out all the control chars\n        // eg :text = \"... \\u001a\"\n        if(!q) return text;\n        q = q.trim();\n        if(text && cleanControlChars) text = text.replace(/[\\u0000-\\u001F]/g, ' ')\n\n        if(!text || !q || q.length < (minQueryLength || 2)) return text;\n\n        var map = Array(text.length),\n            tokens = q.toLowerCase().split(/\\s+|\\.+/).filter(function(t){ return t && t.length>1; }),\n            lowerText = text.toLowerCase(),\n            out, high = false;\n\n        tokens.forEach(function(token){\n            var poz = lowerText.indexOf(token);\n            while(poz !== -1){\n                for(var i=poz; i<poz+token.length; i++)\n                    map[i] = true;\n                poz = lowerText.indexOf(token, poz+1);\n            }\n        });\n        out=[];\n        var current = ''\n        for(var i=0; i<text.length; i++){\n            if(map[i] && !high){\n                out.push(current);\n                current='';\n                current += text[i];\n                high = true;\n            }\n            else if(!map[i] && high){\n                out.push(current);\n                current='';\n                current +=text[i];\n                high = false;\n            }\n            else current += text[i];\n        }\n        out.push(current);\n\n        return new Handlebars.SafeString(CliqzHandlebars.tplCache.emphasis(out));\n    });\n\n    Handlebars.registerHelper('hasimage', function(image) {\n        if(image && image.src &&\n            !(image.src.indexOf('xing') !== -1 && image.src.indexOf('nobody_') !==-1))\n            return true;\n        else\n            return false\n    });\n\n    Handlebars.registerHelper('date', function(_date) {\n        var d = new Date(_date);\n        var date = d.getDate();\n        var month = d.getMonth();\n        month++;\n        var year = d.getFullYear();\n        var formatedDate = date + '/' + month + '/' + year;\n        return formatedDate;\n    });\n\n    Handlebars.registerHelper(\"math\", function(lvalue, operator, rvalue, options) {\n        lvalue = parseFloat(lvalue);\n        rvalue = parseFloat(rvalue);\n\n        switch(operator) {\n            case \"+\": return lvalue + rvalue;\n            case \"-\": return lvalue - rvalue;\n            case \"*\": return lvalue * rvalue;\n            case \"/\": return lvalue / rvalue;\n            case \"%\": return lvalue % rvalue;\n        }\n    });\n\n    Handlebars.registerHelper(\"logic\", function(lvalue, operator, rvalue, options) {\n        switch(operator) {\n            case \"|\":           return lvalue | rvalue;\n            case \"||\":          return lvalue || rvalue;\n            case \"&\":           return lvalue & rvalue;\n            case \"&&\":          return lvalue && rvalue;\n            case \"^\":           return lvalue ^ rvalue;\n            case \"is\":          return lvalue == rvalue;\n            case \"starts_with\": return lvalue.indexOf(rvalue) == 0;\n            case \"===\":         return lvalue === rvalue;\n            case \"!=\":          return lvalue != rvalue;\n            case \"<\":           return lvalue < rvalue;\n            case \">\":           return lvalue > rvalue;\n        }\n    });\n\n    Handlebars.registerHelper('is_not_dummy', function(s){\n        return s && s!==\"_\";\n    });\n\n    Handlebars.registerHelper('nameify', function(str) {\n        if (str.length == 0) return \"\";\n        else return str[0].toUpperCase() + str.slice(1);\n    });\n\n    Handlebars.registerHelper('kind_printer', function(kind) {\n        //we need to join with semicolon to avoid conflicting with the comma from json objects\n        return kind ? kind.join(';'): '';\n    });\n\n    Handlebars.registerHelper('links_or_sources', function(richData) {\n        return richData ? ((richData.internal_links && richData.internal_links.length > 0) ? richData.internal_links : (richData.additional_sources ? richData.additional_sources : [])) : 0;\n    });\n\n    Handlebars.registerHelper('pref', function(key) {\n        return CliqzUtils.getPref(key, false);\n    });\n\n    Handlebars.registerHelper('repeat', function(num, block) {\n      var accum = '';\n      for(var i = 0; i < num; i++) {\n        accum += block.fn(i);\n      }\n      return accum;\n    });\n\n    /* If conditions on preferences */\n    Handlebars.registerHelper('ifpref', function(name, val, options) {\n      if (val == undefined)\n        return CliqzUtils.getPref(name) ? options.fn(this) : options.inverse(this) ;\n      else\n        return CliqzUtils.getPref(name) == val ? options.fn(this) : options.inverse(this) ;\n    });\n\n    Handlebars.registerHelper('unlesspref', function(name, val, options) {\n      if (val == undefined)\n        return CliqzUtils.getPref(name) ? options.inverse(this) : options.fn(this);\n      else\n        return CliqzUtils.getPref(name) == val ? options.inverse(this) : options.fn(this);\n    });\n    /* End If conditions on preferences */\n\n    Handlebars.registerHelper('zeroclick_prep', function(zeroInfo_raw) {\n        var n, name, item, zeroInfo = [];\n        for (n = 0; n < ZERO_CLICK_INFO_PRIO.length; n++) {\n            item = ZERO_CLICK_INFO_PRIO[n];\n            name = item[0];\n            if (zeroInfo_raw[name]) {\n                zeroInfo.push({\n                    'name': name,\n                    'val': zeroInfo_raw[name],\n                    'img': item[1]\n                });\n            }\n        }\n        zeroInfo_raw = zeroInfo;\n        return zeroInfo_raw;\n    });\n\n    Handlebars.registerHelper('convRateDigitSplit', function (rate) {\n        var result = \"<span class='cqz-conv-rate'>\" +\n            rate.substr(0, rate.length - 2) +\n            \"<span class='cqz-rate-last-digits'>\" + rate.substr(-2) + \"</span>\" +\n            \"</span>\";\n\n        return new Handlebars.SafeString(result);\n    });\n\n    Handlebars.registerHelper('numberFormat', function (number) {\n        try { //just in case this helper is used on unsanitezed data from backend\n          number = parseFloat(number);\n          number = number.toFixed(2);\n          return parseFloat(number).toLocaleString(CliqzUtils.PREFERRED_LANGUAGE);\n        } catch(e){\n          return ''\n        }\n    });\n\n\n    /* mobile helpers */\n    Handlebars.registerHelper(\"debug\", function(optionalValue) {\n      console.log(\"%c Template Data \" + this.vertical + \" \",\"color:#fff;background:green\",this);\n    });\n\n\n    Handlebars.registerHelper(\"trimNumbers\", function(number) {\n      return Math.round(number);\n    });\n\n\n    Handlebars.registerHelper('conversationsTime', function(time) {\n        var d = new Date(time);\n        var hours = d.getHours();\n        hours = hours > 9 ? hours : '0' + hours\n        var minutes = d.getMinutes();\n        minutes = minutes > 9 ? minutes : '0' + minutes\n        var formatedDate = hours + ':' + minutes;\n        return formatedDate;\n    });\n\n    Handlebars.registerHelper('uriEncode', function(uriComponent) {\n        return encodeURIComponent(uriComponent);\n    });\n\n    Handlebars.registerHelper('timeOrCalculator', function(ezType) {\n        if(ezType==\"time\") {\n          return Handlebars.helpers.local(\"time\");\n        } else {\n          return Handlebars.helpers.local(\"calculator\");\n        }\n    });\n\n\n    Handlebars.registerHelper('ifShowSearch', function(results, options) { // if equal\n      if(!results[0] || results[0].data.template !== \"noResult\") {\n        return options.fn(this);\n      } else {\n        return options.inverse(this);\n      }\n    });\n\n\n    Handlebars.registerHelper('mobileWikipediaUrls', function(url) {\n        return url.replace(\"http://de.wikipedia.org/wiki\",\"https://de.m.wikipedia.org/wiki\");\n    });\n\n    Handlebars.registerHelper('eachIncludeParent', function ( context, options ) {\n        var fn = options.fn,\n            inverse = options.inverse,\n            ret = \"\",\n            _context = [];\n\n        $.each(context, function (index, object) {\n            var _object = $.extend({}, object);\n            _context.push(_object);\n        });\n\n        if ( _context && _context.length > 0 ) {\n            for ( var i = 0, j = _context.length; i < j; i++ ) {\n                _context[i][\"parentContext\"] = options.hash.parent;\n                ret = ret + fn(_context[i]);\n            }\n        } else {\n            ret = inverse(this);\n        }\n        return ret;\n    });\n\n    Handlebars.registerHelper('conversationsTime', function(time) {\n        var d = new Date(time);\n        var hours = d.getHours();\n        hours = hours > 9 ? hours : '0' + hours\n        var minutes = d.getMinutes();\n        minutes = minutes > 9 ? minutes : '0' + minutes\n        var formatedDate = hours + ':' + minutes;\n        return formatedDate;\n    });\n\n    Handlebars.registerHelper('sendTelemetry', function(nResults) {\n      CliqzUtils.telemetry({\n        type: 'Results Rendered',\n        nResults: nResults\n      });\n    });\n\n    Handlebars.registerHelper('generate_background_color', function(url) {\n        var urlDetails = CliqzUtils.getDetailsFromUrl(url);\n        var logoDetails = CliqzUtils.getLogoDetails(urlDetails);\n        return \"#\" + logoDetails.backgroundColor;\n    });\n}\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzHandlebars;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzHandlebars\n\n","// start module CliqzHistoryCluster\n(function(ctx,Q,E){\n'use strict';\n\nvar EXPORTED_SYMBOLS = ['CliqzHistoryCluster'];\n\nvar Cc = Components.classes,\n    Ci = Components.interfaces,\n    Cu = Components.utils;\n\nComponents.utils.import('resource://gre/modules/Services.jsm');\nComponents.utils.import('resource://gre/modules/FileUtils.jsm');\nComponents.utils.import('resource://gre/modules/NetUtil.jsm');\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nComponents.utils.import('chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'Result',\n  'chrome://cliqzmodules/content/Result.jsm');\n\nvar FF_DEF_FAVICON = 'chrome://mozapps/skin/places/defaultFavicon.png',\n    Q_DEF_FAVICON = CLIQZEnvironment.SKIN_PATH + 'defaultFavicon.png';\n\nvar CliqzHistoryCluster = {\n  historyCallback: null,\n  latencies: [],\n\n  // Generate result json from patterns\n  _generateResult: function(patterns, query, cluster, baseUrl) {\n    if (!patterns) {\n      patterns = [];\n    }\n    return {\n      query: query,\n      cluster: cluster,\n      top_domain: baseUrl || CliqzHistoryCluster._maxDomainShare(patterns)[0],\n      results: patterns,\n      filteredResults: function() {\n        var self = this;\n        return this.results.filter(function(r) {\n          return r.title && CliqzUtils.getDetailsFromUrl(r.url).name == CliqzUtils.getDetailsFromUrl(self.top_domain).name;\n        });\n      }\n    };\n  },\n  // This method is triggered when the Firefox history has finished loading\n  addFirefoxHistory: function(history) {\n    var query = history.query;\n    var res;\n\n    // Extract results\n    var patterns = [];\n    for (var i = 0; i < history.results.length; i++) {\n      var parts = CliqzUtils.cleanMozillaActions(history.results[i].value);\n      var url = parts[1],\n          action = parts[0],\n          title = history.results[i].comment;\n      // Filters out results with value: \"moz-action:searchengine,{\"engineName\":\"Google\",\"input\":\"awz\",\"searchQuery\":\"awz\"}\"\n      // that are returned from the unifiedcomplete history provider that is the only provider from Firefox 49.0 on\n      if (action === 'searchengine'){\n        continue;\n      }\n\n      if (!title) {\n        title = CliqzUtils.generalizeUrl(url);\n      }\n\n      if (title.length > 0 && url.length > 0 &&\n          Result.isValid(url, CliqzUtils.getDetailsFromUrl(url))) {\n\n        patterns.push({\n          url: url,\n          title: title,\n          favicon: history.results[i].image,\n          _genUrl: CliqzUtils.generalizeUrl(url, true)\n        });\n      }\n    }\n    // Process patterns\n    res = CliqzHistoryCluster._preparePatterns(patterns, query);\n    CliqzHistoryCluster.firefoxHistory = [];\n    CliqzHistoryCluster.firefoxHistory.res = res;\n    CliqzHistoryCluster.firefoxHistory.query = query;\n    CliqzHistoryCluster.historyCallback(res);\n  },\n  // Process patterns\n  _preparePatterns: function(patterns, query) {\n    var baseUrl, favicon, orig_query = query;\n\n    query = CliqzUtils.cleanUrlProtocol(query, true).trim();\n\n    // Filter patterns that don't match search\n    patterns = CliqzHistoryCluster._filterPatterns(patterns, query.toLowerCase());\n    var share = CliqzHistoryCluster._maxDomainShare(patterns);\n\n    // Remove patterns with same url or title\n    patterns = CliqzHistoryCluster._removeDuplicates(patterns);\n\n    // Move base domain to top\n    var adjustedResults = CliqzHistoryCluster._adjustBaseDomain(patterns, query);\n    patterns = adjustedResults[0];\n    baseUrl = adjustedResults[1];\n    favicon = adjustedResults[2];\n    var https = adjustedResults[3];\n    var res = CliqzHistoryCluster._generateResult(patterns, orig_query, false, baseUrl);\n\n    // Add base domain if above threshold\n    var fRes = res.filteredResults();\n    var genQ = CliqzUtils.generalizeUrl(query);\n    if (share[1] > 0.5 && fRes.length > 2 &&\n       !(CliqzUtils.generalizeUrl(patterns[0].url).indexOf(genQ) !== 0 && share[1] < 0.8)) {\n      // Check if base domain changed due to filtering\n      var tmpBaseUrl = CliqzHistoryCluster._adjustBaseDomain(fRes, query)[1];\n      baseUrl = tmpBaseUrl;\n      CliqzHistoryCluster._addBaseDomain(patterns, baseUrl, favicon, https);\n      res.cluster = true;\n    // Threshold not reached or clustering not enabled -> no domain clustering\n    } else {\n      // Disable domain filtering\n      res.filteredResults = function() {\n        return this.results;\n      };\n    }\n\n    // Remove automatically added patterns if they don't match query\n    if (patterns && patterns.length > 0 &&\n       patterns[0].autoAdd &&\n       CliqzUtils.generalizeUrl(patterns[0].url).indexOf(genQ) !== 0) {\n      patterns.shift();\n      res.cluster = false;\n    }\n\n    res.results = CliqzHistoryCluster._removeDuplicates(res.results);\n    return res;\n  },\n\n  // Calculates the _weighted_ share of the most common domain in given patterns\n  _maxDomainShare: function(patterns) {\n    var patternCount = patterns.length;\n    // boost the first X domain entries (i.e., within boostRange)\n    var boostRange = 3;\n    // weight for the first X entries, all other entries have weight of 1;\n    // this makes the first X entries as important as the remaining (N - X) entries\n    var boostFactor = (patternCount - boostRange) / (1 * boostRange);\n\n    // make sure the first results do not become less important, which happens if\n    // if there are only very few patterns (i.e, patternCount < boostRange * 2)\n    boostFactor = Math.max(1, boostFactor);\n\n    var domains = [];\n    var index = 0;\n    var cnt = 0;\n\n    for (var key in patterns) {\n      var url = patterns[key].url;\n      var domaintmp = CliqzUtils.getDetailsFromUrl(url).domain;\n      // assign a higher weight to this domain entry if it is one of the first N entries\n      var weightedCount = index < boostRange ? boostFactor : 1;\n      if (!domains[domaintmp]) {\n        domains[domaintmp] = weightedCount;\n      } else {\n        cnt = 1;\n        if (patterns[key].cnt) cnt = patterns[key].cnt;\n        domains[domaintmp] += weightedCount;\n      }\n      index++;\n    }\n    var max = 0.0;\n    cnt = 0.0;\n    var domain = null;\n    for (key in domains) {\n      cnt += domains[key];\n      if (domains[key] > max) {\n        max = domains[key];\n        domain = key;\n      }\n    }\n\n    return [domain, max / cnt];\n  },\n  _filterPatterns: function(patterns, full_query) {\n    var queries = full_query.trim().split(' ');\n    var newPatterns = [];\n    for (var key in patterns) {\n      var match = true;\n      // Check all queries for matches\n      for (var wordKey in queries) {\n        var titleUrlMatch = false;\n        if (patterns[key].url.indexOf(queries[wordKey]) != -1 ||\n          ((patterns[key].title || '').toLowerCase().indexOf(queries[wordKey]) != -1)) {\n          titleUrlMatch = true;\n        }\n        var queryMatch = false;\n        for (var qkey in patterns[key].query) {\n          var q = patterns[key].query[qkey];\n          if (q.indexOf(queries[wordKey]) != -1) {\n            queryMatch = true;\n            break;\n          }\n        }\n        if (!queryMatch && !titleUrlMatch) {\n          match = false;\n          break;\n        }\n      }\n      if (match) newPatterns.push(patterns[key]);\n    }\n    return newPatterns;\n  },\n  // Deduplicate URLs and titles\n  _removeDuplicates: function(patterns) {\n    var newPatterns;\n    newPatterns = CliqzHistoryCluster._removeDuplicatesByKey(patterns, '_genUrl');\n    newPatterns = CliqzHistoryCluster._removeDuplicatesByKey(newPatterns, 'title');\n    return newPatterns;\n  },\n  // Deduplicate entries by value of key, with a preference for https and proper titles\n  _removeDuplicatesByKey: function(patterns, key) {\n    var reorg = {};\n    var order = [];\n\n    var value;\n\n    // Pass 1: group similar entries by key\n    for (var i = 0; i < patterns.length; i++) {\n      value = patterns[i][key];\n      if (!reorg.hasOwnProperty(value)) {\n        order.push(value);\n        reorg[value] = [];\n      }\n      reorg[value].push(patterns[i]);\n    }\n\n    // Pass 2: take the best entry from each group\n    // and add to newPatterns in original order.\n    var newPatterns = [];\n    for (i = 0; i < order.length; i++) {\n      value = order[i];\n\n      if (reorg[value].length == 1) {\n        newPatterns.push(reorg[value][0]);\n        continue;\n      }\n\n      // Separate http and https links\n      var https = [],\n          http = [];\n      for (var j = 0; j < reorg[value].length; j++) {\n        if (reorg[value][j].url.indexOf('https://') === 0) {\n          https.push(reorg[value][j]);\n        } else {\n          http.push(reorg[value][j]);\n        }\n      }\n\n      // if any https links, proceed with them only\n      var candidates;\n      if (https.length > 0)\n        candidates = https;\n      else\n        candidates = http;\n\n      // Pick the one with a \"real\" title.\n      // Some history entries will have a title the same as the URL,\n      // don't use these if possible.\n      var found = false;\n      for (var x = 0; x < candidates.length; x++) {\n        if (!(candidates[x].title == candidates[x]._genUrl ||\n             candidates[x].title == 'www.' + candidates[x]._genUrl ||\n             candidates[x].title == candidates[x].url)) {\n          newPatterns.push(candidates[x]);\n          found = true;\n          break;\n        }\n      }\n      if (!found)\n        newPatterns.push(candidates[0]);\n    }\n\n    return newPatterns;\n  },\n  // Search all patterns for matching substring (should be domain)\n  _findCommonDomain: function(patterns) {\n    if (patterns.length < 2) {\n      return null;\n    }\n    var scores = {};\n\n    for (var key in patterns) {\n      var url1 = patterns[key]._genUrl;\n      scores[url1] = true;\n      for (var key2 in patterns) {\n        var url2 = patterns[key2]._genUrl;\n        if (key != key2 && url2.indexOf(url1) == -1) {\n          scores[url1] = false;\n        }\n      }\n    }\n\n    // Return match with most occurences\n    for (var scorekey in scores) {\n      if (scores[scorekey] === true) {\n        return scorekey;\n      }\n    }\n    return null;\n  },\n  // Move base domain to top\n  _adjustBaseDomain: function(patterns, query) {\n    if (patterns.length === 0) {\n      return [];\n    }\n    var basePattern = null, baseUrl = null, favicon = null,\n        commonDomain = CliqzHistoryCluster._findCommonDomain(patterns);\n\n    // Check for url matching query\n    query = CliqzUtils.generalizeUrl(query, true);\n    var key;\n    for (key in patterns) {\n      var url = patterns[key].url;\n      if (url.indexOf(query) === 0) {\n        baseUrl = url;\n        favicon = patterns[key].favicon;\n        break;\n      }\n    }\n\n    // if none found, use the first entry\n    if (!baseUrl) {\n      baseUrl = patterns[0]._genUrl;\n      favicon = patterns[0].favicon;\n    }\n\n    baseUrl = commonDomain || baseUrl.split('/')[0];\n\n    // find if there is an entry matching the base URL.\n    var pUrl;\n    for (var i = 0; i < patterns.length; i++) {\n      pUrl = patterns[i]._genUrl;\n      if (baseUrl == pUrl) {\n        basePattern = patterns[i];\n        break;\n      }\n    }\n    var https = false;\n    var newPatterns = [];\n    if (basePattern) {\n      // found a history entry representing the base pattern,\n      // use at the first entry in newPatterns\n      basePattern.base = true;\n      patterns[0].debug = 'Replaced by base domain';\n      newPatterns.push(basePattern);\n\n    } else {\n      CliqzUtils.log('Using a base url that did not exist in history list.', 'CliqzHistoryCluster');\n\n      for (key in patterns) {\n        // if any pattern uses an https domain, try to use that for\n        // base domain too.\n        pUrl = patterns[key].url;\n        if (pUrl.indexOf('https://') === 0) {\n          https = true;\n          break;\n        }\n\n        // Add https if required\n        if (https) {\n          // ...but only if there is a history entry with title\n          if (CliqzHistoryManager.getPageTitle('https://' + baseUrl)) {\n            CliqzUtils.log('found https base URL with title', 'CliqzHistoryCluster');\n            // keep https as true\n          } else {\n            CliqzUtils.log('no https base URL with title, do not change original base URL', 'CliqzHistoryCluster');\n            https = false;\n          }\n        }\n      }\n    }\n\n    for (key in patterns) {\n      // keep everything else except for base, it is already there\n      if (patterns[key] != basePattern) newPatterns.push(patterns[key]);\n    }\n    return [newPatterns, baseUrl, favicon, https];\n  },\n  // Add base domain of given result to top of patterns, if necessary\n  _addBaseDomain: function(patterns, baseUrl, favicon, https) {\n    baseUrl = CliqzUtils.generalizeUrl(baseUrl, true);\n    // Add base domain entry if there is not one already\n    if (patterns && patterns.length > 0 && !patterns[0].base) {\n      var title = CliqzUtils.getDetailsFromUrl(baseUrl).domain;\n      if (!title) {\n        CliqzUtils.log('Failed to add base domain because there is no title: ' + baseUrl, 'CliqzHistoryCluster');\n        return;\n      }\n\n      CliqzUtils.log('Adding base domain to history cluster: ' + baseUrl, 'CliqzHistoryCluster');\n\n      // Add trailing slash if not there\n      var urldetails = CliqzUtils.getDetailsFromUrl(baseUrl);\n      if (urldetails.path === '')\n        baseUrl = baseUrl + '/';\n\n      patterns.unshift({\n        title: title.charAt(0).toUpperCase() + title.split('.')[0].slice(1),\n        url: baseUrl,\n        favicon: favicon\n      });\n      patterns[0].autoAdd = true;\n    }\n  },\n  // Autocomplete an urlbar value with the given patterns\n  autocompleteTerm: function(urlbar, pattern, loose) {\n    var MAX_AUTOCOMPLETE_LENGTH = 80; // max length of autocomplete portion\n\n    function matchQuery(queries) {\n      var query = '';\n      for (var key in queries) {\n        var q = queries[key].toLowerCase();\n        if (q.indexOf(input) === 0 && q.length > query.length) {\n          query = q;\n        }\n      }\n      return query;\n    }\n    if (urlbar == 'www.' || urlbar == 'http://' || urlbar.substr(urlbar.indexOf('://') + 3) == 'www.' || urlbar === '')\n      return {};\n\n    var url = CliqzUtils.simplifyUrl(pattern.url);\n    url = CliqzUtils.generalizeUrl(url, true);\n    var input = CliqzUtils.generalizeUrl(urlbar);\n    if (urlbar[urlbar.length - 1] == '/') input += '/';\n\n    var autocomplete = false,\n      highlight = false,\n      selectionStart = 0,\n      urlbarCompleted = '';\n    var queryMatch = matchQuery(pattern.query);\n\n    // Url\n    if (url.indexOf(input) === 0 && url != input &&\n       (url.length - input.length) <= MAX_AUTOCOMPLETE_LENGTH) {\n      autocomplete = true;\n      highlight = true;\n      urlbarCompleted = urlbar + url.substring(url.indexOf(input) + input.length);\n    }\n\n    if (autocomplete) {\n      selectionStart = urlbar.toLowerCase().lastIndexOf(input) + input.length;\n    }\n\n    // Adjust url to user protocol\n    if (urlbar.indexOf('://') != -1) {\n      var prot_user = urlbar.substr(0, urlbar.indexOf('://') + 3);\n      var prot_auto = pattern.url.substr(0, pattern.url.indexOf('://') + 3);\n      pattern.url = pattern.url.replace(prot_auto, prot_user);\n    }\n\n    return {\n      url: url,\n      full_url: pattern.url,\n      autocomplete: autocomplete,\n      urlbar: urlbarCompleted,\n      selectionStart: selectionStart,\n      highlight: highlight\n    };\n  },\n\n  // Attach a list of URLs to a cluster result\n  _attachURLs: function(result, urls, with_favicon) {\n    result.data.urls = [];\n\n    for (var i = 0; i < urls.length; i++) {\n      var domain = CliqzUtils.generalizeUrl(urls[i].url, true).split('/')[0],\n          url = urls[i].url;\n\n      if (url[url.length - 1] == '/') url = url.substring(0, url.length - 1);\n\n      var favicon = with_favicon && (urls[i].favicon == FF_DEF_FAVICON ? Q_DEF_FAVICON : urls[i].favicon),\n          cleanUrl = CliqzUtils.cleanUrlProtocol(CliqzUtils.simplifyUrl(url), true);\n\n      result.data.urls.push({\n        href: urls[i].url,\n        link: cleanUrl,\n        domain: cleanUrl.split('/')[0],\n        title: urls[i].title,\n        extra: 'history-' + i,\n        favicon: favicon,\n        // logo is only necessary for 3-up mini-history view, this can be removed if that is retired\n        logo: CliqzUtils.getLogoDetails(CliqzUtils.getDetailsFromUrl(urls[i].url)),\n        kind: ['H']\n      });\n      if ((result.data.urls.length > 9 && result.data.template == 'pattern-h1') ||\n          (result.data.urls.length > 5 && result.data.template == 'pattern-h2') ||\n          (result.data.urls.length > 2 && result.data.template == 'pattern-h3')) {\n        break;\n      }\n    }\n  },\n  // Creates one (or potentially more) instant results based on history\n  createInstantResult: function(res, searchString, callback) {\n    var instant_results = [];\n    var results = res.filteredResults();\n    var promises = [];\n\n    if (results.length === 0 && !res.urls) {\n      // no results, so do nothing\n\n    } else if (res.urls) {\n      // Rule-based clustering has already been performed, just take the entry as it is\n      var instant = Result.generic('cliqz-pattern', res.url, null, res.title, null, searchString, res);\n      instant.comment += ' (history rules cluster)';\n      // override with any titles we have saved\n      //promises.push(CliqzHistoryCluster._getTitle(instant));\n\n      instant.data.template = 'pattern-h2';\n      instant.data.cluster = true; // a history cluster based on a destination bet\n      instant_results.push(instant);\n\n    } else if (searchString.length === 0) {\n      // special case for user request of top sites from history\n      var instant = Result.generic('cliqz-pattern', '', null, '', null, searchString);\n      instant.data.title = CliqzUtils.getLocalizedString('history_results_cluster');\n      instant.data.url = results[0].url;\n      instant.comment += ' (history top sites)!';\n      instant.data.template = 'pattern-h1';\n      instant.data.generic = true;\n\n      this._attachURLs(instant, results);\n\n      instant_results.push(instant);\n\n    } else if (res.cluster) {\n      // domain-based cluster\n      var instant = Result.generic('cliqz-pattern', results[0].url, null, results[0].title, null, searchString);\n      var title = results[0].title;\n      if (!title) {\n        title = results[0].url;\n        CliqzUtils.log('No title, assigning ' + title, 'CliqzHistoryCluster');\n      }\n      instant.data.title = title;\n      // override with any titles we have saved\n      //promises.push(CliqzHistoryCluster._getTitle(instant));\n\n      // get description in case we need it\n      //(if this cluster is converted back to simple history)\n      //promises.push(CliqzHistoryCluster._getDescription(instant));\n\n      instant.data.url = results[0].url;\n      instant.comment += ' (history domain cluster)!';\n      instant.data.template = 'pattern-h2';\n      instant.data.autoAdd = results[0].autoAdd;\n      instant.data.cluster = true; // a history cluster based on a destination bet\n\n      // first entry is used as the main URL of this cluster, remove from remaining result list\n      results.shift();\n\n      CliqzHistoryCluster._attachURLs(instant, results);\n\n      instant_results.push(instant);\n\n    } else if (results.length < 3) {\n      for (var i = 0; i < results.length; i++) {\n        var instant = Result.generic('favicon', results[i].url, null, results[i].title, null, searchString);\n        instant.comment += ' (history generic)!';\n        instant.data.kind = ['H'];\n        //promises.push(CliqzHistoryCluster._getDescription(instant));\n        instant_results.push(instant);\n      }\n    } else {\n      // 3-up combined generic history entry\n      var instant = Result.generic('cliqz-pattern', '', null, '', null, searchString);\n      instant.data.title = '';\n      instant.comment += ' (history generic)!';\n      instant.data.template = 'pattern-h3';\n      instant.data.generic = true;\n\n      this._attachURLs(instant, results, true);\n\n      instant_results.push(instant);\n    }\n\n    if (typeof(Promise) === 'undefined') {\n      // Firefox versions < 29\n      callback(instant_results);\n    } else {\n      Promise.all(promises).then(function(data) {\n        callback(instant_results);\n      });\n    }\n  },\n  // Removes a given url from the instant.data.url list\n  removeUrlFromResult: function(urlList, _url) {\n    var url = CliqzUtils.generalizeUrl(_url);\n    for (var key in urlList) {\n      var r_url = CliqzUtils.generalizeUrl(urlList[key].href);\n      if (r_url == url) {\n        urlList.splice(key, 1);\n        return;\n      }\n    }\n  }\n};\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzHistoryCluster;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzHistoryCluster\n\n","// start module CliqzRequestMonitor\n(function(ctx,Q,E){\nvar EXPORTED_SYMBOLS = [\"CliqzRequestMonitor\"];\n\nfunction CliqzRequestMonitor() {\n  this._requests = [];\n  this.TTL = 120000; // two minutes\n  this.HEALTH_LEVEL = 0.8;\n}\n\nCliqzRequestMonitor.prototype = {\n  requests: function () {\n    var deadline = new Date() - this.TTL,\n        reqs;\n\n    // removing 'dead' requests\n    while(this._requests[0] && this._requests[0].timestamp < deadline) {\n      this._requests.shift();\n    }\n\n    // removing 'pending' requests\n    reqs = this._requests.filter(function (req) {\n      if(req.readyState === 4) { return req; }\n    });\n\n    return reqs;\n  },\n\n  // checks status codes of all requests in the registry and compare the\n  // rate of successful ones to HEALTH LEVEL\n  inHealth: function () {\n    var reqs = this.requests(),\n        health = reqs.filter(function (req) {\n          return req.status === 200;\n        }).length / reqs.length;\n\n    return isNaN(health) || health >= this.HEALTH_LEVEL;\n  },\n\n  addRequest: function (req) {\n    this._requests.push(req);\n  },\n\n};\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzRequestMonitor;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzRequestMonitor\n\n","// start module CliqzResultProviders\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module handles the search engines present in the browser\n * and provides a series of custom results\n *\n */\n\nvar EXPORTED_SYMBOLS = ['CliqzResultProviders'];\n\n Components.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n Components.utils.import('resource://gre/modules/Services.jsm');\n\n XPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\n XPCOMUtils.defineLazyModuleGetter(this, 'Result',\n  'chrome://cliqzmodules/content/Result.jsm');\n\n XPCOMUtils.defineLazyModuleGetter(this, 'CliqzCalculator',\n  'chrome://cliqzmodules/content/CliqzCalculator.jsm');\n\n Components.utils.import('chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\n\n\n// INIT_KEY ('newProvidersAdded') was used only as a boolean but now we have multiple states\n// state 1 -> Google images & Google maps\n// state 2 -> YouTube engine is added\n// state 3 -> Aliases (shortcuts) are updated:\n//  - to first 2 letters for default engines\n//  - to key property for NonDefaultProviders\n// state 4 -> Ecosia engine is added\n\n var INIT_KEY = 'newProvidersAdded',\n     LOG_KEY = 'NonDefaultProviders.jsm',\n     KEY ='#',\n     CUSTOM = {\n      '#fee': {\n        url: 'https://cliqz.com/support/'\n      },\n      '#team': {\n        url: 'https://cliqz.com/team/'\n      },\n      '#cliqz': {\n        url: 'https://cliqz.com/'\n      },\n      '#join': {\n        url: 'https://cliqz.com/jobs/'\n      }\n     },\n     ENGINE_CODES = [\n      'google images',\n      'google maps',\n      'google',\n      'yahoo',\n      'bing',\n      'wikipedia',\n      'amazon',\n      'ebay',\n      'leo',\n      'youtube',\n      'ecosia'\n    ];\n\n// REFS:\n// http://stenevang.wordpress.com/2013/02/22/google-search-url-request-parameters/\n// https://developers.google.com/custom-search/docs/xml_results#hlsp\n\n\nvar CliqzResultProviders = {\n  init: function () {\n    CliqzUtils.log('CliqzResultProviders initialized', LOG_KEY);\n    CliqzResultProviders.manageProviders();\n  },\n  manageProviders: function() {\n\n    var newProviderAdded = CliqzResultProviders.addCustomProviders();\n\n    if(newProviderAdded) {\n      CliqzResultProviders.updateEngineAliases();\n    }\n  },\n  addCustomProviders: function() {\n    var providersAddedState,\n        maxState = -1,\n        newProviderIsAdded = false;\n\n    if (typeof CliqzUtils.getPref(INIT_KEY) === \"boolean\") {\n      providersAddedState = 1;\n    } else {\n      providersAddedState = CliqzUtils.getPref(INIT_KEY, 0);\n    }\n\n    NonDefaultProviders.forEach(function (extern) {\n      CliqzUtils.log(\"NonDefaultProviders\");\n      try {\n        CliqzUtils.log('Analysing ' + extern.name, LOG_KEY);\n        if (!CLIQZEnvironment.getEngineByName(extern.name)) {\n          if (providersAddedState < extern.state) {\n            maxState = extern.state > maxState ? extern.state : maxState;\n            CliqzUtils.log('Added ' + extern.name, LOG_KEY);\n            CLIQZEnvironment.addEngineWithDetails(extern);\n          }\n        }\n      } catch (e) {\n        CliqzUtils.log(e, 'err' + LOG_KEY);\n      }\n    });\n\n    if (maxState > 0) {\n      CliqzUtils.setPref(INIT_KEY, maxState);\n      newProviderIsAdded = true;\n    }\n\n    return newProviderIsAdded;\n  },\n  updateEngineAliases: function() {\n    CliqzResultProviders.getSearchEngines().forEach(function (engine) {\n      var alias = engine.alias;\n      if(!alias) { alias = CliqzResultProviders.createShortcut(engine.name); }\n      if(engine.prefix && (engine.name === alias)) { alias = engine.prefix; }\n      CliqzResultProviders.updateAlias(engine.name, alias);\n\n    });\n  },\n  updateAlias: function(name, newAlias) {\n    CLIQZEnvironment.updateAlias(name, newAlias);\n    CliqzUtils.log(\"Alias of engine  \" + name + \" was updated to \" + newAlias, LOG_KEY);\n  },\n  getCustomResults: function (q) {\n    var results = null;\n    var customQuery = CliqzResultProviders.customizeQuery(q);\n\n    if(customQuery){\n      results = [\n        Result.generic(\n          Result.CLIQZC + ' sources-' + customQuery.code,\n          customQuery.queryURI,\n          null,\n          null,\n          null,\n          null,\n          {\n            q: customQuery.updatedQ,\n            engine: customQuery.engineName\n          }\n        )\n      ];\n      q = customQuery.updatedQ;\n    } else if(CliqzCalculator.isCalculatorSearch(q)) {\n      var calcRes = CliqzCalculator.calculate(q);\n      if (calcRes != null) {\n        results = [calcRes];\n      }\n    }\n    return [q, results];\n  },\n  getEngineCode: function (engineName) {\n    for(var c in ENGINE_CODES) {\n      if(engineName.toLowerCase().indexOf(ENGINE_CODES[c]) != -1){\n        return +c + 1;\n      }\n    }\n    // unknown engine\n    return 0;\n  },\n  setCurrentSearchEngine: function(engine){\n    Services.search.currentEngine = CliqzResultProviders.getEngineByName(engine);\n  },\n  // called for each query\n  customizeQuery: function(q){\n    if(CUSTOM[q.trim()] && CUSTOM[q.trim()].url){\n      return {\n        updatedQ  : q,\n        engineName: 'CLIQZ',\n        queryURI  : CUSTOM[q.trim()].url,\n        code      : '#'\n      }\n    }\n    // a prefix has min 4 chars\n    if(q.length < 5) return false;\n\n    var components = q.split(' ');\n\n    if(components.length < 2) return false;\n\n    var start = components[0],\n        end = components[components.length-1],\n        engineName, uq;\n\n    if(CliqzResultProviders.getEngineByAlias(start)) {\n      engineName = CliqzResultProviders.getEngineByAlias(start).name;\n      uq = q.substring(start.length + 1);\n    } else if(CliqzResultProviders.getEngineByAlias(end)) {\n      engineName = CliqzResultProviders.getEngineByAlias(end).name;\n      uq = q.substring(0, q.length - end.length - 1);\n    }\n\n    if (engineName && uq) {\n      return {\n        updatedQ:   uq,\n        engineName: engineName,\n        queryURI:   CliqzResultProviders.getSubmissionByEngineName(engineName, uq),\n        code:       CliqzResultProviders.getEngineCode(engineName)\n      };\n    } else {\n      return null;\n    }\n  },\n  getEngineByName: function(engine) {\n    return CLIQZEnvironment.getEngineByName(engine);\n  },\n  getEngineByAlias: function(alias) {\n    return CLIQZEnvironment.getEngineByAlias(alias);\n  },\n  getSubmissionByEngineName: function(name, query){\n    var engines = CliqzResultProviders.getSearchEngines();\n    for(var i=0; i < engines.length; i++){\n      if(engines[i].name == name){\n        return engines[i].getSubmissionForQuery(query);\n      }\n    }\n  },\n  // called once at visual hashtag creation\n  // TODO: use the updated shortcuts from about:preferences#search\n  getShortcut: function(name){\n    for(var i=0; i < NonDefaultProviders.length; i++)\n      if(NonDefaultProviders[i].name === name)\n        return NonDefaultProviders[i].key;\n\n    return CliqzResultProviders.createShortcut(name);\n  },\n  // create a unique shortcut -> first 2 lowercased letters\n  createShortcut: function(name){\n    return KEY + name.substring(0, 2).toLowerCase();\n  },\n  getSearchEngines: function(){\n    return CLIQZEnvironment.getSearchEngines().map(function(e){\n      e.prefix = CliqzResultProviders.getShortcut(e.name);\n      e.code   = CliqzResultProviders.getEngineCode(e.name);\n\n      return e;\n    });\n  }\n}\n\n// TODO: create language/location aware customization\nvar NonDefaultProviders = [\n  {\n    key: \"#gi\",\n    url: \"https://www.google.de/search?tbm=isch&q={searchTerms}&hl=de\",\n    name: \"Google Images\",\n    iconURL: \"data:image/gif;base64,R0lGODlhEgANAOMKAAAAABUVFRoaGisrKzk5OUxMTGRkZLS0tM/Pz9/f3////////////////////////yH5BAEKAA8ALAAAAAASAA0AAART8Ml5Arg3nMkluQIhXMRUYNiwSceAnYAwAkOCGISBJC4mSKMDwpJBHFC/h+xhQAEMSuSo9EFRnSCmEzrDComAgBGbsuF0PHJq9WipnYJB9/UmFyIAOw==\",\n    method: 'GET',\n    state:1\n  },\n  {\n    key: \"#gm\",\n    url: \"https://maps.google.de/maps?q={searchTerms}\",\n    name: \"Google Maps\",\n    iconURL: \"data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEACABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAABILAAASCwAAAAEAAAABAAA+VeMAZMbFAH7k/wBGy/4A/8hpAITk/wAsPNkAE8P8AFXc/wBF2f8A/8BRAP+5OwAh0v8Aqev/AExm6QA21v8A/cpwAAXJ/wAa0f8A/8dmAP/GYgCa6f8A/8NZAFzd/wCT5/8A/8VeAP++SgAq1P8ABc3/ADRI3gADy/8AKc7+AFRx7gCktfgA/sBPAP/CVgBx4f8ALdP/AAHM/wBAWeUA/7tBADpP4QCJ5f8APtj/ACg31gCi6v8A/71GAL/v/wBFydoAJTjUAB5s3wC8y6AANsD9ACvG/gBNauwAnbWRAKPJ9QCmvpQALdT/ABojzgBRZOAAue7/ACBJ1wAyRdwAFsX0AD2y8QAXz/8AEhnKAJXo/wBoheEA18B3AJ3JqQAKx/4AIS3SAN/OjgAJyP4A+MFfAPf4/gD4wWAAXnzxABWn7gAdvv0Aat//ACY01QA3St4ADcr2AGrI+gA5xuoAPMv0ADrM/gAny/UAM9D+ADHV/wBWgu4AS9r/AI+n7gClrvAAjsetAEnW/gA0xNwAOdf/ACfT/wCO5v8AJ1LXAJ+m7QBed+4AR2LpABjP/wANyPoAcbT0AAzO/wALN80AW27nAEvG0QAV0P8A4r9xADjS/gA0XNsAPdf/AC4/2gCe6f8ARV/oAP+4NgB1wbYAQNH+ANLz/wAAzP8A////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf2J0Hx9YMxAQBBMZFgoifxIlaxERMAQTFBkjChooCwt4DSRlJkcQe3tGGRYKGih6JAUYfRcBSh4RQDlOFiIuCxIrGw99ZGNVHhFIexkjGigbXg8MBSpvHH4eEQEUFgouKxcJXAI4Q2wcfh5hExkKGghSCAkqXztQbiYmcXNMNzckAiQXRDxJMmUSckJaVzU0ZhgqAm13LDFBDzobJVtZAxgVKlYnHXcsPgccfh5LB1ENDRVdJykdd1NFfX19fX19Lz0tIGonKT8GZ3YPfHx8A38vLU82eQBUd3V8fHx8fH9/f38hIA4nKVRof39/f39/f39/TSFpDnBgf39/f39/f4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAA4D8AAOB/AAA=\",\n    method: 'GET',\n    state: 1\n  },\n  {\n    key: \"#yt\",\n    url: \"https://www.youtube.de/results?search_query={searchTerms}\",\n    name: \"YouTube\",\n    iconURL: 'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgNkQkIDZGiCA2RzAgNkcwIDZH/CA2R/wgNkf8IDZH/CA2R/wgNkf8IDZH/CA2R2AgNkcwIDZHMCA2RhAgNkQYIDpWHCA6V/wgOlf8IDpX/CA6V/wgOlf8IDpX/CA6V/wgOlf8IDpX/CA6V/wgOlf8IDpX/CA6V/wgOlf8IDpWHCQ6ZzAkOmf8JDpn/CQ6Z/wkOmf8JDpb/BQhc/wgMgf8JDpn/CQ6Z/wkOmf8JDpn/CQ6Z/wkOmf8JDpn/CQ6ZzAkOnuoJDp7/CQ6e/wkOnv8JDp7/Exed/8jIy/9RU4j/Bwp0/wkOm/8JDp7/CQ6e/wkOnv8JDp7/CQ6e/wkOnuoJD6T8CQ+k/wkPpP8JD6T/CQ+k/xUbo//V1dX/1dXV/4yNrP8QFG//CA6Y/wkPpP8JD6T/CQ+k/wkPpP8JD6T8CQ+q/wkPqv8JD6r/CQ+q/wkPqv8WG6n/3d3d/93d3f/d3d3/v7/M/y0wjv8JD6r/CQ+q/wkPqv8JD6r/CQ+q/woQr/8KEK//ChCv/woQr/8KEK//Fx2v/+fn5//n5+f/5+fn/+jo6P+YmtP/ChCv/woQr/8KEK//ChCv/woQr/8KELX8ChC1/woQtf8KELX/ChC1/xgdtf/x8fH/8fHx//Ly8v+bndv/Ehi3/woQtf8KELX/ChC1/woQtf8KELX8ChG76goRu/8KEbv/ChG7/woRu/8YH77/+fn5/+/v9/9fY9H/ChG7/woRu/8KEbv/ChG7/woRu/8KEbv/ChG76goRwMwKEcD/ChHA/woRwP8KEcD/EBfB/6Ol5/8tM8n/ChHA/woRwP8KEcD/ChHA/woRwP8KEcD/ChHA/woRwMwLEcSHCxHE/wsRxP8LEcT/CxHE/wsRxP8LEcT/CxHE/wsRxP8LEcT/CxHE/wsRxP8LEcT/CxHE/wsRxP8LEcSHCxLICQsSyKULEsjMCxLI+QsSyP8LEsj/CxLI/wsSyP8LEsj/CxLI/wsSyP8LEsj/CxLI0gsSyMwLEsiiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAD//wAA//8AAA==',\n    method: 'GET',\n    state: 2\n  },\n  {\n    key: \"#ec\",\n    url: \"https://www.ecosia.org/search?q={searchTerms}&ref=cliqz\",\n    name: \"Ecosia\",\n    iconURL: 'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAC8qzQBuaw3UrmsN6u5rDfruaw37bmsN+25rDfSuaw3fLmsNyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC2rTokrLFGurqsNv+5rDf/uaw3/7msN/+5rDf/uaw3/7urNP/AqS7suqw2aAAAAAAAAAAAAAAAAAAAAAC/qjApkbpn4mvJlf/EqCr/uaw3/7msN/+5rDf/uaw3/7urNP+rsUj/ib5x/7qsNv+9qzKBAAAAAAAAAAC5rDcLwKkvzom9cf813Nb/lrlh/8KoLP+5rDf/uaw3/7msN//BqS3/eMSF/yXj6v+BwHv/lbli/7atO1IAAAAAuaw3bsCqL/+Rumb/K+Di/z3ZzP+dtln/vqox/7msN/+5rDf/waku/23Ikv8s4OH/ONvS/5m4Xv+7qzXZuaw3CbmsN9DBqS7/hL93/zDe3f8v393/RdbD/7OuPv+7qzX/uqw2/8WoKf99wn//Lt/e/y/e3f99wn//v6ow/7msN0+7qzT7s64+/0bWwf8y3tn/L97d/03TuP+usET/vKoz/7isOP+vr0P/XM6n/zDe3P813Nb/L97d/5O6Zf/EpymOu6s0/7OuPv8+2cv/J+Hn/1HStP+0rjz/vasy/76qMP9zxYr/NtzV/zTd1/823NX/NtzV/zLd2f9I1b//mbheqsGpLf+gtVX/bseR/3fEhv+wr0L/vaoy/7msN/+/qjD/Wc+q/yvg4/813Nb/Md7b/zfc1P833NT/Mt7a/zbc1aqHvnT6bMiT/522WP+wr0L/vqox/7msN/+5rDf/vaoy/6C1VP8/2cr/N9zT/2vJlf9hzKD/NtzU/zbc1f813NaONdzWz3HGjv9ky53/prNN/8SoKv+8qzT/uaw3/7msOP/EqCr/ecOE/0HYx/9V0K//N9vT/zXc1v823NX/NtzVTjXc120w3tz/Lt/e/0zUu/+Fv3X/rrBF/7msN/+7qzX/vaoy/6qxSf9G1sH/L9/d/zPd2P8x3tv/L9/e2C/f3Qk23NUKNtzVzDbc1v823NX/OdvQ/0nVvv+xr0H/ta07/7+qL/+7qzT/r69D/2LMoP823NX/VNGx/2TLnVEAAAAAAAAAADbc1Sc03dfgQNnJ/2bKm/862tD/pLRP/1vOqf9S0rP/ib1x/8CpL/+4rDj/qLJM/7qsNn4AAAAAAAAAAAAAAAAAAAAAM93YI0vUvLtux5H/VdGw/3DHj/9Zz6r/Xc2m/3rDgv+5rDf/u6s1672rM2gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAyaYjUburNaytsUbZuK056cGpLuS/qjDGuaw3gLmsNx4AAAAAAAAAAAAAAAAAAAAA+D8AAOAPAADAAwAAgAMAAIABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAACAAQAAgAMAAMAHAADgDwAA+B8AAA==',\n    method: 'GET',\n    state: 4\n  }\n];\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzResultProviders;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzResultProviders\n\n","// start module CliqzSpellCheck\n(function(ctx,Q,E){\n'use strict';\n\nComponents.utils.import(\"resource://gre/modules/Services.jsm\");\nComponents.utils.import(\"resource://gre/modules/FileUtils.jsm\");\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n                                  'chrome://cliqzmodules/content/CliqzUtils.jsm');\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzAutocomplete',\n                                  'chrome://cliqzmodules/content/CliqzAutocomplete.jsm');\n\nvar EXPORTED_SYMBOLS = [\"CliqzSpellCheck\"];\n\nvar CliqzSpellCheck = {\n    check: function(q) {\n        var words = q.split(\" \");\n        var correctBack = {}\n        for (var i = 0; i < words.length; i++) {\n            if (words[i] == \"\") continue;\n            if (CliqzAutocomplete.spellCorrectionDict.hasOwnProperty(words[i])) {\n                var correct = CliqzAutocomplete.spellCorrectionDict[words[i]];\n                if (correct.length > words[i].length &&\n                    correct.slice(0, words[i].length) == words[i] &&\n                    i == words.length - 1) continue;\n                if (correct.length < words[i].length &&\n                    words[i].slice(0, correct.length) == correct &&\n                    i == words.length - 1) continue;\n                if (i == words.length - 1 && words[i].length <= 10)  // long enough to correct the last word\n                    continue\n                correctBack[correct] = words[i];\n                words[i] = correct;\n            }\n        }\n        return [words.join(\" \"), correctBack];\n    },\n    loadRecords: function(req) {\n        var content = req.response.split(\"\\n\");\n        for (var i=0; i < content.length; i++) {\n            var words = content[i].split(\"\\t\");\n            var wrong = words[0];\n            var right = words[1];\n            CliqzAutocomplete.spellCorrectionDict[wrong] = right;\n        }\n    },\n    init: function() {\n        if (CliqzUtils.getPref(\"config_location\", \"\") == \"de\" && Object.keys(CliqzAutocomplete.spellCorrectionDict).length == 0) {\n            CliqzUtils.log('loading dict', 'spellcorr');\n            CliqzUtils.loadResource('chrome://cliqz/content/spell_check.list', CliqzSpellCheck.loadRecords);\n        }\n    }\n}\n\n; ctx[EXPORTED_SYMBOLS[0]] = CliqzSpellCheck;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzSpellCheck\n\n","// start module CliqzWikipediaDeduplication\n(function(ctx,Q,E){\n'use strict';\n/**\n * This modules implements reranking of results using user specific data\n */\n\nvar EXPORTED_SYMBOLS = ['CliqzWikipediaDeduplication'];\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzLanguage',\n    'chrome://cliqzmodules/content/CliqzLanguage.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n    'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\n\n\nvar CliqzWikipediaDeduplication = {\n    LOG_KEY: 'CliqzWikipediaDeduplication',\n    name: 'lang_deduplication',\n\n    /* choose best url from list based on original order (reranking)*/\n    chooseUrlByIndex: function(searchedUrls, originalUrls){\n        var maxPos = originalUrls.length;\n        var bestUrl = null;\n        Object.keys(searchedUrls).forEach( function (lang) {\n            var urls = searchedUrls[lang];\n            urls.forEach(function (url){\n                var i = originalUrls.indexOf(url);\n                if (i < maxPos){\n                    maxPos = i;\n                    bestUrl = url;\n                }\n            });\n        });\n        return bestUrl;\n    },\n    /* choose best url from list taking language into account */\n    chooseUrlByLang: function(searchedUrls, originalUrls, requestedLangs){\n        if (requestedLangs == null || requestedLangs.length == 0){\n            return this.chooseUrlByIndex(searchedUrls, originalUrls);\n        }\n        var maxPos = originalUrls.length;\n        var bestUrl = null;\n        Object.keys(searchedUrls).forEach( function (lang) {\n            var urls = searchedUrls[lang];\n            urls.forEach(function (url) {\n                var i = originalUrls.indexOf(url);\n                if (i < maxPos && requestedLangs.indexOf(lang) != -1) {\n                    maxPos = i;\n                    bestUrl = url;\n                }\n            });\n        });\n        if (bestUrl == null){\n            bestUrl = this.chooseUrlByIndex(searchedUrls, originalUrls);\n        }\n        return bestUrl\n\n    },\n    /*strip protocol from url*/\n    urlStripProtocol: function(url){\n        var toRemove = [\"https://\", \"http://\",\n            \"www2.\", \"www.\",\n            \"mobile.\", \"mobil.\", \"m.\"];\n        toRemove.forEach(function (part) {\n            if (url.toLowerCase().startsWith(part)){\n                url = url.substring(part.length);\n            }\n        });\n        return url;\n    },\n    /*get most used user languages*/\n    getUserLanguages: function(factor){\n        factor = typeof factor !== 'undefined' ? factor : 1.5;\n        var availableLangs = CliqzLanguage.state(true);\n        var langs = [];\n        var lastValue = null;\n        availableLangs.forEach(function(langObj) {\n            // langObj = [\"de\", 0.0123]\n            if (lastValue == null) lastValue = langObj[1];\n            if (lastValue * factor >= langObj[1]){\n                langs.push(langObj[0]);\n                lastValue = langObj[1];\n            }\n\n        });\n        return langs;\n    },\n    // dedup of languages for wikipedia case\n    doRerank: function (response) {\n        //reset telemetry\n        var telemetrySignal = {};\n        var doDedup = CliqzUtils.getPref(\"languageDedup\", false);\n        if (doDedup && response != null) {\n\n            var userLangs = this.getUserLanguages();\n\n            // dict of wiki languages to urls\n            var wikiLangs = {};\n\n            // list of all wiki urls\n            var wikiUrls = [];\n\n            // list of candidates to dedup with back link to original url\n            // {\"de.wikipedia.org/url\": \"Https://de.wikipedia.org/URL\"}\n            var candidates = {};\n\n            // list of all urls in response\n            var allUrls = [];\n\n            // dedup result\n            var dedups = {};\n\n            // process response and fill all structures\n            response.forEach(function (r) {\n                var obj = CliqzUtils.getDetailsFromUrl(r.url);\n                if (obj.domain == \"wikipedia.org\" && obj.subdomains.length) {\n                    var lang = obj.subdomains[0];\n                    if (wikiLangs[lang] == null) wikiLangs[lang] = [];\n                    wikiLangs[lang].push(r.url);\n                    candidates[this.urlStripProtocol(r.url).toLowerCase()] = r.url;\n                    wikiUrls.push(r.url);\n                    dedups[r.url] = [];\n                }\n                allUrls.push(r.url);\n\n            }, this);\n            telemetrySignal['available_languages'] = Object.keys(wikiLangs).length;\n            if (Object.keys(wikiLangs).length > 1) {\n                // we have wikipedia with different langs, try possible dedup\n                var bestUrl = this.chooseUrlByLang(wikiLangs, allUrls, userLangs);\n\n                var ind = allUrls.indexOf(bestUrl);\n                var bestUrlData = response[ind];\n                var langlinks = [];\n                try {\n                    langlinks = bestUrlData.snippet.rich_data.langlinks;\n                } catch (e) {\n                }\n                langlinks.forEach(function (langlink) {\n                    var stripUrl = this.urlStripProtocol(langlink).toLowerCase();\n                    var stripLang = stripUrl.split(\".\")[0];\n                    if ((stripUrl in candidates) && (userLangs.indexOf(stripLang) == -1)) {\n                        var originalUrl = candidates[stripUrl];\n                        dedups[bestUrl].push(originalUrl);\n                        dedups[bestUrl].concat(dedups[originalUrl]);\n                        delete dedups[originalUrl];\n                    }\n                }, this);\n                var deduped = wikiUrls.length - Object.keys(dedups).length;\n                telemetrySignal['total_urls'] = wikiUrls.length;\n                telemetrySignal['removed_urls'] = deduped;\n\n                if (deduped > 0) {\n                    // backward structure with link where deduped url is pointing\n                    var invertedUrls = {};\n                    Object.keys(dedups).forEach(function (k) {\n                        dedups[k].forEach(function (url) {\n                            invertedUrls[url] = k;\n                        });\n                    });\n                    var dedupResponse = [];\n                    for (var i = 0; i < response.length; i++) {\n                        var responseObj = response[i];\n                        if (responseObj.url in invertedUrls) {\n                            // this url should be replaced by main url\n                            var mainInd = allUrls.indexOf(invertedUrls[responseObj.url]);\n                            if (mainInd != -1) {\n                                var mainObj = response[mainInd];\n                                dedupResponse.push(mainObj);\n                                delete allUrls[mainInd];\n                            }\n                        }\n                        else {\n                            var maybeDeleted = allUrls.indexOf(responseObj.url);\n                            if (maybeDeleted != -1) {\n                                dedupResponse.push(responseObj);\n                                delete allUrls[i];\n                            }\n                        }\n                    }\n\n                    response = dedupResponse;\n                }\n            }\n        }\n        // if no dedups found\n        return {\n            telemetrySignal: telemetrySignal,\n            response: response\n        };\n    }\n    \n};; ctx[EXPORTED_SYMBOLS[0]] = CliqzWikipediaDeduplication;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module CliqzWikipediaDeduplication\n\n","// start module Mixer\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module mixes the results from cliqz with the history\n *\n */\n\nvar EXPORTED_SYMBOLS = ['Mixer'];\n\nComponents.utils.import('resource://gre/modules/Services.jsm');\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'UrlCompare',\n  'chrome://cliqzmodules/content/UrlCompare.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'Result',\n  'chrome://cliqzmodules/content/Result.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CLIQZEnvironment',\n  'chrome://cliqzmodules/content/CLIQZEnvironment.jsm');\n\nvar CliqzSmartCliqzCache;\nvar SmartCliqzTriggerUrlCache;\n\nfunction objectExtend(target, obj) {\n  Object.keys(obj).forEach(function(key) {\n    target[key] = obj[key];\n  });\n\n  return target;\n}\n\n// enriches data kind\nfunction kindEnricher(newKindParams, kind) {\n  var parts = kind.split('|'),\n      params = JSON.parse(parts[1] || '{}');\n\n  objectExtend(params, newKindParams);\n\n  return parts[0] + '|' + JSON.stringify(params);\n}\n\nfunction resultKindEnricher(newKindParams, result) {\n  result.data.kind[0] = kindEnricher(newKindParams, result.data.kind[0]);\n  return result;\n}\n\nvar Mixer = {\n  EZ_COMBINE: [\n    'entity-generic', 'ez-generic-2', 'entity-search-1',\n    'entity-portal', 'entity-banking-2',\n  ],\n  EZ_QUERY_BLACKLIST: [\n    'www', 'www.', 'http://www', 'https://www',\n    'http://www.', 'https://www.',\n  ],\n\n  init: function() {\n    CliqzUtils.setTimeout(function() {\n      CliqzUtils.log('Init', 'Mixer');\n      CliqzUtils.importModule('smart-cliqz-cache/background').then(function(module) {\n        CliqzSmartCliqzCache = module.default.smartCliqzCache;\n        SmartCliqzTriggerUrlCache = module.default.triggerUrlCache;\n      }).catch(function(error) {\n        CliqzUtils.log('Failed loading SmartCliqzCache', 'Mixer');\n      });\n    }, 1000);\n  },\n\n  // Prepare 'extra' results (dynamic results from Rich Header) for mixing\n  _prepareExtraResults: function(results) {\n    // Remove invalid EZs\n    results = results.filter(function(r) {\n      if (Mixer._isValidEZ(r)) {\n        return true;\n      } else {\n        CliqzUtils.log('Discarding bad EZ: ' + JSON.stringify(r), 'Mixer');\n        return false;\n      }\n    });\n\n    // set trigger method for EZs returned from RH\n    return results.map(resultKindEnricher.bind(null, {\n      trigger_method: 'rh_query',\n    }));\n  },\n\n  // Various checks to make sure the supplied EZ is valid\n  _isValidEZ: function(ez) {\n    if (!ez.val) {\n      return false;\n    }\n\n    if (!ez.data) {\n      return false;\n    }\n\n    if (!ez.data.subType) {\n      return false;\n    }\n\n    if (!ez.data.__subType__) {\n      return false;\n    }\n\n    try {\n      var ezId = Mixer._getSmartCliqzId(ez);\n      if (!ezId) {\n        return false;\n      }\n      var ezClass = JSON.parse(ez.data.subType).class;\n      if (!ezClass) {\n        return false;\n      }\n    } catch (e) {\n      return false;\n    }\n\n    return true;\n  },\n\n  // Prepare backend results for mixing\n  _prepareCliqzResults: function(results) {\n    return results.map(function(result, i) {\n      var subType = JSON.parse(result.subType || '{}');\n      subType.i = i;\n      result.subType = JSON.stringify(subType);\n      return Result.cliqz(result);\n    });\n  },\n\n  // Prepare history results for mixing\n  _prepareHistoryResults: function(results) {\n    return results.map(Result.clone);\n  },\n  // Is query valid for triggering an EZ?\n  // Must have more than 2 chars and not in blacklist\n  //  - avoids many unexpected EZ triggerings\n  _isValidQueryForEZ: function(q) {\n    var trimmed = q.trim();\n    if (trimmed.length <= CLIQZEnvironment.MIN_QUERY_LENGHT_FOR_EZ) {\n      return false;\n    }\n\n    return Mixer.EZ_QUERY_BLACKLIST.indexOf(trimmed.toLowerCase()) == -1;\n  },\n\n  // extract any entity zone accompanying the result, add to extraResults\n  _addEZfromBM: function(extraResults, result) {\n    if (!result.extra) {\n      return;\n    }\n\n    var extra = Result.cliqzExtra(result.extra, result.snippet);\n    resultKindEnricher({trigger_method: 'backend_url'}, extra);\n    extraResults.push(extra);\n  },\n\n  // Collect all sublinks and return a single list.\n  //  - called recursively, looking for any keys that look like URLs\n  _collectSublinks: function(data) {\n    var links = [];\n\n    for (var key in data) {\n      if (typeof (data[key]) == 'object') {\n        // recurse\n        links = links.concat(Mixer._collectSublinks(data[key]));\n      } else if (['url', 'href'].indexOf(key) != -1) {\n        links.push(data[key]);\n      }\n    }\n\n    return links;\n  },\n\n  // mark entries in second that are found in first\n  _getDuplicates: function(first, second) {\n    return second.map(function(c) {\n      var duplicate = false;\n      first.forEach(function(i) {\n        // Does the main link match?\n        if (UrlCompare.sameUrls(c.label, i.label)) {\n          duplicate = true;\n          return;\n        }\n\n        // Do any of the sublinks match?\n        var sublinks = Mixer._collectSublinks(i.data);\n        sublinks.some(function(u) {\n          if (UrlCompare.sameUrls(u, c.label)) {\n            duplicate = true;\n            return true; // stop iteration\n          }\n        });\n      });\n\n      if (duplicate) {\n        return c;\n      }\n    }).filter(function(result) {\n      return result;\n    });\n  },\n\n  // Remove results from second list that are present in the first\n  // Copy some information (such as the kind) to entry in the first list\n  _deduplicateResults: function(first, second) {\n    var duplicates = Mixer._getDuplicates(first, second);\n\n    // remove duplicates from second list\n    second = second.filter(function(c) {\n      return duplicates.indexOf(c) === -1;\n    });\n\n    // take data from duplicate second result to augment result\n    // Note: this does not combine data if it is a sublink match\n    first = first.map(function(r) {\n      duplicates.forEach(function(dup) {\n        if (UrlCompare.sameUrls(r.val, dup.val)) {\n          r = Result.combine(r, dup);\n        }\n      });\n\n      return r;\n    });\n\n    return { first: first, second: second };\n  },\n\n  // Special case deduplication: remove clustered links from history if already\n  // somewhere else in the EZ\n  _deduplicateHistory: function(result) {\n    // Collect sublinks not in history\n    var otherLinks = [];\n    Object.keys(result.data).filter(function(key) {\n      return key != 'urls';\n    }).forEach(function(key) {\n      var sublinks = Mixer._collectSublinks(result.data[key]);\n      otherLinks.concat(sublinks);\n    });\n\n    // Filter history entry, if\n    result.data.urls = result.data.urls.filter(function(entry) {\n      var duplicate = false;\n      otherLinks.some(function(u) {\n        if (UrlCompare.sameUrls(u, entry.label)) {\n          duplicate = true;\n          return true; // stop iteration\n        }\n      });\n\n      return !duplicate;\n    });\n  },\n  _getSmartCliqzId: function(smartCliqz) {\n    return smartCliqz.data.__subType__.id;\n  },\n\n  // Find any entity zone in the results and cache them for later use.\n  // Go backwards to prioritize the newest, which will be first in the list.\n  _cacheEZs: function(extraResults) {\n    if (!CliqzSmartCliqzCache || !SmartCliqzTriggerUrlCache) {\n      return;\n    }\n\n    // slice creates a shallow copy, so we don't reverse existing array.\n    extraResults.slice().reverse().forEach(function(r) {\n      var trigger_urls = r.data.trigger_urls || [];\n      var wasCacheUpdated = false;\n\n      trigger_urls.forEach(function(url) {\n        if (!SmartCliqzTriggerUrlCache.isCached(url)) {\n          SmartCliqzTriggerUrlCache.store(url, true);\n          wasCacheUpdated = true;\n        }\n      });\n\n      if (wasCacheUpdated) {\n        SmartCliqzTriggerUrlCache.save();\n      }\n\n      CliqzSmartCliqzCache.store(r);\n    });\n  },\n\n  // Take the first entry (if history cluster) and see if we can trigger an EZ\n  // with it, this will override an EZ sent by backend.\n  _historyTriggerEZ: function(result) {\n    if (!result || !result.data ||\n       !result.data.cluster || // if not history cluster\n       result.data.autoAdd) { // if the base domain was auto added (guessed)\n      return undefined;\n    }\n\n    if (!CliqzSmartCliqzCache || !SmartCliqzTriggerUrlCache) {\n      return undefined;\n    }\n\n    var url = CliqzUtils.generalizeUrl(result.val, true),\n      ez;\n\n    if (SmartCliqzTriggerUrlCache.isCached(url)) {\n      var ezId = SmartCliqzTriggerUrlCache.retrieve(url);\n      // clear dirty data that got into the data base\n      if (ezId === 'deprecated') {\n        SmartCliqzTriggerUrlCache.delete(url);\n        return undefined;\n      }\n      ez = CliqzSmartCliqzCache.retrieve(url);\n      if (ez) {\n        // Cached EZ is available\n        ez = Result.clone(ez);\n\n        // copy over title and description from history entry\n        if (!result.data.generic) {\n          ez.data.title = result.data.title;\n          if (!ez.data.description)\n              ez.data.description = result.data.description;\n        }\n\n        resultKindEnricher({trigger_method: 'history_url'}, ez);\n      } else {\n        // Not available: start fetching now so it is available soon\n        CliqzSmartCliqzCache.fetchAndStore(url);\n      }\n\n      if (SmartCliqzTriggerUrlCache.isStale(url)) {\n        SmartCliqzTriggerUrlCache.delete(url);\n      }\n    }\n\n    return ez;\n  },\n\n  // Filter out any EZs that conflict with the firstresult\n  _filterConflictingEZ: function(cliqzExtra, firstresult) {\n    return cliqzExtra.filter(function(ez) {\n\n      // Did we make a 'bet' on a url from history that does not match this EZ?\n      if (firstresult.data && firstresult.data.cluster &&\n         !UrlCompare.sameUrls(ez.val, firstresult.val)) {\n        CliqzUtils.log('Not showing EZ ' + ez.val +\n                       ' because different than cluster ' + firstresult.val,\n                       'Mixer');\n        return false;\n      }\n\n      // Will the autocomplete change if we use this EZ?\n      if (firstresult.autocompleted &&\n         !UrlCompare.sameUrls(ez.val, firstresult.val)) {\n        CliqzUtils.log('Not showing EZ ' + ez.val +\n                       ' because autocomplete would change', 'Mixer');\n        return false;\n      }\n\n      return true;\n    });\n  },\n  // Mix together history, backend and custom results. Called twice per query:\n  // once with only history (instant), second with all data.\n  mix: function(q, cliqz, cliqzExtra, history, customResults,\n                only_history) {\n\n    if (!Mixer._isValidQueryForEZ(q)) {\n      cliqzExtra = [];\n    } else {\n      // Prepare incoming EZ results\n      cliqzExtra = Mixer._prepareExtraResults(cliqzExtra || []);\n\n      // Add EZ from first cliqz results to list of EZs, if valid\n      if (cliqz && cliqz.length > 0) {\n        Mixer._addEZfromBM(cliqzExtra, cliqz[0]);\n      }\n\n      // Cache any EZs found\n      Mixer._cacheEZs(cliqzExtra);\n    }\n\n    // Prepare other incoming data\n    cliqz = Mixer._prepareCliqzResults(cliqz || []);\n    history = Mixer._prepareHistoryResults(history || []);\n\n    CliqzUtils.log('only_history:' + only_history +\n                   ' history:' + history.length +\n                   ' cliqz:' + cliqz.length +\n                   ' extra:' + cliqzExtra.length, 'Mixer');\n\n    // Were any history results also available as a cliqz result?\n    //  if so, remove from backend list and combine sources in history result\n    var r = Mixer._deduplicateResults(history, cliqz);\n\n    // Prepare results: history (first) then backend results (second)\n    var results = r.first.concat(r.second);\n\n    // Trigger EZ with first entry\n    var historyEZ = Mixer._historyTriggerEZ(results[0]);\n    if (historyEZ) {\n      cliqzExtra = [historyEZ];\n    }\n\n    // Filter conflicting EZs\n    if (results.length > 0) {\n      cliqzExtra = Mixer._filterConflictingEZ(cliqzExtra, results[0]);\n    }\n\n\n    // Add custom results to the beginning if there are any\n    if (customResults && customResults.length > 0) {\n      cliqzExtra = customResults.concat(cliqzExtra);\n    }\n\n    // limit to one entity zone\n    cliqzExtra = cliqzExtra.slice(0, 1);\n\n    // remove any BM or simple history results covered by EZ\n    r = Mixer._deduplicateResults(cliqzExtra, results);\n    results = r.second;\n    var ez = r.first[0];\n\n    // Add EZ to result list result list\n    if (ez) {\n      CliqzUtils.log('EZ (' + ez.data.kind + ') for ' + ez.val, 'Mixer');\n\n      // Make a combined entry, if possible\n      if (results.length > 0 && results[0].data.cluster &&\n         Mixer.EZ_COMBINE.indexOf(ez.data.template) !== -1 &&\n         UrlCompare.sameUrls(results[0].val, ez.val)) {\n\n        CliqzUtils.log('Making combined entry.', 'Mixer');\n        results[0] = Result.combine(ez, result[0]);\n        Mixer._deduplicateHistory(results[0]);\n      } else {\n        // Add EZ to top of result list\n        results = [ez].concat(results);\n      }\n    }\n\n    // Special case: adjust second result if it doesn't fit\n    if (results.length > 1 && results[1].data.template == 'pattern-h2') {\n      CliqzUtils.log('Converting cluster for ' + results[1].val +\n                     ' to simple history', 'Mixer');\n\n      // convert to simple history entry\n      var simple = Result.generic('favicon', results[1].val, null,\n                                  results[1].data.title, null, searchString);\n      simple.data.kind = ['H'];\n      simple.data.description = result[1].data.description;\n      results[1] = simple;\n    }\n\n    // Only show a maximum 3 BM results\n    var cliqzRes = 0;\n    results = results.filter(function(r) {\n      if (r.style.indexOf('cliqz-results ') === 0) cliqzRes++;\n      return cliqzRes <= 3;\n    });\n\n    // Show no results message\n    if (results.length === 0 && !only_history) {\n      results.push(CliqzUtils.getNoResults());\n    }\n\n    return results;\n  },\n};\n\nMixer.init();\n; ctx[EXPORTED_SYMBOLS[0]] = Mixer;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module Mixer\n\n","// start module Result\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module acts as a result factory\n *\n */\n\nvar EXPORTED_SYMBOLS = ['Result'];\n\nComponents.utils.import('resource://gre/modules/XPCOMUtils.jsm');\n\nXPCOMUtils.defineLazyModuleGetter(this, 'CliqzUtils',\n  'chrome://cliqzmodules/content/CliqzUtils.jsm');\n\n\nfunction log(msg){\n    //CliqzUtils.log(msg, 'Result.jsm');\n}\n\n// returns the super type of a result - type to be consider for UI creation\nfunction getSuperType(result){\n    if(result.source == 'bm' && result.snippet && result.snippet.rich_data){\n        return CliqzUtils.getKnownType(result.snippet.rich_data.superType) || // superType used for custom templates\n               CliqzUtils.getKnownType(result.snippet.rich_data.type)      || // fallback result type\n               'bm';                                                           // backwards compatibility (most generic type, requires only url)\n    }\n    return null;\n}\n\nvar Result = {\n    CLIQZR: 'cliqz-results',\n    CLIQZC: 'cliqz-custom',\n    CLIQZE: 'cliqz-extra',\n    CLIQZCLUSTER: 'cliqz-cluster',\n    CLIQZSERIES: 'cliqz-series',\n    CLIQZICON: 'http://cliqz.com/favicon.ico',\n    RULES: {\n        'video': [\n            { 'domain': 'youtube.com', 'ogtypes': ['video', 'youtube'] },\n            { 'domain': 'vimeo.com', 'ogtypes': ['video'] },\n            { 'domain': 'myvideo.de', 'ogtypes': ['video.tv_show', 'video.episode', 'video.other'] },\n            { 'domain': 'dailymotion.com', 'ogtypes': ['video'] },\n            { 'vertical': 'video' }\n        ],\n        'poster': [\n            { 'domain': 'imdb.com', 'ogtypes': ['video.tv_show', 'tv_show', 'movie', 'video.movie', 'game', 'video.episode', 'actor', 'public_figure'] }\n        ],\n        'person': [\n            { 'domain': 'xing.com', 'ogtypes': [ 'profile'] },\n            { 'vertical': 'people' }\n        ],\n        'hq': [\n            { 'vertical': 'hq'}\n        ],\n        'news': [\n            { 'vertical': 'news'}\n        ],\n        'shopping': [\n            { 'vertical': 'shopping'}\n        ]\n    },\n\tgeneric: function(style, value, image, comment, label, query, data, subtype){\n        //try to show host name if no title (comment) is provided\n        if(style.indexOf(Result.CLIQZC) === -1       // is not a custom search\n           && (!comment || value == comment)   // no comment(page title) or comment is exactly the url\n           && CliqzUtils.isCompleteUrl(value)){       // looks like an url\n            var host = CliqzUtils.getDetailsFromUrl(value).name;\n            if(host && host.length>0){\n                comment = host[0].toUpperCase() + host.slice(1);\n            }\n        }\n        if(!comment){\n            comment = value;\n        }\n\n        data = data || {};\n        data.kind = [CliqzUtils.encodeResultType(style) + (subtype? '|' + subtype : '')];\n\n        var item = {\n            style: style,\n            val: value,\n            comment: comment,\n            label: label || value,\n            query: query,\n            data: data\n        };\n        return item;\n    },\n    cliqz: function(result){\n        var resStyle = Result.CLIQZR + ' sources-' + CliqzUtils.encodeSources(getSuperType(result) || result.source).join('');\n\n        if(result.snippet){\n            return Result.generic(\n                resStyle, //style\n                result.url, //value\n                null, //image -> favico\n                result.snippet.title,\n                null, //label\n                result.q, //query\n                Result.getData(result),\n                result.subType\n            );\n        } else {\n            return Result.generic(resStyle, result.url, null, null, null, result.q, null, result.subType);\n        }\n    },\n    cliqzExtra: function(result, snippet){\n        result.data.subType = result.subType;\n        result.data.trigger_urls = result.trigger_urls;\n        result.data.ts = result.ts;\n\n        return Result.generic(\n            Result.CLIQZE, //style\n            result.url, //value\n            null, //image -> favico\n            result.data.title,\n            null, //label\n            result.q, //query\n            result.data,\n            result.subType\n        );\n    },\n    // Combine two results into a new result\n    combine: function(first, second) {\n        var ret = Result.clone(first);\n        ret.style = CliqzUtils.combineSources(ret.style, second.style);\n        ret.data.kind = (ret.data.kind || []).concat(second.data.kind || []);\n\n        // copy over description, title and url list, if needed\n        if(second.data.description && !ret.data.description)\n            ret.data.description = second.data.description;\n        if(second.data.title && !ret.data.title) // title\n            ret.data.title = second.data.title;\n        if(second.data.urls && !ret.data.urls) // history url list\n            ret.data.urls = second.data.urls;\n\n        return ret;\n    },\n    // not really cloning the object !!!\n    clone: function(entry) {\n        var ret = Result.generic(entry.style, entry.val, null, entry.comment, entry.label, entry.query, null);\n        ret.data = JSON.parse(JSON.stringify(entry.data)); // nasty way of cloning an object\n        if(entry.autocompleted) ret.autocompleted = true;\n        return ret;\n    },\n    // check if a result should be kept in final result list\n    isValid: function (url, urlparts) {\n\n        // Google Filters\n        if(urlparts.name.toLowerCase() == \"google\" &&\n           urlparts.subdomains.length > 0 && urlparts.subdomains[0].toLowerCase() == \"www\" &&\n           (urlparts.extra.indexOf(\"/search\") != -1 || // \"/search?\" for regular SERPS and \".*/search/.*\" for maps\n            urlparts.extra.indexOf(\"/url?\") == 0 ||    // www.google.*/url? - for redirects\n            urlparts.extra.indexOf(\"q=\") != -1 )) {    // for instant search results\n            log(\"Discarding result page from history: \" + url)\n            return false;\n        }\n        // Bing Filters\n        // Filter all like:\n        //    www.bing.com/search?\n        if(urlparts.name.toLowerCase() == \"bing\" && urlparts.extra.indexOf(\"q=\") != -1) {\n            log(\"Discarding result page from history: \" + url)\n            return false;\n        }\n        // Yahoo filters\n        // Filter all like:\n        //   search.yahoo.com/search\n        //   *.search.yahooo.com/search - for international 'de.search.yahoo.com'\n        //   r.search.yahoo.com - for redirects 'r.search.yahoo.com'\n        if(urlparts.name.toLowerCase() == \"yahoo\" &&\n           ((urlparts.subdomains.length == 1 && urlparts.subdomains[0].toLowerCase() == \"search\" && urlparts.path.indexOf(\"/search\") == 0) ||\n            (urlparts.subdomains.length == 2 && urlparts.subdomains[1].toLowerCase() == \"search\" && urlparts.path.indexOf(\"/search\") == 0) ||\n            (urlparts.subdomains.length == 2 && urlparts.subdomains[0].toLowerCase() == \"r\" && urlparts.subdomains[1].toLowerCase() == \"search\"))) {\n            log(\"Discarding result page from history: \" + url)\n            return false;\n        }\n\n        // Ignore bitly redirections\n        if (url.search(/http(s?):\\/\\/bit\\.ly\\/.*/i) === 0) {\n            log(\"Discarding result page from history: \" + url)\n            return false;\n        }\n\n        // Ignore Twitter redirections\n        if (url.search(/http(s?):\\/\\/t\\.co\\/.*/i) === 0) {\n            log(\"Discarding result page from history: \" + url)\n            return false;\n        }\n\n        return true;\n    },\n    // rich data and image\n    getData: function(result){\n        //TODO: rethink the whole image filtering\n        if(!result.snippet)\n            return;\n\n        var urlparts = CliqzUtils.getDetailsFromUrl(result.url),\n            resp = {\n                richData: result.snippet.rich_data,\n                adult: result.snippet.adult || false,\n                media: result.snippet.media\n            },\n            source = getSuperType(result) || result.source;\n\n        resp.type = \"other\";\n        for(var type in Result.RULES){\n            var rules = Result.RULES[type];\n\n            for(var rule_i in rules) {\n                var rule = rules[rule_i];\n                if(rule.domain && urlparts.host.indexOf(rule.domain) != -1)\n                    for(var ogtype in (rule.ogtypes || []))\n                        if(result.snippet && result.snippet.og &&\n                           result.snippet.og.type == rule.ogtypes[ogtype])\n                                resp.type = type;\n\n                var verticals = source.split(',');\n                for(var v in verticals){\n                    if(verticals[v].trim() == rule.vertical)\n                        resp.type = type;\n                }\n            }\n\n\n        var snip = result.snippet;\n        resp.description = snip && (snip.desc || snip.snippet || (snip.og && snip.og.description));\n        resp.title = result.snippet.title;\n        // mobile specific url\n        resp.mobile_url = snip.amp_url || snip.m_url;\n\n        var ogT = snip && snip.og? snip.og.type: null,\n            imgT = snip && snip.image? snip.image.type: null;\n\n        if(resp.type != 'other' || ogT == 'cliqz' || imgT == 'cliqz')\n            resp.image = Result.getVerticalImage(result.snippet.image, result.snippet.rich_data) ||\n                         Result.getOgImage(result.snippet.og)\n        }\n\n        return resp;\n    },\n    getOgImage: function(og) {\n        if(og && og.image){\n            var image = { src: og.image };\n\n            if(og.duration && parseInt(og.duration)){\n                var parsedDuration = Result.tryGetImageDuration(og.duration)\n                if(parsedDuration) image.duration = parsedDuration;\n            }\n\n            return image;\n        }\n    },\n    getVerticalImage: function(imageData, richData){\n        if(imageData == undefined || imageData.src == undefined) return;\n\n        var image = {\n            src: imageData.src\n        };\n\n\n        if(imageData.width) image.width = imageData.width;\n        if(imageData.height) image.height = imageData.height;\n        if(imageData.ratio) image.ratio = imageData.ratio;\n\n        // add duration from rich data\n        if(richData && richData.duration){\n            var parsedDuration = Result.tryGetImageDuration(richData.duration)\n            if(parsedDuration) image.duration = parsedDuration;\n        }\n\n        return image\n    },\n    tryGetImageDuration: function(duration){\n        try {\n            var totalSeconds = parseInt(duration),\n                min = Math.floor(totalSeconds/60),\n                seconds = totalSeconds%60;\n            return min + ':' + (seconds < 10 ? '0' + seconds : seconds);\n        }\n        catch(e){}\n\n        return undefined;\n    }\n}\n; ctx[EXPORTED_SYMBOLS[0]] = Result;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module Result\n\n","// start module UrlCompare\n(function(ctx,Q,E){\n'use strict';\n/*\n * This module handles results(url) comparison\n *\n */\n\nvar EXPORTED_SYMBOLS = ['UrlCompare'];\n\n// TLD list extracted from http://www.iana.org/domains/root/db,\n// cc stands fro country code, the other are generic\nvar TLDs = {gw: 'cc', gu: 'cc', gt: 'cc', gs: 'cc', gr: 'cc', gq: 'cc', gp: 'cc', dance: 'na', tienda: 'na', gy: 'cc', gg: 'cc', gf: 'cc', ge: 'cc', gd: 'cc', gb: 'cc', ga: 'cc', edu: 'na', gn: 'cc', gm: 'cc', gl: 'cc', '\\u516c\\u53f8': 'na', gi: 'cc', gh: 'cc', tz: 'cc', zone: 'na', tv: 'cc', tw: 'cc', tt: 'cc', immobilien: 'na', tr: 'cc', tp: 'cc', tn: 'cc', to: 'cc', tl: 'cc', bike: 'na', tj: 'cc', tk: 'cc', th: 'cc', tf: 'cc', tg: 'cc', td: 'cc', tc: 'cc', coop: 'na', '\\u043e\\u043d\\u043b\\u0430\\u0439\\u043d': 'na', cool: 'na', ro: 'cc', vu: 'cc', democrat: 'na', guitars: 'na', qpon: 'na', '\\u0441\\u0440\\u0431': 'cc', zm: 'cc', tel: 'na', futbol: 'na', za: 'cc', '\\u0628\\u0627\\u0632\\u0627\\u0631': 'na', '\\u0440\\u0444': 'cc', zw: 'cc', blue: 'na', mu: 'cc', '\\u0e44\\u0e17\\u0e22': 'cc', asia: 'na', marketing: 'na', '\\u6d4b\\u8bd5': 'na', international: 'na', net: 'na', '\\u65b0\\u52a0\\u5761': 'cc', okinawa: 'na', '\\u0baa\\u0bb0\\u0bbf\\u0b9f\\u0bcd\\u0b9a\\u0bc8': 'na', '\\u05d8\\u05e2\\u05e1\\u05d8': 'na', '\\uc0bc\\uc131': 'na', sexy: 'na', institute: 'na', '\\u53f0\\u7063': 'cc', pics: 'na', '\\u516c\\u76ca': 'na', '\\u673a\\u6784': 'na', social: 'na', domains: 'na', '\\u9999\\u6e2f': 'cc', '\\u96c6\\u56e2': 'na', limo: 'na', '\\u043c\\u043e\\u043d': 'cc', tools: 'na', nagoya: 'na', properties: 'na', camera: 'na', today: 'na', club: 'na', company: 'na', glass: 'na', berlin: 'na', me: 'cc', md: 'cc', mg: 'cc', mf: 'cc', ma: 'cc', mc: 'cc', tokyo: 'na', mm: 'cc', ml: 'cc', mo: 'cc', mn: 'cc', mh: 'cc', mk: 'cc', cat: 'na', reviews: 'na', mt: 'cc', mw: 'cc', mv: 'cc', mq: 'cc', mp: 'cc', ms: 'cc', mr: 'cc', cab: 'na', my: 'cc', mx: 'cc', mz: 'cc', '\\u0b87\\u0bb2\\u0b99\\u0bcd\\u0b95\\u0bc8': 'cc', wang: 'na', estate: 'na', clothing: 'na', monash: 'na', guru: 'na', technology: 'na', travel: 'na', '\\u30c6\\u30b9\\u30c8': 'na', pink: 'na', fr: 'cc', '\\ud14c\\uc2a4\\ud2b8': 'na', farm: 'na', lighting: 'na', fi: 'cc', fj: 'cc', fk: 'cc', fm: 'cc', fo: 'cc', sz: 'cc', kaufen: 'na', sx: 'cc', ss: 'cc', sr: 'cc', sv: 'cc', su: 'cc', st: 'cc', sk: 'cc', sj: 'cc', si: 'cc', sh: 'cc', so: 'cc', sn: 'cc', sm: 'cc', sl: 'cc', sc: 'cc', sb: 'cc', rentals: 'na', sg: 'cc', se: 'cc', sd: 'cc', '\\u7ec4\\u7ec7\\u673a\\u6784': 'na', shoes: 'na', '\\u4e2d\\u570b': 'cc', industries: 'na', lb: 'cc', lc: 'cc', la: 'cc', lk: 'cc', li: 'cc', lv: 'cc', lt: 'cc', lu: 'cc', lr: 'cc', ls: 'cc', holiday: 'na', ly: 'cc', coffee: 'na', ceo: 'na', '\\u5728\\u7ebf': 'na', ye: 'cc', '\\u0625\\u062e\\u062a\\u0628\\u0627\\u0631': 'na', ninja: 'na', yt: 'cc', name: 'na', moda: 'na', eh: 'cc', '\\u0628\\u06be\\u0627\\u0631\\u062a': 'cc', ee: 'cc', house: 'na', eg: 'cc', ec: 'cc', vote: 'na', eu: 'cc', et: 'cc', es: 'cc', er: 'cc', ru: 'cc', rw: 'cc', '\\u0aad\\u0abe\\u0ab0\\u0aa4': 'cc', rs: 'cc', boutique: 'na', re: 'cc', '\\u0633\\u0648\\u0631\\u064a\\u0629': 'cc', gov: 'na', '\\u043e\\u0440\\u0433': 'na', red: 'na', foundation: 'na', pub: 'na', vacations: 'na', org: 'na', training: 'na', recipes: 'na', '\\u0438\\u0441\\u043f\\u044b\\u0442\\u0430\\u043d\\u0438\\u0435': 'na', '\\u4e2d\\u6587\\u7f51': 'na', support: 'na', onl: 'na', '\\u4e2d\\u4fe1': 'na', voto: 'na', florist: 'na', '\\u0dbd\\u0d82\\u0d9a\\u0dcf': 'cc', '\\u049b\\u0430\\u0437': 'cc', management: 'na', '\\u0645\\u0635\\u0631': 'cc', '\\u0622\\u0632\\u0645\\u0627\\u06cc\\u0634\\u06cc': 'na', kiwi: 'na', academy: 'na', sy: 'cc', cards: 'na', '\\u0938\\u0902\\u0917\\u0920\\u0928': 'na', pro: 'na', kred: 'na', sa: 'cc', mil: 'na', '\\u6211\\u7231\\u4f60': 'na', agency: 'na', '\\u307f\\u3093\\u306a': 'na', equipment: 'na', mango: 'na', luxury: 'na', villas: 'na', '\\u653f\\u52a1': 'na', singles: 'na', systems: 'na', plumbing: 'na', '\\u03b4\\u03bf\\u03ba\\u03b9\\u03bc\\u03ae': 'na', '\\u062a\\u0648\\u0646\\u0633': 'cc', '\\u067e\\u0627\\u06a9\\u0633\\u062a\\u0627\\u0646': 'cc', gallery: 'na', kg: 'cc', ke: 'cc', '\\u09ac\\u09be\\u0982\\u09b2\\u09be': 'cc', ki: 'cc', kh: 'cc', kn: 'cc', km: 'cc', kr: 'cc', kp: 'cc', kw: 'cc', link: 'na', ky: 'cc', voting: 'na', cruises: 'na', '\\u0639\\u0645\\u0627\\u0646': 'cc', cheap: 'na', solutions: 'na', '\\u6e2c\\u8a66': 'na', neustar: 'na', partners: 'na', '\\u0b87\\u0ba8\\u0bcd\\u0ba4\\u0bbf\\u0baf\\u0bbe': 'cc', menu: 'na', arpa: 'na', flights: 'na', rich: 'na', do: 'cc', dm: 'cc', dj: 'cc', dk: 'cc', photography: 'na', de: 'cc', watch: 'na', dz: 'cc', supplies: 'na', report: 'na', tips: 'na', '\\u10d2\\u10d4': 'cc', bar: 'na', qa: 'cc', shiksha: 'na', '\\u0443\\u043a\\u0440': 'cc', vision: 'na', wiki: 'na', '\\u0642\\u0637\\u0631': 'cc', '\\ud55c\\uad6d': 'cc', computer: 'na', best: 'na', voyage: 'na', expert: 'na', diamonds: 'na', email: 'na', wf: 'cc', jobs: 'na', bargains: 'na', '\\u79fb\\u52a8': 'na', jp: 'cc', jm: 'cc', jo: 'cc', ws: 'cc', je: 'cc', kitchen: 'na', '\\u0a2d\\u0a3e\\u0a30\\u0a24': 'cc', '\\u0627\\u06cc\\u0631\\u0627\\u0646': 'cc', ua: 'cc', buzz: 'na', com: 'na', uno: 'na', ck: 'cc', ci: 'cc', ch: 'cc', co: 'cc', cn: 'cc', cm: 'cc', cl: 'cc', cc: 'cc', ca: 'cc', cg: 'cc', cf: 'cc', community: 'na', cd: 'cc', cz: 'cc', cy: 'cc', cx: 'cc', cr: 'cc', cw: 'cc', cv: 'cc', cu: 'cc', pr: 'cc', ps: 'cc', pw: 'cc', pt: 'cc', holdings: 'na', wien: 'na', py: 'cc', ai: 'cc', pa: 'cc', pf: 'cc', pg: 'cc', pe: 'cc', pk: 'cc', ph: 'cc', pn: 'cc', pl: 'cc', pm: 'cc', '\\u53f0\\u6e7e': 'cc', aero: 'na', catering: 'na', photos: 'na', '\\u092a\\u0930\\u0940\\u0915\\u094d\\u0937\\u093e': 'na', graphics: 'na', '\\u0641\\u0644\\u0633\\u0637\\u064a\\u0646': 'cc', '\\u09ad\\u09be\\u09b0\\u09a4': 'cc', ventures: 'na', va: 'cc', vc: 'cc', ve: 'cc', vg: 'cc', iq: 'cc', vi: 'cc', is: 'cc', ir: 'cc', it: 'cc', vn: 'cc', im: 'cc', il: 'cc', io: 'cc', in: 'cc', ie: 'cc', id: 'cc', tattoo: 'na', education: 'na', parts: 'na', events: 'na', '\\u0c2d\\u0c3e\\u0c30\\u0c24\\u0c4d': 'cc', cleaning: 'na', kim: 'na', contractors: 'na', mobi: 'na', center: 'na', photo: 'na', nf: 'cc', '\\u0645\\u0644\\u064a\\u0633\\u064a\\u0627': 'cc', wed: 'na', supply: 'na', '\\u7f51\\u7edc': 'na', '\\u0441\\u0430\\u0439\\u0442': 'na', careers: 'na', build: 'na', '\\u0627\\u0644\\u0627\\u0631\\u062f\\u0646': 'cc', bid: 'na', biz: 'na', '\\u0627\\u0644\\u0633\\u0639\\u0648\\u062f\\u064a\\u0629': 'cc', gift: 'na', '\\u0434\\u0435\\u0442\\u0438': 'na', works: 'na', '\\u6e38\\u620f': 'na', tm: 'cc', exposed: 'na', productions: 'na', koeln: 'na', dating: 'na', christmas: 'na', bd: 'cc', be: 'cc', bf: 'cc', bg: 'cc', ba: 'cc', bb: 'cc', bl: 'cc', bm: 'cc', bn: 'cc', bo: 'cc', bh: 'cc', bi: 'cc', bj: 'cc', bt: 'cc', bv: 'cc', bw: 'cc', bq: 'cc', br: 'cc', bs: 'cc', post: 'na', by: 'cc', bz: 'cc', om: 'cc', ruhr: 'na', '\\u0627\\u0645\\u0627\\u0631\\u0627\\u062a': 'cc', repair: 'na', xyz: 'na', '\\u0634\\u0628\\u0643\\u0629': 'na', viajes: 'na', museum: 'na', fish: 'na', '\\u0627\\u0644\\u062c\\u0632\\u0627\\u0626\\u0631': 'cc', hr: 'cc', ht: 'cc', hu: 'cc', hk: 'cc', construction: 'na', hn: 'cc', solar: 'na', hm: 'cc', info: 'na', '\\u0b9a\\u0bbf\\u0b99\\u0bcd\\u0b95\\u0baa\\u0bcd\\u0baa\\u0bc2\\u0bb0\\u0bcd': 'cc', uy: 'cc', uz: 'cc', us: 'cc', um: 'cc', uk: 'cc', ug: 'cc', builders: 'na', ac: 'cc', camp: 'na', ae: 'cc', ad: 'cc', ag: 'cc', af: 'cc', int: 'na', am: 'cc', al: 'cc', ao: 'cc', an: 'cc', aq: 'cc', as: 'cc', ar: 'cc', au: 'cc', at: 'cc', aw: 'cc', ax: 'cc', az: 'cc', ni: 'cc', codes: 'na', nl: 'cc', no: 'cc', na: 'cc', nc: 'cc', ne: 'cc', actor: 'na', ng: 'cc', '\\u092d\\u093e\\u0930\\u0924': 'cc', nz: 'cc', '\\u0633\\u0648\\u062f\\u0627\\u0646': 'cc', np: 'cc', nr: 'cc', nu: 'cc', xxx: 'na', '\\u4e16\\u754c': 'na', kz: 'cc', enterprises: 'na', land: 'na', '\\u0627\\u0644\\u0645\\u063a\\u0631\\u0628': 'cc', '\\u4e2d\\u56fd': 'cc', directory: 'na'};\n\nvar UrlCompare = {\n\n  // Compare two URLs and return true if same or differing only by\n  // country code in subdomain or path.\n  sameUrls: function(url1, url2) {\n      // Get generalized representation of each url\n      var keys1 = UrlCompare._extractKeys(url1, '');\n      var keys2 = UrlCompare._extractKeys(url2, '');\n\n      // Compare the second one, which takes path into account\n      return keys1[1] == keys2[1];\n    },\n\n  _filterTLDs: function(domain) {\n    var v = domain.toLowerCase().split('.');\n\n    // remove the first level yes or yes\n    var first_level = TLDs[v[v.length - 1]];\n    v[v.length - 1] = null;\n\n    if ((v.length > 2) && (first_level == 'cc')) {\n      // check if we also have to remove the second level, only if 3 or more\n      //  levels and the first_level was a country code\n      if (TLDs[v[v.length - 2]]) {\n        v[v.length - 2] = null;\n      }\n    }\n\n    // remove the nulls\n    v = v.filter(function(n) { return n !== null; });\n\n    // let's go to remove locales from the beginning, only if at least 2 or\n    // more levels remaining and if the first_level was not a country code\n    if ((v.length > 1) && (first_level != 'cc')) {\n\n      // cover the case de.wikipedia.org\n      if (TLDs[v[0]] == 'cc' || v[0] == 'en') {\n        v[0] = null;\n      }      else {\n        // cover the case de-de.facebook.com\n        var w = v[0].split('-');\n        if ((w.length == 2) && (TLDs[w[0]] == 'cc' || w[0] == 'en') &&\n            (TLDs[w[1]] == 'cc' || w[1] == 'en')) {\n          v[0] = null;\n        }\n      }\n    }\n\n    // remove the nulls and join\n    return v.filter(function(n) { return n !== null; }).join('.');\n  },\n\n  _filterTLDsInPath: function(path) {\n\n    var v = path.toLowerCase().split('/');\n\n    // it should have at least 2, \"/\".split('/') => ['', '']\n\n    // we only consider the top level element in the path\n    if (v.length > 1) {\n      if (TLDs[v[1]] == 'cc') {\n        v[1] = null;\n      }      else {\n        var w = v[1].split('-');\n        if ((w.length == 2) && (TLDs[w[0]] == 'cc' || w[0] == 'en') && (TLDs[w[1]] == 'cc' || w[1] == 'en')) {\n          v[1] = null;\n        }\n      }\n    }\n\n    // remove the nulls and join\n\n    var clean_v = v.filter(function(n) { return n !== null; });\n\n    var new_path = '/';\n\n    if (clean_v.length > 1) {\n      new_path = v.filter(function(n) { return n !== null; }).join('/');\n    }    else {\n      // special case when clean_v has only one element, it will not join the\n      // initial slash\n      new_path = '/' + v.filter(function(n) { return n !== null; }).join('/');\n    }\n\n    new_path = new_path.replace('//', '/');\n\n    return new_path;\n\n  },\n\n  _extractKeys: function(url, title) {\n    var clean_url =\n      url.toLowerCase().replace(/^http[s]*:\\/\\//, '').replace(/^www\\./, '');\n    var v = clean_url.split('/');\n    var domain = v[0];\n    var path = '/';\n\n    if (v.length > 1) {\n      // remove the query string\n      v[v.length - 1] = v[v.length - 1].split('?')[0];\n\n      if (v[1] == '#') {\n        // the path starts with # which is used for internal routing,\n        // remove for keys\n        // http://klout.com/#/solso == http://klout.com/solso\n        if (v.length > 2) path = '/' + v.splice(2, v.length - 1).join('/');\n      }      else path = '/' + v.splice(1, v.length - 1).join('/');\n    }\n\n    domain = UrlCompare._filterTLDs(domain);\n    path = UrlCompare._filterTLDsInPath(path);\n\n    // if no title or empty, generate a random key.\n    // This is a fail-safe mechanism\n    if ((title === undefined) || (title === null) || (title.trim() === '')) {\n      title = '' + Math.random();\n    }\n\n    // remove debug info from title on the de-duplication, so that we have\n    // consistent behaviour.\n    // the debug info is anything that has ( foo bar )! end of line\n    title = title.replace(/\\(.*\\)!$/, '').trim();\n\n    return [domain, domain + path, domain + title];\n  },\n};\n\n; ctx[EXPORTED_SYMBOLS[0]] = UrlCompare;\n})(this, CLIQZ,CLIQZEnvironment);\n// end module UrlCompare\n\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACngCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;","file":"global.js"}