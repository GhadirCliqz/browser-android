System.register("autocomplete/calculator", ["core/cliqz", "autocomplete/result", "core/platform"], function (_export) {
  /*
   * This module handles various calculations
   *
   */

  "use strict";

  var utils, Result, isFirefox, mathLib, _global, BROWSER_LANG, CliqzCalculator;

  function getEqualOperator(val, localizedStr) {
    var valStr = val.toString().replace(",", "").replace(".", ""),
        normLocalizedStr = localizedStr.replace(",", "").replace(".", "");
    return valStr === normLocalizedStr ? "=" : "≈";
  }

  return {
    setters: [function (_coreCliqz) {
      utils = _coreCliqz.utils;
    }, function (_autocompleteResult) {
      Result = _autocompleteResult["default"];
    }, function (_corePlatform) {
      isFirefox = _corePlatform.isFirefox;
    }],
    execute: function () {
      mathLib = undefined;

      if (isFirefox) {
        _global = {};

        Services.scriptloader.loadSubScript('chrome://cliqz/content/bower_components/mathjs/dist/math.min.js', _global);
        mathLib = _global.math;
      } else {
        mathLib = window.math;
      }

      // REF:
      //      http://mathjs.org/docs/index.html
      //      http://stackoverflow.com/questions/26603795/variable-name-and-restrict-operators-in-math-js
      //      http://jsbin.com/duduru/1/edit?html,output

      BROWSER_LANG = utils.getLocalizedString('locale_lang_code');
      CliqzCalculator = {
        CALCULATOR_RES: 0,
        UNIT_RES: '',
        IS_UNIT_CONVERTER: false,
        BASE_UNIT_CONVERTER: '',
        FLOAT_DEC: [100000, 100, 1],
        FLOAT_DEC_THRESHOLD: [99, 99999],
        ACCEPT_ERROR: 1e-8,
        UNIT_CONVERSION_DATA: { // http://en.wikipedia.org/wiki/Conversion_of_units
          // http://www.convert-me.com/en/convert/length/
          'LOCALIZE_KEYS': { 'de-DE': 'names_de', 'en-US': 'names_en', 'default': 'names_de' },
          'types': ['length', 'mass'],
          'length': {
            'base': 'm',
            'units': [{ 'val': 4828, 'names': ['lea', 'leuge', 'league', 'leagues'] }, { 'val': 0.3048006096012192, // this is US foot, there're IDIAN, CLA, BEN,...
              'names': ['ft', 'foot', 'feet', "fuß"],
              'names_en': { 's': 'foot', 'p': 'feet' },
              'names_de': { 's': "fuß", 'p': "fuß" } }, { 'val': 0.0254, 'names': ['in', 'inch', 'inches', 'zoll'] }, { 'val': 1000, 'names': ['km', 'kilometer', 'kilometre', 'kilometres', 'kilometers'] }, { 'val': 1, 'names': ['m', 'meter', 'metre', 'metres', 'meters'] }, { 'val': 0.1, 'names': ['dm', 'decimeter', 'decimetre', 'decimeters', 'decimetres', 'dezimeter'] }, { 'val': 0.01, 'names': ['cm', 'centimeter', 'centimetre', 'centimetres', 'centimeters', 'zentimeter'] }, { 'val': 0.001, 'names': ['mm', 'millimeter', 'millimetre', 'millimetres', 'millimeters'] }, { 'val': 1e-6, 'names': ['micron', 'micrometer', 'micrometre', 'micrometres', 'micrometers', 'mikrometer'] }, { 'val': 1e-9, 'names': ['nm', 'nanometre', 'nanometre', 'nanometer', 'nanometers'] }, { 'val': 10000, 'names': ['mil'] }, // this is Sweden and Norway unit
            { 'val': 1609.344,
              'names': ['mil.', 'mi.', 'mile', 'miles', 'meile', 'meilen'],
              'names_en': { 's': 'mile', 'p': 'miles' },
              'names_de': { 's': 'meile', 'p': 'meilen' } }, { 'val': 201.168, 'names': ['furlong', 'furlongs'] }, { 'val': 0.9144, 'names': ['yd', 'yard', 'yards'] }, { 'val': 2.54 * 1e-5, 'names': ['thou'] }, { 'val': 1.8288, 'names': ['fm', 'fathom', 'fathoms', 'faden', "fäden"] }, { 'val': 5.0292, 'names': ['rd', 'rod', 'rods', 'rute', 'ruten'] }, { 'val': 0.1016, 'names': ['hand', 'hands', 'handbreit'] }, { 'val': 0.2286, 'names': ['span', 'spans', 'spanne', 'spannen'] }, { 'val': 5556, 'names': ['naut.leag', 'nautical league', 'naut.leags', 'nautical league'] }, { 'val': 1852, 'names': ['naut.mil', 'naut.mils', 'nautical mile', 'nautical miles', 'naut.meile', 'naut.meilen', 'nautische meile', 'nautische meilen'] }, { 'val': 1852.216, 'names': ['sm', 'Seemeile'] }, { 'val': 185.2, 'names': ['cbl', 'cable length', "cable'slength", 'Kabel', 'Kabellänge'] }]
          },
          'mass': {
            "base": 'g',
            'units': [{ 'val': 102, 'names': ['kN', 'kn', 'kilonewton', 'kilonewtons'] }, { 'val': 1e9, 'names': ['kt', 'kilotonne', 'kilotonnes', 'kilotonnen'] }, { 'val': 1e6, 'names': ['t', 'tonne', 'tonnes', 'tonnen', 'metric ton', 'metric tons'] }, { 'val': 1e6, 'names': ['Mg', 'megagram', 'megagrams'] }, { 'val': 1000, 'names': ['kg', 'kilogram', 'kilograms', 'kilogramme', 'kilogrammes', 'kilogramm', 'kilogramms'] }, { 'val': 100, 'names': ['hg', 'hectogram', 'hectograms', 'hectogramme', 'hectogrammes', 'hectogramm', 'hectogramms'] }, { 'val': 10, 'names': ['dag', 'decagram', 'decagrams', 'decagramme', 'decagrammes', 'decagramm', 'decagramms'] }, { 'val': 1, 'names': ['g', 'gram', 'grams', 'gramme', 'grammes', 'gramm', 'gramms'] }, { 'val': 0.1, 'names': ['dg', 'decigram', 'decigrams', 'decigramme', 'decigrammes', 'decigramm', 'decigramms'] }, { 'val': 0.01, 'names': ['cg', 'centigram', 'centigrams', 'centigramme', 'centigrammes', 'centigramm', 'centigramms'] }, { 'val': 0.001, 'names': ['mg', 'milligram', 'milligrams', 'milligramme', 'milligrammes', 'milligramm', 'milligramms'] }, { 'val': 0.000001, 'names': ['mcg', 'microgram', 'micrograms', 'microgramme', 'microgrammes', 'microgramm', 'microgramms'] }, { 'val': 453.59237, 'names': ['lb', 'lbs', 'pound', 'pounds', 'pound-mass', 'pfund'] }, { 'val': 28.349523125, 'names': ['oz', 'ozs', 'ounce ', 'ounces', 'unze', 'unzen'] }, { 'val': 1.7718452, 'names': ['dr', 'dram', 'drams'] }, { 'val': 0.06479891, 'names': ['gr', 'grain', 'grains', 'Gran'] }]
          }
        },
        shortenNumber: function shortenNumber() {
          // shorten numbers when needed
          try {
            var numRaw,
                num,
                num1,
                floatDec = 1,
                resultSign = "";

            num1 = this.CALCULATOR_RES;

            for (var i = 0; i < this.FLOAT_DEC_THRESHOLD.length; i++) {
              if (Math.abs(num1) < this.FLOAT_DEC_THRESHOLD[i]) {
                floatDec = this.FLOAT_DEC[i];
                break;
              }
            }
            numRaw = Math.round(num1 * floatDec) / floatDec;
            num = numRaw.toLocaleString(utils.getLocalizedString('locale_lang_code'));
            resultSign = getEqualOperator(num1, num);

            this.CALCULATOR_RES = this.IS_UNIT_CONVERTER ? [num, this.UNIT_RES].join(" ") : num.toString();
            return [resultSign, this.CALCULATOR_RES];
          } catch (err) {}
          return null;
        },
        clean: function clean(q) {
          if (!isNaN(q)) {
            return ''; // Don't trigger calculator yet if the query is just a number
          }
          var operators = ['+', '-', '*', '/', '^', '='];
          q = q.replace(/(\d),(\d)/g, '$1.$2'); // commas are separators to german ppl
          q = q.replace(/ /g, ''); // Remove all spaces
          for (var i = 0; i < operators.length; i++) {
            if (q[q.length - 1] == operators[i]) {
              return q.substr(0, q.length - 1); // Remove the last operator
            }
          }
          return q;
        },
        calculate: function calculate(q) {
          if (this.CALCULATOR_RES === null || this.CALCULATOR_RES === q) {
            return null;
          }
          var expandedExpression = this.IS_UNIT_CONVERTER ? this.BASE_UNIT_CONVERTER : mathLib.parse(this.clean(q)).toString(),
              resultSign = this.shortenNumber()[0];

          return Result.cliqzExtra({
            url: "",
            q: q,
            style: "cliqz-extra",
            type: "cliqz-extra",
            subType: JSON.stringify({ type: 'calculator' }),
            data: {
              template: 'calculator',
              expression: expandedExpression,
              answer: this.CALCULATOR_RES,
              is_calculus: true,
              // TODO: support_copy_ans should be platform specific
              support_copy_ans: true
            }
          });
        },

        find_unit_in_data: function find_unit_in_data(unit_) {
          var self = this,
              unit = unit_.toLowerCase(),
              unitFound = null;

          self.UNIT_CONVERSION_DATA.types.some(function (type) {
            return self.UNIT_CONVERSION_DATA[type].units.some(function (item) {
              if (item['names'].indexOf(unit) > -1 || item['names'].indexOf(unit_) > -1) {
                unitFound = [type, true, item];
                return true;
              }
              return false;
            });
          });
          return unitFound || ["", false, null];
        },

        selectUnitTerms: function selectUnitTerms(unit_data, val) {
          /*
           *   + based on the value and the language preference, select unit name in suitable language and form (singular/plural)
           */
          var noun_type = val === 1 ? 's' : 'p',
              nameInfo = unit_data[CliqzCalculator.UNIT_CONVERSION_DATA.LOCALIZE_KEYS[BROWSER_LANG]] || unit_data[CliqzCalculator.UNIT_CONVERSION_DATA.LOCALIZE_KEYS['default']] || unit_data['names'],
              name = nameInfo[noun_type];

          return name || unit_data['names']['0'] || "";
        },

        isConverterSearch: function isConverterSearch(q) {
          // --- Process query to recognize a unit-conversion query
          // ACCEPTED query types:
          //    1. a to b, e.g. cm to mm
          var tmp = q.trim(),
              paramList,
              unit1,
              unit2,
              idx,
              num,
              unit1Info;
          // Note: don't use regex match in replace function, e.g. tmp.replace(/ zu | in | im /g, ' to ')
          tmp = q.replace(' zu ', ' to ');
          tmp = tmp.replace(' im ', ' to ');
          tmp = tmp.replace(' in ', ' to ');
          tmp = tmp.replace(' into ', ' to '); // this needs to be at the end
          paramList = tmp.trim().split(' to ');

          if (paramList.length !== 2) return false;
          unit2 = this.find_unit_in_data(paramList[1].trim());
          if (unit2[1]) {
            unit1 = paramList[0].replace(' ', '') + ' ';
            idx = 0;
            while (unit1[idx] === ',' || unit1[idx] === '.' || unit1[idx] >= '0' && unit1[idx] <= '9') idx++;
            if (idx === 0) {
              num = 1;
            } else {
              num = Number(unit1.slice(0, idx));
              if (isNaN(num)) {
                return false;
              }
            }

            unit1 = unit1.slice(idx, unit1.length).trim();
            unit1Info = this.find_unit_in_data(unit1);
            if (!unit1Info[1] || unit1Info[0] !== unit2[0]) {
              return false;
            } // if not unit of the same type, e.g. 1km to g should not return result

            this.IS_UNIT_CONVERTER = true;
            var cvRaw = unit1Info[2].val / unit2[2].val,
                cv = cvRaw.toLocaleString(utils.getLocalizedString('locale_lang_code'));
            this.CALCULATOR_RES = num * cvRaw;
            this.UNIT_RES = CliqzCalculator.selectUnitTerms(unit2[2], this.CALCULATOR_RES);
            this.BASE_UNIT_CONVERTER = ['1', CliqzCalculator.selectUnitTerms(unit1Info[2], 1), getEqualOperator(cvRaw, cv), cv, CliqzCalculator.selectUnitTerms(unit2[2], this.CALCULATOR_RES, cvRaw)].join(" ");

            return true;
          } else {
            return false;
          }
        },

        isCalculatorSearch: function isCalculatorSearch(q) {
          // filter out:
          // + too short query (avoid answering e, pi)
          // + automatically convert queries like '10cm
          var tmp = this.clean(q);
          if (tmp.length <= 2 || tmp.length > 150) {
            return false;
          }

          try {
            this.CALCULATOR_RES = mathLib.eval(tmp);

            if (typeof this.CALCULATOR_RES === 'number') {
              this.IS_UNIT_CONVERTER = false;
              return true;
            }
          } catch (err) {}

          return this.isConverterSearch(q);
        }
      };

      _export("default", CliqzCalculator);
    }
  };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG9jb21wbGV0ZS9jYWxjdWxhdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQVNJLE9BQU8sRUFHSCxPQUFNLEVBWVYsWUFBWSxFQVFaLGVBQWU7O0FBTm5CLFdBQVMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLFlBQVksRUFBQztBQUMxQyxRQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFDLEVBQUUsQ0FBQztRQUN6RCxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2xFLFdBQU8sTUFBTSxLQUFLLGdCQUFnQixHQUFHLEdBQUcsR0FBRyxHQUFRLENBQUM7R0FDckQ7Ozs7eUJBekJRLEtBQUs7Ozs7Z0NBRUwsU0FBUzs7O0FBRWQsYUFBTzs7QUFFWCxVQUFJLFNBQVMsRUFBRTtBQUNQLGVBQU0sR0FBRyxFQUFFOztBQUNqQixnQkFBUSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsaUVBQWlFLEVBQUUsT0FBTSxDQUFDLENBQUM7QUFDL0csZUFBTyxHQUFHLE9BQU0sQ0FBQyxJQUFJLENBQUM7T0FDdkIsTUFBTTtBQUNMLGVBQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO09BQ3ZCOzs7Ozs7O0FBT0csa0JBQVksR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUMsa0JBQWtCLENBQUM7QUFRM0QscUJBQWUsR0FBRztBQUNwQixzQkFBYyxFQUFFLENBQUM7QUFDakIsZ0JBQVEsRUFBRSxFQUFFO0FBQ1oseUJBQWlCLEVBQUUsS0FBSztBQUN4QiwyQkFBbUIsRUFBRSxFQUFFO0FBQ3ZCLGlCQUFTLEVBQUUsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUMzQiwyQkFBbUIs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QUMsY0FBYyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7O0FBRXhDLGdCQUFJLE9BQU8sSUFBSSxDQUFDLGNBQWMsQUFBQyxLQUFLLFFBQVEsRUFBRTtBQUM1QyxrQkFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztBQUMvQixxQkFBTyxJQUFJLENBQUE7YUFDWjtXQUNGLENBQ0QsT0FBTyxHQUFHLEVBQUUsRUFDWDs7QUFFRCxpQkFBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbEM7T0FDRjs7eUJBRWMsZUFBZSIsImZpbGUiOiJhdXRvY29tcGxldGUvY2FsY3VsYXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBUaGlzIG1vZHVsZSBoYW5kbGVzIHZhcmlvdXMgY2FsY3VsYXRpb25zXG4gKlxuICovXG5cbmltcG9ydCB7IHV0aWxzIH0gZnJvbSBcImNvcmUvY2xpcXpcIjtcbmltcG9ydCBSZXN1bHQgZnJvbSBcImF1dG9jb21wbGV0ZS9yZXN1bHRcIjtcbmltcG9ydCB7IGlzRmlyZWZveCB9IGZyb20gXCJjb3JlL3BsYXRmb3JtXCI7XG5cbmxldCBtYXRoTGliO1xuXG5pZiAoaXNGaXJlZm94KSB7XG4gIGNvbnN0IGdsb2JhbCA9IHt9O1xuICBTZXJ2aWNlcy5zY3JpcHRsb2FkZXIubG9hZFN1YlNjcmlwdCgnY2hyb21lOi8vY2xpcXovY29udGVudC9ib3dlcl9jb21wb25lbnRzL21hdGhqcy9kaXN0L21hdGgubWluLmpzJywgZ2xvYmFsKTtcbiAgbWF0aExpYiA9IGdsb2JhbC5tYXRoO1xufSBlbHNlIHtcbiAgbWF0aExpYiA9IHdpbmRvdy5tYXRoO1xufVxuXG4vLyBSRUY6XG4vLyAgICAgIGh0dHA6Ly9tYXRoanMub3JnL2RvY3MvaW5kZXguaHRtbFxuLy8gICAgICBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI2NjAzNzk1L3ZhcmlhYmxlLW5hbWUtYW5kLXJlc3RyaWN0LW9wZXJhdG9ycy1pbi1tYXRoLWpzXG4vLyAgICAgIGh0dHA6Ly9qc2Jpbi5jb20vZHVkdXJ1LzEvZWRpdD9odG1sLG91dHB1dFxuXG52YXIgQlJPV1NFUl9MQU5HID0gdXRpbHMuZ2V0TG9jYWxpemVkU3RyaW5nKCdsb2NhbGVfbGFuZ19jb2RlJyk7XG5cbmZ1bmN0aW9uIGdldEVxdWFsT3BlcmF0b3IodmFsLCBsb2NhbGl6ZWRTdHIpe1xuICB2YXIgdmFsU3RyID0gdmFsLnRvU3RyaW5nKCkucmVwbGFjZShcIixcIixcIlwiKS5yZXBsYWNlKFwiLlwiLFwiXCIpLFxuICAgIG5vcm1Mb2NhbGl6ZWRTdHIgPSBsb2NhbGl6ZWRTdHIucmVwbGFjZShcIixcIixcIlwiKS5yZXBsYWNlKFwiLlwiLFwiXCIpO1xuICByZXR1cm4gdmFsU3RyID09PSBub3JtTG9jYWxpemVkU3RyID8gXCI9XCIgOiBcIlxcdTIyNDhcIjtcbn1cblxudmFyIENsaXF6Q2FsY3VsYXRvciA9IHtcbiAgQ0FMQ1VMQVRPUl9SRVM6IDAsXG4gIFVOSVRfUkVTOiAnJyxcbiAgSVNfVU5JVF9DT05WRVJURVI6IGZhbHNlLFxuICBCQVNFX1VOSVRfQ09OVkVSVEVSOiAnJyxcbiAgRkxPQVRfREVDOiBbMTAwMDAwLCAxMDAsIDFdLFxuICBGTE9BVF9ERUNfVEhSRVNIT0xEOiBbOTksIDk5OTk5XSxcbiAgQUNDRVBUX0VSUk9SOiAxZS04LFxuICBVTklUX0NPTlZFUlNJT05fREFUQTogeyAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db252ZXJzaW9uX29mX3VuaXRzXG4gICAgLy8gaHR0cDovL3d3dy5jb252ZXJ0LW1lLmNvbS9lbi9jb252ZXJ0L2xlbmd0aC9cbiAgICAnTE9DQUxJWkVfS0VZUyc6IHsnZGUtREUnOiAnbmFtZXNfZGUnLCAnZW4tVVMnOiAnbmFtZXNfZW4nLCAnZGVmYXVsdCc6ICduYW1lc19kZSd9LFxuICAgICd0eXBlcyc6IFsnbGVuZ3RoJywgJ21hc3MnXSxcbiAgICAnbGVuZ3RoJzoge1xuICAgICAgJ2Jhc2UnOiAnbScsXG4gICAgICAndW5pdHMnOiBbXG4gICAgICAgIHsndmFsJzogNDgyOCwgJ25hbWVzJzogWydsZWEnLCAnbGV1Z2UnLCAnbGVhZ3VlJywgJ2xlYWd1ZXMnXX0sXG4gICAgICAgIHsndmFsJzogMC4zMDQ4MDA2MDk2MDEyMTkyLCAvLyB0aGlzIGlzIFVTIGZvb3QsIHRoZXJlJ3JlIElESUFOLCBDTEEsIEJFTiwuLi5cbiAgICAgICAgICAnbmFtZXMnOiBbJ2Z0JywgJ2Zvb3QnLCAnZmVldCcsICdmdVxcdTAwREYnXSxcbiAgICAgICAgICAnbmFtZXNfZW4nOiB7J3MnOiAnZm9vdCcsICdwJzogJ2ZlZXQnfSxcbiAgICAgICAgICAnbmFtZXNfZGUnOiB7J3MnOiAnZnVcXHUwMERGJywgJ3AnOiAnZnVcXHUwMERGJ319LFxuICAgICAgICB7J3ZhbCc6IDAuMDI1NCwgJ25hbWVzJzogWydpbicsICdpbmNoJywgJ2luY2hlcycsICd6b2xsJ119LFxuICAgICAgICB7J3ZhbCc6IDEwMDAsICduYW1lcyc6IFsna20nLCAna2lsb21ldGVyJywgJ2tpbG9tZXRyZScsICdraWxvbWV0cmVzJywgJ2tpbG9tZXRlcnMnXX0sXG4gICAgICAgIHsndmFsJzogMSwgJ25hbWVzJzogWydtJywgJ21ldGVyJywgJ21ldHJlJywgJ21ldHJlcycsICdtZXRlcnMnXX0sXG4gICAgICAgIHsndmFsJzogMC4xLCAnbmFtZXMnOiBbJ2RtJywgJ2RlY2ltZXRlcicsICdkZWNpbWV0cmUnLCAnZGVjaW1ldGVycycsICdkZWNpbWV0cmVzJywgJ2RlemltZXRlciddfSxcbiAgICAgICAgeyd2YWwnOiAwLjAxLCAnbmFtZXMnOiBbJ2NtJywgJ2NlbnRpbWV0ZXInLCAnY2VudGltZXRyZScsICdjZW50aW1ldHJlcycsICdjZW50aW1ldGVycycsICd6ZW50aW1ldGVyJ119LFxuICAgICAgICB7J3ZhbCc6IDAuMDAxLCAnbmFtZXMnOiBbJ21tJywgJ21pbGxpbWV0ZXInLCAnbWlsbGltZXRyZScsICdtaWxsaW1ldHJlcycsICdtaWxsaW1ldGVycyddfSxcbiAgICAgICAgeyd2YWwnOiAxZS02LCAnbmFtZXMnOiBbJ21pY3JvbicsICdtaWNyb21ldGVyJywgJ21pY3JvbWV0cmUnLCAnbWljcm9tZXRyZXMnLCAnbWljcm9tZXRlcnMnLCAnbWlrcm9tZXRlciddfSxcbiAgICAgICAgeyd2YWwnOiAxZS05LCAnbmFtZXMnOiBbJ25tJywgJ25hbm9tZXRyZScsICduYW5vbWV0cmUnLCAnbmFub21ldGVyJywgJ25hbm9tZXRlcnMnXX0sXG4gICAgICAgIHsndmFsJzogMTAwMDAsICduYW1lcyc6IFsnbWlsJ119LCAgLy8gdGhpcyBpcyBTd2VkZW4gYW5kIE5vcndheSB1bml0XG4gICAgICAgIHsndmFsJzogMTYwOS4zNDQsXG4gICAgICAgICAgJ25hbWVzJzogWydtaWwuJywgJ21pLicsICdtaWxlJywgJ21pbGVzJywgJ21laWxlJywgJ21laWxlbiddLFxuICAgICAgICAgICduYW1lc19lbic6IHsncyc6ICdtaWxlJywgJ3AnOiAnbWlsZXMnfSxcbiAgICAgICAgICAnbmFtZXNfZGUnOiB7J3MnOiAnbWVpbGUnLCAncCc6ICdtZWlsZW4nfX0sXG4gICAgICAgIHsndmFsJzogMjAxLjE2OCwgJ25hbWVzJzogWydmdXJsb25nJywgJ2Z1cmxvbmdzJ119LFxuICAgICAgICB7J3ZhbCc6IDAuOTE0NCwgJ25hbWVzJzogWyd5ZCcsICd5YXJkJywgJ3lhcmRzJ119LFxuICAgICAgICB7J3ZhbCc6IDIuNTQgKiAxZS01LCAnbmFtZXMnOiBbJ3Rob3UnXX0sXG4gICAgICAgIHsndmFsJzogMS44Mjg4LCAnbmFtZXMnOiBbJ2ZtJywgJ2ZhdGhvbScsICdmYXRob21zJywgJ2ZhZGVuJywgJ2ZcXHUwMEU0ZGVuJ119LFxuICAgICAgICB7J3ZhbCc6IDUuMDI5MiwgJ25hbWVzJzogWydyZCcsICdyb2QnLCAncm9kcycsICdydXRlJywgJ3J1dGVuJ119LFxuICAgICAgICB7J3ZhbCc6IDAuMTAxNiwgJ25hbWVzJzogWydoYW5kJywgJ2hhbmRzJywgJ2hhbmRicmVpdCddfSxcbiAgICAgICAgeyd2YWwnOiAwLjIyODYsICduYW1lcyc6IFsnc3BhbicsICdzcGFucycsICdzcGFubmUnLCAnc3Bhbm5lbiddfSxcbiAgICAgICAgeyd2YWwnOiA1NTU2LCAnbmFtZXMnOiBbJ25hdXQubGVhZycsICduYXV0aWNhbCBsZWFndWUnLCAnbmF1dC5sZWFncycsICduYXV0aWNhbCBsZWFndWUnXX0sXG4gICAgICAgIHsndmFsJzogMTg1MiwgJ25hbWVzJzogWyduYXV0Lm1pbCcsICduYXV0Lm1pbHMnLCAnbmF1dGljYWwgbWlsZScsICduYXV0aWNhbCBtaWxlcycsICduYXV0Lm1laWxlJywgJ25hdXQubWVpbGVuJywgJ25hdXRpc2NoZSBtZWlsZScsICduYXV0aXNjaGUgbWVpbGVuJ119LFxuICAgICAgICB7J3ZhbCc6IDE4NTIuMjE2LCAnbmFtZXMnOiBbJ3NtJywgJ1NlZW1laWxlJ119LFxuICAgICAgICB7J3ZhbCc6IDE4NS4yLCAnbmFtZXMnOiBbJ2NibCcsICdjYWJsZSBsZW5ndGgnLCBcImNhYmxlJ3NsZW5ndGhcIiwgJ0thYmVsJywgJ0thYmVsbMOkbmdlJ119XG4gICAgICBdXG4gICAgfSxcbiAgICAnbWFzcyc6IHtcbiAgICAgIFwiYmFzZVwiOiAnZycsXG4gICAgICAndW5pdHMnOiBbXG4gICAgICAgIHsndmFsJzogMTAyLCAnbmFtZXMnOiBbJ2tOJywgJ2tuJywgJ2tpbG9uZXd0b24nLCAna2lsb25ld3RvbnMnXX0sXG4gICAgICAgIHsndmFsJzogMWU5LCAnbmFtZXMnOiBbJ2t0JywgJ2tpbG90b25uZScsICdraWxvdG9ubmVzJywgJ2tpbG90b25uZW4nXX0sXG4gICAgICAgIHsndmFsJzogMWU2LCAnbmFtZXMnOiBbJ3QnLCAndG9ubmUnLCAndG9ubmVzJywgJ3Rvbm5lbicsICdtZXRyaWMgdG9uJywgJ21ldHJpYyB0b25zJ119LFxuICAgICAgICB7J3ZhbCc6IDFlNiwgJ25hbWVzJzogWydNZycsICdtZWdhZ3JhbScsICdtZWdhZ3JhbXMnXX0sXG4gICAgICAgIHsndmFsJzogMTAwMCwgJ25hbWVzJzogWydrZycsICdraWxvZ3JhbScsICdraWxvZ3JhbXMnLCAna2lsb2dyYW1tZScsICdraWxvZ3JhbW1lcycsICdraWxvZ3JhbW0nLCAna2lsb2dyYW1tcyddfSxcbiAgICAgICAgeyd2YWwnOiAxMDAsICduYW1lcyc6IFsnaGcnLCAnaGVjdG9ncmFtJywgJ2hlY3RvZ3JhbXMnLCAnaGVjdG9ncmFtbWUnLCAnaGVjdG9ncmFtbWVzJywgJ2hlY3RvZ3JhbW0nLCAnaGVjdG9ncmFtbXMnXX0sXG4gICAgICAgIHsndmFsJzogMTAsICduYW1lcyc6IFsnZGFnJywgJ2RlY2FncmFtJywgJ2RlY2FncmFtcycsICdkZWNhZ3JhbW1lJywgJ2RlY2FncmFtbWVzJywgJ2RlY2FncmFtbScsICdkZWNhZ3JhbW1zJ119LFxuICAgICAgICB7J3ZhbCc6IDEsICduYW1lcyc6IFsnZycsICdncmFtJywgJ2dyYW1zJywgJ2dyYW1tZScsICdncmFtbWVzJywgJ2dyYW1tJywgJ2dyYW1tcyddfSxcbiAgICAgICAgeyd2YWwnOiAwLjEsICduYW1lcyc6IFsnZGcnLCAnZGVjaWdyYW0nLCAnZGVjaWdyYW1zJywgJ2RlY2lncmFtbWUnLCAnZGVjaWdyYW1tZXMnLCAnZGVjaWdyYW1tJywgJ2RlY2lncmFtbXMnXX0sXG4gICAgICAgIHsndmFsJzogMC4wMSwgJ25hbWVzJzogWydjZycsICdjZW50aWdyYW0nLCAnY2VudGlncmFtcycsICdjZW50aWdyYW1tZScsICdjZW50aWdyYW1tZXMnLCAnY2VudGlncmFtbScsICdjZW50aWdyYW1tcyddfSxcbiAgICAgICAgeyd2YWwnOiAwLjAwMSwgJ25hbWVzJzogWydtZycsICdtaWxsaWdyYW0nLCAnbWlsbGlncmFtcycsICdtaWxsaWdyYW1tZScsICdtaWxsaWdyYW1tZXMnLCAnbWlsbGlncmFtbScsICdtaWxsaWdyYW1tcyddfSxcbiAgICAgICAgeyd2YWwnOiAwLjAwMDAwMSwgJ25hbWVzJzogWydtY2cnLCAnbWljcm9ncmFtJywgJ21pY3JvZ3JhbXMnLCAnbWljcm9ncmFtbWUnLCAnbWljcm9ncmFtbWVzJywgJ21pY3JvZ3JhbW0nLCAnbWljcm9ncmFtbXMnXX0sXG4gICAgICAgIHsndmFsJzogNDUzLjU5MjM3LCAnbmFtZXMnOiBbJ2xiJywgJ2xicycsICdwb3VuZCcsICdwb3VuZHMnLCAncG91bmQtbWFzcycsICdwZnVuZCddfSxcbiAgICAgICAgeyd2YWwnOiAyOC4zNDk1MjMxMjUsICduYW1lcyc6IFsnb3onLCAnb3pzJywgJ291bmNlICcsICdvdW5jZXMnLCAndW56ZScsICd1bnplbiddfSxcbiAgICAgICAgeyd2YWwnOiAxLjc3MTg0NTIsICduYW1lcyc6IFsnZHInLCAnZHJhbScsICdkcmFtcyddfSxcbiAgICAgICAgeyd2YWwnOiAwLjA2NDc5ODkxLCAnbmFtZXMnOiBbJ2dyJywgJ2dyYWluJywgJ2dyYWlucycsICdHcmFuJ119XG4gICAgICBdXG4gICAgfVxuICB9LFxuICBzaG9ydGVuTnVtYmVyOiBmdW5jdGlvbigpe1xuICAgIC8vIHNob3J0ZW4gbnVtYmVycyB3aGVuIG5lZWRlZFxuICAgIHRyeSB7XG4gICAgICB2YXIgbnVtUmF3LCBudW0sIG51bTEsIGZsb2F0RGVjID0gMSwgcmVzdWx0U2lnbiA9IFwiXCI7XG5cbiAgICAgIG51bTEgPSB0aGlzLkNBTENVTEFUT1JfUkVTO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuRkxPQVRfREVDX1RIUkVTSE9MRC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoTWF0aC5hYnMobnVtMSkgPCB0aGlzLkZMT0FUX0RFQ19USFJFU0hPTERbaV0pIHtcbiAgICAgICAgICBmbG9hdERlYyA9IHRoaXMuRkxPQVRfREVDW2ldO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBudW1SYXcgPSBNYXRoLnJvdW5kKG51bTEgKiBmbG9hdERlYykgLyBmbG9hdERlYztcbiAgICAgIG51bSA9IG51bVJhdy50b0xvY2FsZVN0cmluZyh1dGlscy5nZXRMb2NhbGl6ZWRTdHJpbmcoJ2xvY2FsZV9sYW5nX2NvZGUnKSk7XG4gICAgICByZXN1bHRTaWduID0gZ2V0RXF1YWxPcGVyYXRvcihudW0xLCBudW0pO1xuXG4gICAgICB0aGlzLkNBTENVTEFUT1JfUkVTID0gdGhpcy5JU19VTklUX0NPTlZFUlRFUiA/IFtudW0sIHRoaXMuVU5JVF9SRVNdLmpvaW4oXCIgXCIpIDogbnVtLnRvU3RyaW5nKCk7XG4gICAgICByZXR1cm4gW3Jlc3VsdFNpZ24sIHRoaXMuQ0FMQ1VMQVRPUl9SRVNdXG4gICAgfSBjYXRjaCAoZXJyKSB7fVxuICAgIHJldHVybiBudWxsXG4gIH0sXG4gIGNsZWFuOiBmdW5jdGlvbihxKSB7XG4gICAgaWYgKCFpc05hTihxKSkge1xuICAgICAgcmV0dXJuICcnOyAvLyBEb24ndCB0cmlnZ2VyIGNhbGN1bGF0b3IgeWV0IGlmIHRoZSBxdWVyeSBpcyBqdXN0IGEgbnVtYmVyXG4gICAgfVxuICAgIHZhciBvcGVyYXRvcnMgPSBbJysnLCAnLScsICcqJywgJy8nLCAnXicsICc9J107XG4gICAgcSA9IHEucmVwbGFjZSgvKFxcZCksKFxcZCkvZywgJyQxLiQyJyk7IC8vIGNvbW1hcyBhcmUgc2VwYXJhdG9ycyB0byBnZXJtYW4gcHBsXG4gICAgcSA9IHEucmVwbGFjZSgvIC9nLCAnJyk7IC8vIFJlbW92ZSBhbGwgc3BhY2VzXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcGVyYXRvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChxW3EubGVuZ3RoIC0gMV0gPT0gb3BlcmF0b3JzW2ldKSB7XG4gICAgICAgIHJldHVybiBxLnN1YnN0cigwLCBxLmxlbmd0aC0xKTsgLy8gUmVtb3ZlIHRoZSBsYXN0IG9wZXJhdG9yXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBxO1xuICB9LFxuICBjYWxjdWxhdGU6IGZ1bmN0aW9uKHEpIHtcbiAgICBpZiAodGhpcy5DQUxDVUxBVE9SX1JFUyA9PT0gbnVsbCB8fCB0aGlzLkNBTENVTEFUT1JfUkVTID09PSBxKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgdmFyIGV4cGFuZGVkRXhwcmVzc2lvbiA9IHRoaXMuSVNfVU5JVF9DT05WRVJURVIgPyB0aGlzLkJBU0VfVU5JVF9DT05WRVJURVIgOiBtYXRoTGliLnBhcnNlKHRoaXMuY2xlYW4ocSkpLnRvU3RyaW5nKCksXG4gICAgICByZXN1bHRTaWduID0gdGhpcy5zaG9ydGVuTnVtYmVyKClbMF07XG5cbiAgICByZXR1cm4gUmVzdWx0LmNsaXF6RXh0cmEoXG4gICAgICB7XG4gICAgICAgIHVybDogXCJcIixcbiAgICAgICAgcTogcSxcbiAgICAgICAgc3R5bGU6IFwiY2xpcXotZXh0cmFcIixcbiAgICAgICAgdHlwZTogXCJjbGlxei1leHRyYVwiLFxuICAgICAgICBzdWJUeXBlOiBKU09OLnN0cmluZ2lmeSh7dHlwZTogJ2NhbGN1bGF0b3InfSksXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0ZW1wbGF0ZTogJ2NhbGN1bGF0b3InLFxuICAgICAgICAgIGV4cHJlc3Npb246IGV4cGFuZGVkRXhwcmVzc2lvbixcbiAgICAgICAgICBhbnN3ZXI6IHRoaXMuQ0FMQ1VMQVRPUl9SRVMsXG4gICAgICAgICAgaXNfY2FsY3VsdXM6IHRydWUsXG4gICAgICAgICAgLy8gVE9ETzogc3VwcG9ydF9jb3B5X2FucyBzaG91bGQgYmUgcGxhdGZvcm0gc3BlY2lmaWNcbiAgICAgICAgICBzdXBwb3J0X2NvcHlfYW5zOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9LFxuXG4gIGZpbmRfdW5pdF9pbl9kYXRhOiBmdW5jdGlvbih1bml0Xykge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgIHVuaXQgPSB1bml0Xy50b0xvd2VyQ2FzZSgpLFxuICAgICAgdW5pdEZvdW5kID0gbnVsbDtcblxuICAgIHNlbGYuVU5JVF9DT05WRVJTSU9OX0RBVEEudHlwZXMuc29tZShmdW5jdGlvbih0eXBlKSB7XG4gICAgICByZXR1cm4gc2VsZi5VTklUX0NPTlZFUlNJT05fREFUQVt0eXBlXS51bml0cy5zb21lKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaWYgKGl0ZW1bJ25hbWVzJ10uaW5kZXhPZih1bml0KSA+IC0xIHx8IGl0ZW1bJ25hbWVzJ10uaW5kZXhPZih1bml0XykgPiAtMSkge1xuICAgICAgICAgIHVuaXRGb3VuZCA9IFt0eXBlLCB0cnVlLCBpdGVtXTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gdW5pdEZvdW5kIHx8IFtcIlwiLCBmYWxzZSwgbnVsbF07XG4gIH0sXG5cbiAgc2VsZWN0VW5pdFRlcm1zOiBmdW5jdGlvbih1bml0X2RhdGEsIHZhbCkge1xuICAgIC8qXG4gICAgICogICArIGJhc2VkIG9uIHRoZSB2YWx1ZSBhbmQgdGhlIGxhbmd1YWdlIHByZWZlcmVuY2UsIHNlbGVjdCB1bml0IG5hbWUgaW4gc3VpdGFibGUgbGFuZ3VhZ2UgYW5kIGZvcm0gKHNpbmd1bGFyL3BsdXJhbClcbiAgICAgKi9cbiAgICB2YXIgbm91bl90eXBlID0gdmFsID09PSAxID8gJ3MnIDogJ3AnLFxuICAgICAgbmFtZUluZm8gPSB1bml0X2RhdGFbQ2xpcXpDYWxjdWxhdG9yLlVOSVRfQ09OVkVSU0lPTl9EQVRBLkxPQ0FMSVpFX0tFWVNbQlJPV1NFUl9MQU5HXV1cbiAgICAgICAgICAgICAgICAgIHx8IHVuaXRfZGF0YVtDbGlxekNhbGN1bGF0b3IuVU5JVF9DT05WRVJTSU9OX0RBVEEuTE9DQUxJWkVfS0VZU1snZGVmYXVsdCddXVxuICAgICAgICAgICAgICAgICAgfHwgdW5pdF9kYXRhWyduYW1lcyddLFxuICAgICAgbmFtZSA9IG5hbWVJbmZvW25vdW5fdHlwZV07XG5cbiAgICByZXR1cm4gbmFtZSB8fCB1bml0X2RhdGFbJ25hbWVzJ11bJzAnXSB8fCBcIlwiO1xuICB9LFxuXG4gIGlzQ29udmVydGVyU2VhcmNoOiBmdW5jdGlvbihxKSB7XG4gICAgLy8gLS0tIFByb2Nlc3MgcXVlcnkgdG8gcmVjb2duaXplIGEgdW5pdC1jb252ZXJzaW9uIHF1ZXJ5XG4gICAgLy8gQUNDRVBURUQgcXVlcnkgdHlwZXM6XG4gICAgLy8gICAgMS4gYSB0byBiLCBlLmcuIGNtIHRvIG1tXG4gICAgdmFyIHRtcCA9IHEudHJpbSgpLFxuICAgICAgcGFyYW1MaXN0LCB1bml0MSwgdW5pdDIsIGlkeCwgbnVtLCB1bml0MUluZm87XG4gICAgLy8gTm90ZTogZG9uJ3QgdXNlIHJlZ2V4IG1hdGNoIGluIHJlcGxhY2UgZnVuY3Rpb24sIGUuZy4gdG1wLnJlcGxhY2UoLyB6dSB8IGluIHwgaW0gL2csICcgdG8gJylcbiAgICB0bXAgPSBxLnJlcGxhY2UoJyB6dSAnLCAnIHRvICcpO1xuICAgIHRtcCA9IHRtcC5yZXBsYWNlKCcgaW0gJywgJyB0byAnKTtcbiAgICB0bXAgPSB0bXAucmVwbGFjZSgnIGluICcsICcgdG8gJyk7XG4gICAgdG1wID0gdG1wLnJlcGxhY2UoJyBpbnRvICcsICcgdG8gJyk7ICAvLyB0aGlzIG5lZWRzIHRvIGJlIGF0IHRoZSBlbmRcbiAgICBwYXJhbUxpc3QgPSB0bXAudHJpbSgpLnNwbGl0KCcgdG8gJyk7XG5cbiAgICBpZiAocGFyYW1MaXN0Lmxlbmd0aCAhPT0gMilcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB1bml0MiA9IHRoaXMuZmluZF91bml0X2luX2RhdGEocGFyYW1MaXN0WzFdLnRyaW0oKSk7XG4gICAgaWYgKHVuaXQyWzFdKSB7XG4gICAgICB1bml0MSA9IHBhcmFtTGlzdFswXS5yZXBsYWNlKCcgJywgJycpICsgJyAnO1xuICAgICAgaWR4ID0gMDtcbiAgICAgIHdoaWxlICh1bml0MVtpZHhdID09PSAnLCcgfHwgdW5pdDFbaWR4XSA9PT0gJy4nIHx8ICh1bml0MVtpZHhdID49ICcwJyAmJiB1bml0MVtpZHhdIDw9ICc5JykpXG4gICAgICAgIGlkeCsrO1xuICAgICAgaWYgKGlkeCA9PT0gMCkge1xuICAgICAgICBudW0gPSAxXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBudW0gPSBOdW1iZXIodW5pdDEuc2xpY2UoMCwgaWR4KSk7XG4gICAgICAgIGlmIChpc05hTihudW0pKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdW5pdDEgPSB1bml0MS5zbGljZShpZHgsIHVuaXQxLmxlbmd0aCkudHJpbSgpO1xuICAgICAgdW5pdDFJbmZvID0gdGhpcy5maW5kX3VuaXRfaW5fZGF0YSh1bml0MSk7XG4gICAgICBpZiAoIXVuaXQxSW5mb1sxXSB8fCB1bml0MUluZm9bMF0gIT09IHVuaXQyWzBdKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfSAgLy8gaWYgbm90IHVuaXQgb2YgdGhlIHNhbWUgdHlwZSwgZS5nLiAxa20gdG8gZyBzaG91bGQgbm90IHJldHVybiByZXN1bHRcblxuICAgICAgdGhpcy5JU19VTklUX0NPTlZFUlRFUiA9IHRydWU7XG4gICAgICB2YXIgY3ZSYXcgPSB1bml0MUluZm9bMl0udmFsIC8gdW5pdDJbMl0udmFsLFxuICAgICAgICBjdiA9IGN2UmF3LnRvTG9jYWxlU3RyaW5nKHV0aWxzLmdldExvY2FsaXplZFN0cmluZygnbG9jYWxlX2xhbmdfY29kZScpKTtcbiAgICAgIHRoaXMuQ0FMQ1VMQVRPUl9SRVMgPSBudW0gKiBjdlJhdztcbiAgICAgIHRoaXMuVU5JVF9SRVMgPSBDbGlxekNhbGN1bGF0b3Iuc2VsZWN0VW5pdFRlcm1zKHVuaXQyWzJdLCB0aGlzLkNBTENVTEFUT1JfUkVTKTtcbiAgICAgIHRoaXMuQkFTRV9VTklUX0NPTlZFUlRFUiA9IFtcbiAgICAgICAgJzEnLFxuICAgICAgICBDbGlxekNhbGN1bGF0b3Iuc2VsZWN0VW5pdFRlcm1zKHVuaXQxSW5mb1syXSwgMSksXG4gICAgICAgIGdldEVxdWFsT3BlcmF0b3IoY3ZSYXcsIGN2KSxcbiAgICAgICAgY3YsXG4gICAgICAgIENsaXF6Q2FsY3VsYXRvci5zZWxlY3RVbml0VGVybXModW5pdDJbMl0sIHRoaXMuQ0FMQ1VMQVRPUl9SRVMsIGN2UmF3KVxuICAgICAgXS5qb2luKFwiIFwiKTtcblxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH0sXG5cbiAgaXNDYWxjdWxhdG9yU2VhcmNoOiBmdW5jdGlvbihxKSB7XG4gICAgLy8gZmlsdGVyIG91dDpcbiAgICAvLyArIHRvbyBzaG9ydCBxdWVyeSAoYXZvaWQgYW5zd2VyaW5nIGUsIHBpKVxuICAgIC8vICsgYXV0b21hdGljYWxseSBjb252ZXJ0IHF1ZXJpZXMgbGlrZSAnMTBjbVxuICAgIHZhciB0bXAgPSB0aGlzLmNsZWFuKHEpXG4gICAgaWYgKHRtcC5sZW5ndGggPD0gMiB8fCB0bXAubGVuZ3RoID4gMTUwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuQ0FMQ1VMQVRPUl9SRVMgPSBtYXRoTGliLmV2YWwodG1wKTtcblxuICAgICAgaWYgKHR5cGVvZih0aGlzLkNBTENVTEFUT1JfUkVTKSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgdGhpcy5JU19VTklUX0NPTlZFUlRFUiA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXNDb252ZXJ0ZXJTZWFyY2gocSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IENsaXF6Q2FsY3VsYXRvcjtcbiJdfQ==