System.register('antitracking/url', ['antitracking/md5', 'antitracking/fixed-size-cache'], function (_export) {
  'use strict';

  var md5, MapCache, URLInfo;

  function parseHostname(hostname) {
    var o = { 'hostname': null, 'username': '', 'password': '', 'port': null };

    var h = hostname;
    var v = hostname.split('@');
    if (v.length > 1) {
      var w = v[0].split(':');
      o['username'] = w[0];
      o['password'] = w[1];
      h = v[1];
    }

    v = h.split(':');
    if (v.length > 1) {
      o['hostname'] = v[0];
      o['port'] = parseInt(v[1]);
    } else {
      o['hostname'] = v[0];
      o['port'] = 80;
    }

    return o;
  }

  function parseURL(url) {
    /*  Parse a URL string into a set of sub-components, namely:
     - protocol
     - username
     - password
     - hostname
     - port
     - path
     - parameters (semicolon separated key-values before the query string)
     - query (? followed by & separated key-values)
     - fragment (after the #)
     Given a valid string url, this function returns an object with the above
     keys, each with the value of that component, or empty string if it does not
     appear in the url.
      Additionally, any key-value pairs found in the parameters, query and fragment
     components are extracted into objects in 'parameter_keys', query_keys' and
     'fragment_keys' respectively.
     */
    var o = {};

    var v = url.split('://');
    if (v.length >= 2) {

      o['protocol'] = v[0];
      o['hostname'] = '';
      o['port'] = '';
      o['username'] = '';
      o['password'] = '';
      o['path'] = '/';
      o['query'] = '';
      o['parameters'] = '';
      o['fragment'] = '';
      o['host'] = '';
      var s = v.slice(1, v.length).join('://');

      var state = 'host';
      for (var i = 0; i < s.length; i++) {
        var c = s.charAt(i);
        // check for special characters which can change parser state
        if (c == '#' && ['host', 'path', 'query', 'parameters'].indexOf(state) >= 0) {
          // begin fragment
          state = 'fragment';
          continue;
        } else if (c == '?' && ['host', 'path', 'parameters'].indexOf(state) >= 0) {
          // begin query string
          state = 'query';
          continue;
        } else if (c == ';' && ['host', 'path'].indexOf(state) >= 0) {
          // begin parameter string
          state = 'parameters';
          continue;
        } else if (c == '/' && state == 'host') {
          // from host we could go into any next state
          state = 'path';
          continue;
        }

        // add character to key based on state
        o[state] += c;
      }

      if (o['host'] == '') return null;

      var oh = parseHostname(o['host']);
      ['hostname', 'port', 'username', 'password'].forEach(function (k) {
        o[k] = oh[k];
      });
      delete o['host'];

      if (state != 'path') {
        o['query_keys'] = getParametersQS(o['query']);
        o['parameter_keys'] = getParametersQS(o['parameters']);
        o['fragment_keys'] = getParametersQS(o['fragment']);
      } else {
        o['query_keys'] = {};
        o['parameter_keys'] = {};
        o['fragment_keys'] = {};
      }
    } else {
      return null;
    }
    return o;
  }

  function getParametersQS(qs) {
    var res = {},
        _blacklist = {};
    var state = 'key';
    var k = '';
    var v = '';
    var _reviewQS = function _reviewQS(k, v) {
      if (v.indexOf('=') > -1) {
        var items = v.split('=');
        k = k + '_' + items[0];
        v = items.splice(1).join('=');
      }
      return [k, v];
    };
    var _updateQS = function _updateQS(k, v) {
      if (k in res || k in _blacklist) {
        _blacklist[k] = true;
        var kv = _reviewQS(k, v);
        res[kv[0]] = kv[1];
        // also the old one
        if (k in res) {
          v = res[k];
          kv = _reviewQS(k, v);
          res[kv[0]] = kv[1];
          delete res[k];
        }
      } else {
        res[k] = v;
      }
    };
    var quotes = '';
    for (var i = 0; i < qs.length; i++) {
      var c = qs.charAt(i);
      if (c === '"' || c === "'") {
        if (quotes.slice(-1) === c) {
          quotes = quotes.slice(0, quotes.length - 1);
        } else {
          quotes += c;
        }
      }
      if (c == '=' && state == 'key' && k.length > 0) {
        state = 'value';
        continue;
      } else if ((c === '&' || c === ';') && quotes === '') {
        if (state == 'value') {
          state = 'key';
          // in case the same key already exists
          v = dURIC(v);
          _updateQS(k, v);
        } else if (state == 'key' && k.length > 0) {
          // key with no value, set value='true'
          res[k] = 'true';
        }
        k = '';
        v = '';
        continue;
      }
      switch (state) {
        case 'key':
          k += c;
          break;
        case 'value':
          v += c;
          break;
      }
    }
    if (state == 'value') {
      state = 'key';
      v = dURIC(v);
      _updateQS(k, v);
    } else if (state == 'key' && k.length > 0) {
      res[k] = 'true';
    }
    return _flattenJson(res);
  }

  // The value in query strings can be a json object, we need to extract the key-value pairs out
  function _flattenJson(obj) {
    if (typeof obj === 'string' && (obj.indexOf('{') > -1 || obj.indexOf('[') > -1)) {
      try {
        obj = JSON.parse(obj);
        if (typeof obj !== 'object' && typeof obj !== 'array') {
          obj = JSON.stringify(obj);
        }
      } catch (e) {}
    }
    var res = {};
    switch (typeof obj) {
      case 'object':
        for (var key in obj) {
          var r = _flattenJson(obj[key]);
          for (var _key in r) {
            res[key + _key] = r[_key];
          }
        }
        break;
      case 'array':
        obj.forEach(function (e, i) {
          var r = _flattenJson(e);
          for (var _key in r) {
            res[i + _key] = r[_key];
          }
        });
        break;
      case 'number':
        obj = JSON.stringify(obj);
      default:
        res[''] = obj;
    }
    return res;
  }

  function dURIC(s) {
    // avoide error from decodeURIComponent('%2')
    try {
      return decodeURIComponent(s);
    } catch (e) {
      return s;
    }
  }

  function getHeaderMD5(headers) {
    var qsMD5 = {};
    for (var key in headers) {
      var tok = dURIC(headers[key]);
      while (tok != dURIC(tok)) {
        tok = dURIC(tok);
      }
      qsMD5[md5(key)] = md5(tok);
    }
    return qsMD5;
  }

  function shuffle(s) {
    var a = s.split(""),
        n = a.length;

    for (var i = n - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var tmp = a[i];
      a[i] = a[j];
      a[j] = tmp;
    }
    return a.join("");
  }

  function parseQuery(qstr) {
    var query = {};
    var a = qstr.split('&');
    for (var i in a) {
      var b = a[i].split('=');
      query[dURIC(b[0])] = dURIC(b[1]);
    }
    return query;
  }

  function findOauth(url, url_parts) {
    try {
      var value = null;

      if (url_parts.path.length < 50 && url_parts.query_string && url_parts.path.indexOf('oauth') != -1) {

        var qso = parseQuery(url_parts.query_string);
        var k = Object.keys(qso);
        for (var i = 0; i < k.length; i++) {
          if (k[i].indexOf('callback') != -1 || k[i].indexOf('redirect') != -1) {
            value = dURIC(qso[k[i]]);
          } else {
            if (qso[k[i]].indexOf('http') == 0 && qso[k[i]].indexOf('/oauth') != -1) {

              var url_parts2 = parseURL(qso[k[i]]);
              if (url_parts2 && url_parts2.path && url_parts2.path.indexOf('oauth')) {
                if (url_parts.query_string) {
                  var qso2 = parseQuery(url_parts2.query_string);
                  var k2 = Object.keys(qso2);
                  for (var i2 = 0; i2 < k2.length; i2++) {
                    if (k2[i2].indexOf('callback') != -1 || k2[i2].indexOf('redirect') != -1) {
                      value = dURIC(qso2[k2[i2]]);
                    }
                  }
                }
              }
            }
          }
        }
      }
      return value;
    } catch (ee) {
      return null;
    }
  }return {
    setters: [function (_antitrackingMd5) {
      md5 = _antitrackingMd5['default'];
    }, function (_antitrackingFixedSizeCache) {
      MapCache = _antitrackingFixedSizeCache['default'];
    }],
    execute: function () {
      ;;;;;

      /**
       URLInfo class: holds a parsed URL.
       */

      URLInfo = function URLInfo(url) {
        this.url_str = url;
        // map parsed url parts onto URL object
        var url_parts = parseURL(url);
        for (var k in url_parts) {
          this[k] = url_parts[k];
        }
        return this;
      };

      URLInfo._cache = new MapCache(function (url) {
        return new URLInfo(url);
      }, 100);

      /** Factory getter for URLInfo. URLInfo are cached in a LRU cache. */
      URLInfo.get = function (url) {
        if (!url) return "";
        return URLInfo._cache.get(url);
      };

      URLInfo.prototype = {
        toString: function toString() {
          return this.url_str;
        },
        getKeyValues: function getKeyValues() {
          var kvList = [];
          var _arr = [this.query_keys, this.parameter_keys];
          for (var _i = 0; _i < _arr.length; _i++) {
            var kv = _arr[_i];
            for (var key in kv) {
              kvList.push({ k: key, v: kv[key] });
            }
          }
          return kvList;
        },
        getKeyValuesMD5: function getKeyValuesMD5() {
          var kvList = this.getKeyValues();
          return kvList.map(function (kv) {
            kv.k_len = kv.k.length;
            kv.v_len = kv.v.length;
            kv.k = md5(kv.k);
            kv.v = md5(kv.v);
            return kv;
          });
        }
      };;;;

      _export('parseURL', parseURL);

      _export('getParametersQS', getParametersQS);

      _export('dURIC', dURIC);

      _export('getHeaderMD5', getHeaderMD5);

      _export('URLInfo', URLInfo);

      _export('shuffle', shuffle);

      _export('findOauth', findOauth);
    }
  };
});
//# sourceMappingURL=data:application/json;base64,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TUFBTSxDQUFDO0FBQ3ZCLGNBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqQixjQUFFLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakIsbUJBQU8sRUFBRSxDQUFDO1dBQ1gsQ0FBQyxDQUFDO1NBQ0o7T0FDRixDQUFDLEFBYUQsQ0FBQyxBQVdELENBQUMsQUFzQ0QsQ0FBQzs7MEJBR0EsUUFBUTs7aUNBQ1IsZUFBZTs7dUJBQ2YsS0FBSzs7OEJBQ0wsWUFBWTs7eUJBQ1osT0FBTzs7eUJBQ1AsT0FBTzs7MkJBQ1AsU0FBUyIsImZpbGUiOiJhbnRpdHJhY2tpbmcvdXJsLmVzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1kNSBmcm9tICdhbnRpdHJhY2tpbmcvbWQ1JztcbmltcG9ydCBNYXBDYWNoZSBmcm9tICdhbnRpdHJhY2tpbmcvZml4ZWQtc2l6ZS1jYWNoZSc7XG5cbmZ1bmN0aW9uIHBhcnNlSG9zdG5hbWUoaG9zdG5hbWUpIHtcbiAgdmFyIG8gPSB7J2hvc3RuYW1lJzogbnVsbCwgJ3VzZXJuYW1lJzogJycsICdwYXNzd29yZCc6ICcnLCAncG9ydCc6IG51bGx9O1xuXG4gIHZhciBoID0gaG9zdG5hbWU7XG4gIHZhciB2ID0gaG9zdG5hbWUuc3BsaXQoJ0AnKTtcbiAgaWYgKHYubGVuZ3RoID4gMSkge1xuICAgIHZhciB3ID0gdlswXS5zcGxpdCgnOicpO1xuICAgIG9bJ3VzZXJuYW1lJ10gPSB3WzBdO1xuICAgIG9bJ3Bhc3N3b3JkJ10gPSB3WzFdO1xuICAgIGggPSB2WzFdO1xuICB9XG5cbiAgdiA9IGguc3BsaXQoJzonKTtcbiAgaWYgKHYubGVuZ3RoID4gMSkge1xuICAgIG9bJ2hvc3RuYW1lJ10gPSB2WzBdO1xuICAgIG9bJ3BvcnQnXSA9IHBhcnNlSW50KHZbMV0pO1xuICB9XG4gIGVsc2Uge1xuICAgIG9bJ2hvc3RuYW1lJ10gPSB2WzBdO1xuICAgIG9bJ3BvcnQnXSA9IDgwO1xuICB9XG5cbiAgcmV0dXJuIG87XG59XG5cblxuZnVuY3Rpb24gcGFyc2VVUkwodXJsKSB7XG4gIC8qICBQYXJzZSBhIFVSTCBzdHJpbmcgaW50byBhIHNldCBvZiBzdWItY29tcG9uZW50cywgbmFtZWx5OlxuICAgLSBwcm90b2NvbFxuICAgLSB1c2VybmFtZVxuICAgLSBwYXNzd29yZFxuICAgLSBob3N0bmFtZVxuICAgLSBwb3J0XG4gICAtIHBhdGhcbiAgIC0gcGFyYW1ldGVycyAoc2VtaWNvbG9uIHNlcGFyYXRlZCBrZXktdmFsdWVzIGJlZm9yZSB0aGUgcXVlcnkgc3RyaW5nKVxuICAgLSBxdWVyeSAoPyBmb2xsb3dlZCBieSAmIHNlcGFyYXRlZCBrZXktdmFsdWVzKVxuICAgLSBmcmFnbWVudCAoYWZ0ZXIgdGhlICMpXG4gICBHaXZlbiBhIHZhbGlkIHN0cmluZyB1cmwsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3Qgd2l0aCB0aGUgYWJvdmVcbiAgIGtleXMsIGVhY2ggd2l0aCB0aGUgdmFsdWUgb2YgdGhhdCBjb21wb25lbnQsIG9yIGVtcHR5IHN0cmluZyBpZiBpdCBkb2VzIG5vdFxuICAgYXBwZWFyIGluIHRoZSB1cmwuXG5cbiAgIEFkZGl0aW9uYWxseSwgYW55IGtleS12YWx1ZSBwYWlycyBmb3VuZCBpbiB0aGUgcGFyYW1ldGVycywgcXVlcnkgYW5kIGZyYWdtZW50XG4gICBjb21wb25lbnRzIGFyZSBleHRyYWN0ZWQgaW50byBvYmplY3RzIGluICdwYXJhbWV0ZXJfa2V5cycsIHF1ZXJ5X2tleXMnIGFuZFxuICAgJ2ZyYWdtZW50X2tleXMnIHJlc3BlY3RpdmVseS5cbiAgICovXG4gIHZhciBvID0ge307XG5cbiAgdmFyIHYgPSB1cmwuc3BsaXQoJzovLycpO1xuICBpZiAodi5sZW5ndGggPj0gMikge1xuXG4gICAgb1sncHJvdG9jb2wnXSA9IHZbMF07XG4gICAgb1snaG9zdG5hbWUnXSA9ICcnO1xuICAgIG9bJ3BvcnQnXSA9ICcnO1xuICAgIG9bJ3VzZXJuYW1lJ10gPSAnJztcbiAgICBvWydwYXNzd29yZCddID0gJyc7XG4gICAgb1sncGF0aCddID0gJy8nO1xuICAgIG9bJ3F1ZXJ5J10gPSAnJztcbiAgICBvWydwYXJhbWV0ZXJzJ10gPSAnJztcbiAgICBvWydmcmFnbWVudCddID0gJyc7XG4gICAgb1snaG9zdCddID0gJyc7XG4gICAgdmFyIHMgPSB2LnNsaWNlKDEsIHYubGVuZ3RoKS5qb2luKCc6Ly8nKTtcblxuICAgIGxldCBzdGF0ZSA9ICdob3N0JztcbiAgICBmb3IobGV0IGk9MDsgaTxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgYyA9IHMuY2hhckF0KGkpO1xuICAgICAgLy8gY2hlY2sgZm9yIHNwZWNpYWwgY2hhcmFjdGVycyB3aGljaCBjYW4gY2hhbmdlIHBhcnNlciBzdGF0ZVxuICAgICAgaWYoYyA9PSAnIycgJiYgWydob3N0JywgJ3BhdGgnLCAncXVlcnknLCAncGFyYW1ldGVycyddLmluZGV4T2Yoc3RhdGUpID49IDApIHtcbiAgICAgICAgLy8gYmVnaW4gZnJhZ21lbnRcbiAgICAgICAgc3RhdGUgPSAnZnJhZ21lbnQnO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSBpZihjID09ICc/JyAmJiBbJ2hvc3QnLCAncGF0aCcsICdwYXJhbWV0ZXJzJ10uaW5kZXhPZihzdGF0ZSkgPj0gMCkge1xuICAgICAgICAvLyBiZWdpbiBxdWVyeSBzdHJpbmdcbiAgICAgICAgc3RhdGUgPSAncXVlcnknO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSBpZihjID09ICc7JyAmJiBbJ2hvc3QnLCAncGF0aCddLmluZGV4T2Yoc3RhdGUpID49IDApIHtcbiAgICAgICAgLy8gYmVnaW4gcGFyYW1ldGVyIHN0cmluZ1xuICAgICAgICBzdGF0ZSA9ICdwYXJhbWV0ZXJzJztcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYoYyA9PSAnLycgJiYgc3RhdGUgPT0gJ2hvc3QnKSB7XG4gICAgICAgIC8vIGZyb20gaG9zdCB3ZSBjb3VsZCBnbyBpbnRvIGFueSBuZXh0IHN0YXRlXG4gICAgICAgIHN0YXRlID0gJ3BhdGgnO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gYWRkIGNoYXJhY3RlciB0byBrZXkgYmFzZWQgb24gc3RhdGVcbiAgICAgIG9bc3RhdGVdICs9IGM7XG4gICAgfVxuXG4gICAgaWYgKG9bJ2hvc3QnXSA9PSAnJykgcmV0dXJuIG51bGw7XG5cbiAgICB2YXIgb2ggPSBwYXJzZUhvc3RuYW1lKG9bJ2hvc3QnXSk7XG4gICAgWydob3N0bmFtZScsICdwb3J0JywgJ3VzZXJuYW1lJywgJ3Bhc3N3b3JkJ10uZm9yRWFjaChmdW5jdGlvbihrKSB7XG4gICAgICBvW2tdID0gb2hba107XG4gICAgfSk7XG4gICAgZGVsZXRlIG9bJ2hvc3QnXTtcblxuICAgIGlmIChzdGF0ZSAhPSAncGF0aCcpIHtcbiAgICAgIG9bJ3F1ZXJ5X2tleXMnXSA9IGdldFBhcmFtZXRlcnNRUyhvWydxdWVyeSddKTtcbiAgICAgIG9bJ3BhcmFtZXRlcl9rZXlzJ10gPSBnZXRQYXJhbWV0ZXJzUVMob1sncGFyYW1ldGVycyddKTtcbiAgICAgIG9bJ2ZyYWdtZW50X2tleXMnXSA9IGdldFBhcmFtZXRlcnNRUyhvWydmcmFnbWVudCddKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb1sncXVlcnlfa2V5cyddID0ge307XG4gICAgICBvWydwYXJhbWV0ZXJfa2V5cyddID0ge307XG4gICAgICBvWydmcmFnbWVudF9rZXlzJ10gPSB7fTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIG87XG59O1xuXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJzUVMocXMpIHtcbiAgdmFyIHJlcyA9IHt9LFxuICAgICAgX2JsYWNrbGlzdCA9IHt9O1xuICBsZXQgc3RhdGUgPSAna2V5JztcbiAgbGV0IGsgPSAnJztcbiAgbGV0IHYgPSAnJztcbiAgdmFyIF9yZXZpZXdRUyA9IGZ1bmN0aW9uKGssIHYpIHtcbiAgICBpZiAodi5pbmRleE9mKCc9JykgPiAtMSkge1xuICAgICAgdmFyIGl0ZW1zID0gdi5zcGxpdCgnPScpO1xuICAgICAgayA9IGsgKyAnXycgKyBpdGVtc1swXTtcbiAgICAgIHYgPSBpdGVtcy5zcGxpY2UoMSkuam9pbignPScpO1xuICAgIH1cbiAgICByZXR1cm4gW2ssIHZdO1xuICB9O1xuICB2YXIgX3VwZGF0ZVFTID0gZnVuY3Rpb24oaywgdikge1xuICAgIGlmIChrIGluIHJlcyB8fCBrIGluIF9ibGFja2xpc3QpIHtcbiAgICAgIF9ibGFja2xpc3Rba10gPSB0cnVlO1xuICAgICAgdmFyIGt2ID0gX3Jldmlld1FTKGssIHYpO1xuICAgICAgcmVzW2t2WzBdXSA9IGt2WzFdO1xuICAgICAgLy8gYWxzbyB0aGUgb2xkIG9uZVxuICAgICAgaWYgKGsgaW4gcmVzKSB7XG4gICAgICAgIHYgPSByZXNba107XG4gICAgICAgIGt2ID0gX3Jldmlld1FTKGssIHYpO1xuICAgICAgICByZXNba3ZbMF1dID0ga3ZbMV07XG4gICAgICAgIGRlbGV0ZSByZXNba107XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc1trXSA9IHY7XG4gICAgfVxuICB9O1xuICB2YXIgcXVvdGVzID0gJyc7XG4gIGZvcihsZXQgaT0wOyBpPHFzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IGMgPSBxcy5jaGFyQXQoaSk7XG4gICAgaWYgKGMgPT09ICdcIicgfHwgYyA9PT0gXCInXCIpIHtcbiAgICAgIGlmIChxdW90ZXMuc2xpY2UoLTEpID09PSBjKSB7XG4gICAgICAgIHF1b3RlcyA9IHF1b3Rlcy5zbGljZSgwLCBxdW90ZXMubGVuZ3RoIC0gMSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcXVvdGVzICs9IGM7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGMgPT0gJz0nICYmIHN0YXRlID09ICdrZXknICYmIGsubGVuZ3RoID4gMCkge1xuICAgICAgc3RhdGUgPSAndmFsdWUnO1xuICAgICAgY29udGludWU7XG4gICAgfSBlbHNlIGlmKChjID09PSAnJicgfHwgYyA9PT0gJzsnKSAmJiBxdW90ZXMgPT09ICcnKSB7XG4gICAgICBpZihzdGF0ZSA9PSAndmFsdWUnKSB7XG4gICAgICAgIHN0YXRlID0gJ2tleSc7XG4gICAgICAgIC8vIGluIGNhc2UgdGhlIHNhbWUga2V5IGFscmVhZHkgZXhpc3RzXG4gICAgICAgIHYgPSBkVVJJQyh2KTtcbiAgICAgICAgX3VwZGF0ZVFTKGssIHYpO1xuICAgICAgfSBlbHNlIGlmKHN0YXRlID09ICdrZXknICYmIGsubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBrZXkgd2l0aCBubyB2YWx1ZSwgc2V0IHZhbHVlPSd0cnVlJ1xuICAgICAgICByZXNba10gPSAndHJ1ZSc7XG4gICAgICB9XG4gICAgICBrID0gJyc7XG4gICAgICB2ID0gJyc7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgc3dpdGNoKHN0YXRlKSB7XG4gICAgY2FzZSAna2V5JzpcbiAgICAgIGsgKz0gYztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3ZhbHVlJzpcbiAgICAgIHYgKz0gYztcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBpZihzdGF0ZSA9PSAndmFsdWUnKSB7XG4gICAgc3RhdGUgPSAna2V5JztcbiAgICB2ID0gZFVSSUModik7XG4gICAgX3VwZGF0ZVFTKGssIHYpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT0gJ2tleScgJiYgay5sZW5ndGggPiAwKSB7XG4gICAgcmVzW2tdID0gJ3RydWUnO1xuICB9XG4gIHJldHVybiBfZmxhdHRlbkpzb24ocmVzKTtcbn07XG5cbi8vIFRoZSB2YWx1ZSBpbiBxdWVyeSBzdHJpbmdzIGNhbiBiZSBhIGpzb24gb2JqZWN0LCB3ZSBuZWVkIHRvIGV4dHJhY3QgdGhlIGtleS12YWx1ZSBwYWlycyBvdXRcbmZ1bmN0aW9uIF9mbGF0dGVuSnNvbihvYmopIHtcbiAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnICYmIChvYmouaW5kZXhPZigneycpID4gLTEgfHwgb2JqLmluZGV4T2YoJ1snKSA+IC0xKSkge1xuICAgIHRyeSB7XG4gICAgICBvYmogPSBKU09OLnBhcnNlKG9iaik7XG4gICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIG9iaiAhPT0gJ2FycmF5Jykge1xuICAgICAgICBvYmogPSBKU09OLnN0cmluZ2lmeShvYmopO1xuICAgICAgfVxuICAgIH0gY2F0Y2goZSkge31cbiAgfVxuICB2YXIgcmVzID0ge307XG4gIHN3aXRjaCh0eXBlb2Ygb2JqKSB7XG4gIGNhc2UgJ29iamVjdCc6XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgdmFyIHIgPSBfZmxhdHRlbkpzb24ob2JqW2tleV0pO1xuICAgICAgZm9yICh2YXIgX2tleSBpbiByKSB7XG4gICAgICAgIHJlc1trZXkgKyBfa2V5XSA9IHJbX2tleV07XG4gICAgICB9XG4gICAgfVxuICAgIGJyZWFrO1xuICBjYXNlICdhcnJheSc6XG4gICAgb2JqLmZvckVhY2goZnVuY3Rpb24oZSwgaSkge1xuICAgICAgdmFyIHIgPSBfZmxhdHRlbkpzb24oZSk7XG4gICAgICBmb3IgKHZhciBfa2V5IGluIHIpIHtcbiAgICAgICAgcmVzW2kgKyBfa2V5XSA9IHJbX2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgYnJlYWs7XG4gIGNhc2UgJ251bWJlcic6XG4gICAgb2JqID0gSlNPTi5zdHJpbmdpZnkob2JqKTtcbiAgZGVmYXVsdDpcbiAgICByZXNbJyddID0gb2JqO1xuICB9XG4gIHJldHVybiByZXM7XG59O1xuXG5mdW5jdGlvbiBkVVJJQyhzKSB7XG4gIC8vIGF2b2lkZSBlcnJvciBmcm9tIGRlY29kZVVSSUNvbXBvbmVudCgnJTInKVxuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocyk7XG4gIH0gY2F0Y2goZSkge1xuICAgIHJldHVybiBzO1xuICB9XG59O1xuXG5mdW5jdGlvbiBnZXRIZWFkZXJNRDUoaGVhZGVycykge1xuICB2YXIgcXNNRDUgPSB7fTtcbiAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHtcbiAgICB2YXIgdG9rID0gZFVSSUMoaGVhZGVyc1trZXldKTtcbiAgICB3aGlsZSAodG9rICE9IGRVUklDKHRvaykpIHtcbiAgICAgIHRvayA9IGRVUklDKHRvayk7XG4gICAgfVxuICAgIHFzTUQ1W21kNShrZXkpXSA9IG1kNSh0b2spO1xuICB9XG4gIHJldHVybiBxc01ENTtcbn07XG5cbi8qKlxuIFVSTEluZm8gY2xhc3M6IGhvbGRzIGEgcGFyc2VkIFVSTC5cbiAqL1xudmFyIFVSTEluZm8gPSBmdW5jdGlvbih1cmwpIHtcbiAgdGhpcy51cmxfc3RyID0gdXJsO1xuICAvLyBtYXAgcGFyc2VkIHVybCBwYXJ0cyBvbnRvIFVSTCBvYmplY3RcbiAgbGV0IHVybF9wYXJ0cyA9IHBhcnNlVVJMKHVybCk7XG4gIGZvcihsZXQgayBpbiB1cmxfcGFydHMpIHtcbiAgICB0aGlzW2tdID0gdXJsX3BhcnRzW2tdO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuXG5VUkxJbmZvLl9jYWNoZSA9IG5ldyBNYXBDYWNoZShmdW5jdGlvbih1cmwpIHsgcmV0dXJuIG5ldyBVUkxJbmZvKHVybCk7IH0sIDEwMCk7XG5cbi8qKiBGYWN0b3J5IGdldHRlciBmb3IgVVJMSW5mby4gVVJMSW5mbyBhcmUgY2FjaGVkIGluIGEgTFJVIGNhY2hlLiAqL1xuVVJMSW5mby5nZXQgPSBmdW5jdGlvbih1cmwpIHtcbiAgaWYgKCF1cmwpIHJldHVybiBcIlwiO1xuICByZXR1cm4gVVJMSW5mby5fY2FjaGUuZ2V0KHVybCk7XG59XG5cblVSTEluZm8ucHJvdG90eXBlID0ge1xuICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudXJsX3N0cjtcbiAgfSxcbiAgZ2V0S2V5VmFsdWVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGt2TGlzdCA9IFtdO1xuICAgIGZvciAobGV0IGt2IG9mIFt0aGlzLnF1ZXJ5X2tleXMsIHRoaXMucGFyYW1ldGVyX2tleXNdKSB7XG4gICAgICBmb3IgKGxldCBrZXkgaW4ga3YpIHtcbiAgICAgICAga3ZMaXN0LnB1c2goe2s6IGtleSwgdjoga3Zba2V5XX0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ga3ZMaXN0O1xuICB9LFxuICBnZXRLZXlWYWx1ZXNNRDU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIga3ZMaXN0ID0gdGhpcy5nZXRLZXlWYWx1ZXMoKTtcbiAgICByZXR1cm4ga3ZMaXN0Lm1hcChmdW5jdGlvbiAoa3YpIHtcbiAgICAgIGt2LmtfbGVuID0ga3Yuay5sZW5ndGg7XG4gICAgICBrdi52X2xlbiA9IGt2LnYubGVuZ3RoO1xuICAgICAga3YuayA9IG1kNShrdi5rKTtcbiAgICAgIGt2LnYgPSBtZDUoa3Yudik7XG4gICAgICByZXR1cm4ga3Y7XG4gICAgfSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHNodWZmbGUocykge1xuICB2YXIgYSA9IHMuc3BsaXQoXCJcIiksXG4gICAgICBuID0gYS5sZW5ndGg7XG5cbiAgZm9yKHZhciBpID0gbiAtIDE7IGkgPiAwOyBpLS0pIHtcbiAgICB2YXIgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xuICAgIHZhciB0bXAgPSBhW2ldO1xuICAgIGFbaV0gPSBhW2pdO1xuICAgIGFbal0gPSB0bXA7XG4gIH1cbiAgcmV0dXJuIGEuam9pbihcIlwiKTtcbn07XG5cbmZ1bmN0aW9uIHBhcnNlUXVlcnkocXN0cikge1xuICB2YXIgcXVlcnkgPSB7fTtcbiAgdmFyIGEgPSBxc3RyLnNwbGl0KCcmJyk7XG4gIGZvciAodmFyIGkgaW4gYSlcbiAge1xuICAgIHZhciBiID0gYVtpXS5zcGxpdCgnPScpO1xuICAgIHF1ZXJ5W2RVUklDKGJbMF0pXSA9IGRVUklDKGJbMV0pO1xuICB9XG4gIHJldHVybiBxdWVyeTtcbn07XG5cbmZ1bmN0aW9uIGZpbmRPYXV0aCh1cmwsIHVybF9wYXJ0cykge1xuICB0cnkge1xuICAgIHZhciB2YWx1ZSA9IG51bGw7XG5cbiAgICBpZiAoKHVybF9wYXJ0cy5wYXRoLmxlbmd0aCA8IDUwKSAmJiB1cmxfcGFydHMucXVlcnlfc3RyaW5nICYmICh1cmxfcGFydHMucGF0aC5pbmRleE9mKCdvYXV0aCcpIT0tMSkpIHtcblxuICAgICAgdmFyIHFzbyA9IHBhcnNlUXVlcnkodXJsX3BhcnRzLnF1ZXJ5X3N0cmluZyk7XG4gICAgICB2YXIgayA9IE9iamVjdC5rZXlzKHFzbyk7XG4gICAgICBmb3IodmFyIGk9MDtpPGsubGVuZ3RoO2krKykge1xuICAgICAgICBpZiAoa1tpXS5pbmRleE9mKCdjYWxsYmFjaycpIT0tMSB8fCBrW2ldLmluZGV4T2YoJ3JlZGlyZWN0JykhPS0xKSB7XG4gICAgICAgICAgdmFsdWUgPSBkVVJJQyhxc29ba1tpXV0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmICgocXNvW2tbaV1dLmluZGV4T2YoJ2h0dHAnKT09MCkgJiYgKHFzb1trW2ldXS5pbmRleE9mKCcvb2F1dGgnKSE9LTEpKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmxfcGFydHMyID0gcGFyc2VVUkwocXNvW2tbaV1dKTtcbiAgICAgICAgICAgIGlmICh1cmxfcGFydHMyICYmIHVybF9wYXJ0czIucGF0aCAmJiB1cmxfcGFydHMyLnBhdGguaW5kZXhPZignb2F1dGgnKSkge1xuICAgICAgICAgICAgICBpZiAodXJsX3BhcnRzLnF1ZXJ5X3N0cmluZykge1xuICAgICAgICAgICAgICAgIHZhciBxc28yID0gcGFyc2VRdWVyeSh1cmxfcGFydHMyLnF1ZXJ5X3N0cmluZyk7XG4gICAgICAgICAgICAgICAgdmFyIGsyID0gT2JqZWN0LmtleXMocXNvMik7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpMj0wO2kyPGsyLmxlbmd0aDtpMisrKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoazJbaTJdLmluZGV4T2YoJ2NhbGxiYWNrJykhPS0xIHx8IGsyW2kyXS5pbmRleE9mKCdyZWRpcmVjdCcpIT0tMSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGRVUklDKHFzbzJbazJbaTJdXSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcblxuICB9IGNhdGNoKGVlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbmV4cG9ydCB7XG4gIHBhcnNlVVJMLFxuICBnZXRQYXJhbWV0ZXJzUVMsXG4gIGRVUklDLFxuICBnZXRIZWFkZXJNRDUsXG4gIFVSTEluZm8sXG4gIHNodWZmbGUsXG4gIGZpbmRPYXV0aFxufTtcbiJdfQ==